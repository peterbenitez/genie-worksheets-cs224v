
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://ws.genie.stanford.edu/api/environment/">
      
      
        <link rel="prev" href="../../course_enrollment/">
      
      
        <link rel="next" href="../agent/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.48">
    
    
      
        <title>Environment - GenieWorksheets</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6f8fc17f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#environment" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="GenieWorksheets" class="md-header__button md-logo" aria-label="GenieWorksheets" data-md-component="logo">
      
  <img src="../../assets/genie_worksheets_circle.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            GenieWorksheets
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Environment
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/stanford-oval/genie-worksheets/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../.." class="md-tabs__link">
          
  
    
  
  Home

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../examples/" class="md-tabs__link">
          
  
    
  
  Examples

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
    
  
  API Reference

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="GenieWorksheets" class="md-nav__button md-logo" aria-label="GenieWorksheets" data-md-component="logo">
      
  <img src="../../assets/genie_worksheets_circle.png" alt="logo">

    </a>
    GenieWorksheets
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/stanford-oval/genie-worksheets/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../.." class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Home
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
    <a href="../../examples/" class="md-nav__link">
      
  
  <span class="md-ellipsis">
    Examples
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
    
    
      
        
        
      
      
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
      
        
          
          
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" checked>
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Core Modules
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            Core Modules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Environment
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Environment
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.worksheets.environment" class="md-nav__link">
    <span class="md-ellipsis">
      environment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="environment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieValue" class="md-nav__link">
    <span class="md-ellipsis">
      GenieValue
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GenieValue">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieValue-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieValue.value" class="md-nav__link">
    <span class="md-ellipsis">
      value
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieValue.confirmed" class="md-nav__link">
    <span class="md-ellipsis">
      confirmed
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieValue-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieValue.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieValue.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      __repr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieValue.__eq__" class="md-nav__link">
    <span class="md-ellipsis">
      __eq__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieValue.confirm" class="md-nav__link">
    <span class="md-ellipsis">
      confirm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieValue.__str__" class="md-nav__link">
    <span class="md-ellipsis">
      __str__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieValue.__hash__" class="md-nav__link">
    <span class="md-ellipsis">
      __hash__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieResult" class="md-nav__link">
    <span class="md-ellipsis">
      GenieResult
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GenieResult">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieResult-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieResult.value" class="md-nav__link">
    <span class="md-ellipsis">
      value
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieResult.confirmed" class="md-nav__link">
    <span class="md-ellipsis">
      confirmed
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieResult.parent" class="md-nav__link">
    <span class="md-ellipsis">
      parent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieResult.parent_var_name" class="md-nav__link">
    <span class="md-ellipsis">
      parent_var_name
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieResult-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieResult.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      __repr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieResult.__eq__" class="md-nav__link">
    <span class="md-ellipsis">
      __eq__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieResult.confirm" class="md-nav__link">
    <span class="md-ellipsis">
      confirm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieResult.__str__" class="md-nav__link">
    <span class="md-ellipsis">
      __str__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieResult.__hash__" class="md-nav__link">
    <span class="md-ellipsis">
      __hash__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieResult.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieResult.__getitem__" class="md-nav__link">
    <span class="md-ellipsis">
      __getitem__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieREPR" class="md-nav__link">
    <span class="md-ellipsis">
      GenieREPR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GenieREPR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieREPR-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieREPR.__new__" class="md-nav__link">
    <span class="md-ellipsis">
      __new__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieREPR.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      __repr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieREPR.get_semantic_parser_schema" class="md-nav__link">
    <span class="md-ellipsis">
      get_semantic_parser_schema
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField" class="md-nav__link">
    <span class="md-ellipsis">
      GenieField
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GenieField">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.predicate" class="md-nav__link">
    <span class="md-ellipsis">
      predicate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.slottype" class="md-nav__link">
    <span class="md-ellipsis">
      slottype
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.name" class="md-nav__link">
    <span class="md-ellipsis">
      name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.question" class="md-nav__link">
    <span class="md-ellipsis">
      question
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.ask" class="md-nav__link">
    <span class="md-ellipsis">
      ask
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.optional" class="md-nav__link">
    <span class="md-ellipsis">
      optional
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.actions" class="md-nav__link">
    <span class="md-ellipsis">
      actions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.requires_confirmation" class="md-nav__link">
    <span class="md-ellipsis">
      requires_confirmation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.internal" class="md-nav__link">
    <span class="md-ellipsis">
      internal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.description" class="md-nav__link">
    <span class="md-ellipsis">
      description
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.primary_key" class="md-nav__link">
    <span class="md-ellipsis">
      primary_key
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.validation" class="md-nav__link">
    <span class="md-ellipsis">
      validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.parent" class="md-nav__link">
    <span class="md-ellipsis">
      parent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.bot" class="md-nav__link">
    <span class="md-ellipsis">
      bot
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.action_performed" class="md-nav__link">
    <span class="md-ellipsis">
      action_performed
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField._value" class="md-nav__link">
    <span class="md-ellipsis">
      _value
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField._confirmed" class="md-nav__link">
    <span class="md-ellipsis">
      _confirmed
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.confirmed" class="md-nav__link">
    <span class="md-ellipsis">
      confirmed
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.value" class="md-nav__link">
    <span class="md-ellipsis">
      value
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.__deepcopy__" class="md-nav__link">
    <span class="md-ellipsis">
      __deepcopy__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.perform_action" class="md-nav__link">
    <span class="md-ellipsis">
      perform_action
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      __repr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.schema" class="md-nav__link">
    <span class="md-ellipsis">
      schema
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.schema_without_type" class="md-nav__link">
    <span class="md-ellipsis">
      schema_without_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.init_value" class="md-nav__link">
    <span class="md-ellipsis">
      init_value
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.__eq__" class="md-nav__link">
    <span class="md-ellipsis">
      __eq__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieWorksheet" class="md-nav__link">
    <span class="md-ellipsis">
      GenieWorksheet
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GenieWorksheet">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieWorksheet-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieWorksheet.action_performed" class="md-nav__link">
    <span class="md-ellipsis">
      action_performed
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieWorksheet.result" class="md-nav__link">
    <span class="md-ellipsis">
      result
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieWorksheet.random_id" class="md-nav__link">
    <span class="md-ellipsis">
      random_id
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieWorksheet-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieWorksheet.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieWorksheet.perform_action" class="md-nav__link">
    <span class="md-ellipsis">
      perform_action
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieWorksheet.is_complete" class="md-nav__link">
    <span class="md-ellipsis">
      is_complete
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieWorksheet.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      __repr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieWorksheet.schema_without_type" class="md-nav__link">
    <span class="md-ellipsis">
      schema_without_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieWorksheet.execute" class="md-nav__link">
    <span class="md-ellipsis">
      execute
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieWorksheet.new" class="md-nav__link">
    <span class="md-ellipsis">
      new
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieWorksheet.__setattr__" class="md-nav__link">
    <span class="md-ellipsis">
      __setattr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieWorksheet.ask" class="md-nav__link">
    <span class="md-ellipsis">
      ask
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieType" class="md-nav__link">
    <span class="md-ellipsis">
      GenieType
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GenieType">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieType-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieType.action_performed" class="md-nav__link">
    <span class="md-ellipsis">
      action_performed
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieType.result" class="md-nav__link">
    <span class="md-ellipsis">
      result
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieType.random_id" class="md-nav__link">
    <span class="md-ellipsis">
      random_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieType._parent" class="md-nav__link">
    <span class="md-ellipsis">
      _parent
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieType-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieType.perform_action" class="md-nav__link">
    <span class="md-ellipsis">
      perform_action
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieType.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      __repr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieType.schema_without_type" class="md-nav__link">
    <span class="md-ellipsis">
      schema_without_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieType.execute" class="md-nav__link">
    <span class="md-ellipsis">
      execute
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieType.new" class="md-nav__link">
    <span class="md-ellipsis">
      new
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieType.__setattr__" class="md-nav__link">
    <span class="md-ellipsis">
      __setattr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieType.ask" class="md-nav__link">
    <span class="md-ellipsis">
      ask
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieType.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieType.is_complete" class="md-nav__link">
    <span class="md-ellipsis">
      is_complete
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieDB" class="md-nav__link">
    <span class="md-ellipsis">
      GenieDB
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GenieDB">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieDB-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieDB.action_performed" class="md-nav__link">
    <span class="md-ellipsis">
      action_performed
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieDB.result" class="md-nav__link">
    <span class="md-ellipsis">
      result
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieDB.random_id" class="md-nav__link">
    <span class="md-ellipsis">
      random_id
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieDB-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieDB.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieDB.perform_action" class="md-nav__link">
    <span class="md-ellipsis">
      perform_action
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieDB.is_complete" class="md-nav__link">
    <span class="md-ellipsis">
      is_complete
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieDB.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      __repr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieDB.schema_without_type" class="md-nav__link">
    <span class="md-ellipsis">
      schema_without_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieDB.execute" class="md-nav__link">
    <span class="md-ellipsis">
      execute
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieDB.new" class="md-nav__link">
    <span class="md-ellipsis">
      new
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieDB.__setattr__" class="md-nav__link">
    <span class="md-ellipsis">
      __setattr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieDB.ask" class="md-nav__link">
    <span class="md-ellipsis">
      ask
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer" class="md-nav__link">
    <span class="md-ellipsis">
      Answer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Answer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer.random_id" class="md-nav__link">
    <span class="md-ellipsis">
      random_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer.query" class="md-nav__link">
    <span class="md-ellipsis">
      query
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer.actions" class="md-nav__link">
    <span class="md-ellipsis">
      actions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer.result" class="md-nav__link">
    <span class="md-ellipsis">
      result
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer.tables" class="md-nav__link">
    <span class="md-ellipsis">
      tables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer.potential_outputs" class="md-nav__link">
    <span class="md-ellipsis">
      potential_outputs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer.nl_query" class="md-nav__link">
    <span class="md-ellipsis">
      nl_query
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer.param_names" class="md-nav__link">
    <span class="md-ellipsis">
      param_names
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer.action_performed" class="md-nav__link">
    <span class="md-ellipsis">
      action_performed
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer.required_columns" class="md-nav__link">
    <span class="md-ellipsis">
      required_columns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer._ordered_attributes" class="md-nav__link">
    <span class="md-ellipsis">
      _ordered_attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer.perform_action" class="md-nav__link">
    <span class="md-ellipsis">
      perform_action
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer.is_complete" class="md-nav__link">
    <span class="md-ellipsis">
      is_complete
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      __repr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer.schema_without_type" class="md-nav__link">
    <span class="md-ellipsis">
      schema_without_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer.new" class="md-nav__link">
    <span class="md-ellipsis">
      new
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer.__setattr__" class="md-nav__link">
    <span class="md-ellipsis">
      __setattr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer.ask" class="md-nav__link">
    <span class="md-ellipsis">
      ask
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer.execute" class="md-nav__link">
    <span class="md-ellipsis">
      execute
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer.more_field_info_query" class="md-nav__link">
    <span class="md-ellipsis">
      more_field_info_query
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer.output_in_result" class="md-nav__link">
    <span class="md-ellipsis">
      output_in_result
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer.update" class="md-nav__link">
    <span class="md-ellipsis">
      update
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.MoreFieldInfo" class="md-nav__link">
    <span class="md-ellipsis">
      MoreFieldInfo
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MoreFieldInfo">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.MoreFieldInfo-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.MoreFieldInfo.result" class="md-nav__link">
    <span class="md-ellipsis">
      result
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.MoreFieldInfo.random_id" class="md-nav__link">
    <span class="md-ellipsis">
      random_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.MoreFieldInfo.api_name" class="md-nav__link">
    <span class="md-ellipsis">
      api_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.MoreFieldInfo.parameter_name" class="md-nav__link">
    <span class="md-ellipsis">
      parameter_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.MoreFieldInfo.actions" class="md-nav__link">
    <span class="md-ellipsis">
      actions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.MoreFieldInfo.action_performed" class="md-nav__link">
    <span class="md-ellipsis">
      action_performed
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.MoreFieldInfo-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.MoreFieldInfo.perform_action" class="md-nav__link">
    <span class="md-ellipsis">
      perform_action
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.MoreFieldInfo.is_complete" class="md-nav__link">
    <span class="md-ellipsis">
      is_complete
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.MoreFieldInfo.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      __repr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.MoreFieldInfo.schema_without_type" class="md-nav__link">
    <span class="md-ellipsis">
      schema_without_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.MoreFieldInfo.execute" class="md-nav__link">
    <span class="md-ellipsis">
      execute
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.MoreFieldInfo.new" class="md-nav__link">
    <span class="md-ellipsis">
      new
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.MoreFieldInfo.__setattr__" class="md-nav__link">
    <span class="md-ellipsis">
      __setattr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.MoreFieldInfo.ask" class="md-nav__link">
    <span class="md-ellipsis">
      ask
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.MoreFieldInfo.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Action" class="md-nav__link">
    <span class="md-ellipsis">
      Action
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Action">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Action-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Action.action" class="md-nav__link">
    <span class="md-ellipsis">
      action
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Action-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Action.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Action.__len__" class="md-nav__link">
    <span class="md-ellipsis">
      __len__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Action.perform" class="md-nav__link">
    <span class="md-ellipsis">
      perform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime" class="md-nav__link">
    <span class="md-ellipsis">
      GenieRuntime
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GenieRuntime">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.prompt_dir" class="md-nav__link">
    <span class="md-ellipsis">
      prompt_dir
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.args" class="md-nav__link">
    <span class="md-ellipsis">
      args
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.name" class="md-nav__link">
    <span class="md-ellipsis">
      name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.genie_worksheets" class="md-nav__link">
    <span class="md-ellipsis">
      genie_worksheets
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.genie_db_models" class="md-nav__link">
    <span class="md-ellipsis">
      genie_db_models
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.starting_prompt" class="md-nav__link">
    <span class="md-ellipsis">
      starting_prompt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.description" class="md-nav__link">
    <span class="md-ellipsis">
      description
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.suql_runner" class="md-nav__link">
    <span class="md-ellipsis">
      suql_runner
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.suql_parser" class="md-nav__link">
    <span class="md-ellipsis">
      suql_parser
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime._interpreter" class="md-nav__link">
    <span class="md-ellipsis">
      _interpreter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.context" class="md-nav__link">
    <span class="md-ellipsis">
      context
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.local_context_init" class="md-nav__link">
    <span class="md-ellipsis">
      local_context_init
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.dlg_history" class="md-nav__link">
    <span class="md-ellipsis">
      dlg_history
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.order_of_actions" class="md-nav__link">
    <span class="md-ellipsis">
      order_of_actions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.reset" class="md-nav__link">
    <span class="md-ellipsis">
      reset
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.add_worksheet" class="md-nav__link">
    <span class="md-ellipsis">
      add_worksheet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.add_db_model" class="md-nav__link">
    <span class="md-ellipsis">
      add_db_model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.add_api" class="md-nav__link">
    <span class="md-ellipsis">
      add_api
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.geniews" class="md-nav__link">
    <span class="md-ellipsis">
      geniews
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.genie_sql" class="md-nav__link">
    <span class="md-ellipsis">
      genie_sql
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.execute" class="md-nav__link">
    <span class="md-ellipsis">
      execute
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.eval" class="md-nav__link">
    <span class="md-ellipsis">
      eval
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.update_from_context" class="md-nav__link">
    <span class="md-ellipsis">
      update_from_context
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.get_available_worksheets" class="md-nav__link">
    <span class="md-ellipsis">
      get_available_worksheets
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.get_available_dbs" class="md-nav__link">
    <span class="md-ellipsis">
      get_available_dbs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.get_all_variables" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_variables
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieInterpreter" class="md-nav__link">
    <span class="md-ellipsis">
      GenieInterpreter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GenieInterpreter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieInterpreter-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieInterpreter.execute" class="md-nav__link">
    <span class="md-ellipsis">
      execute
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieInterpreter.eval" class="md-nav__link">
    <span class="md-ellipsis">
      eval
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieContext" class="md-nav__link">
    <span class="md-ellipsis">
      GenieContext
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GenieContext">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieContext-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieContext.context" class="md-nav__link">
    <span class="md-ellipsis">
      context
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieContext.agent_acts" class="md-nav__link">
    <span class="md-ellipsis">
      agent_acts
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieContext-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieContext.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieContext.reset_agent_acts" class="md-nav__link">
    <span class="md-ellipsis">
      reset_agent_acts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieContext.update" class="md-nav__link">
    <span class="md-ellipsis">
      update
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieContext.get" class="md-nav__link">
    <span class="md-ellipsis">
      get
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieContext.set" class="md-nav__link">
    <span class="md-ellipsis">
      set
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieContext.delete" class="md-nav__link">
    <span class="md-ellipsis">
      delete
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.TurnContext" class="md-nav__link">
    <span class="md-ellipsis">
      TurnContext
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TurnContext">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.TurnContext-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.TurnContext.context" class="md-nav__link">
    <span class="md-ellipsis">
      context
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.TurnContext-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.TurnContext.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.TurnContext.add_turn_context" class="md-nav__link">
    <span class="md-ellipsis">
      add_turn_context
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AgentAct" class="md-nav__link">
    <span class="md-ellipsis">
      AgentAct
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.ReportAgentAct" class="md-nav__link">
    <span class="md-ellipsis">
      ReportAgentAct
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ReportAgentAct">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.ReportAgentAct-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.ReportAgentAct.query" class="md-nav__link">
    <span class="md-ellipsis">
      query
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.ReportAgentAct.message" class="md-nav__link">
    <span class="md-ellipsis">
      message
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.ReportAgentAct.query_var_name" class="md-nav__link">
    <span class="md-ellipsis">
      query_var_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.ReportAgentAct.message_var_name" class="md-nav__link">
    <span class="md-ellipsis">
      message_var_name
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.ReportAgentAct-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.ReportAgentAct.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.ReportAgentAct.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      __repr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.ReportAgentAct.__eq__" class="md-nav__link">
    <span class="md-ellipsis">
      __eq__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AskAgentAct" class="md-nav__link">
    <span class="md-ellipsis">
      AskAgentAct
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AskAgentAct">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AskAgentAct-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AskAgentAct.ws" class="md-nav__link">
    <span class="md-ellipsis">
      ws
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AskAgentAct.field" class="md-nav__link">
    <span class="md-ellipsis">
      field
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AskAgentAct.ws_name" class="md-nav__link">
    <span class="md-ellipsis">
      ws_name
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AskAgentAct-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AskAgentAct.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AskAgentAct.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      __repr__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.ProposeAgentAct" class="md-nav__link">
    <span class="md-ellipsis">
      ProposeAgentAct
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ProposeAgentAct">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.ProposeAgentAct-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.ProposeAgentAct.ws" class="md-nav__link">
    <span class="md-ellipsis">
      ws
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.ProposeAgentAct.params" class="md-nav__link">
    <span class="md-ellipsis">
      params
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.ProposeAgentAct.ws_name" class="md-nav__link">
    <span class="md-ellipsis">
      ws_name
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.ProposeAgentAct-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.ProposeAgentAct.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.ProposeAgentAct.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      __repr__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AskForConfirmationAgentAct" class="md-nav__link">
    <span class="md-ellipsis">
      AskForConfirmationAgentAct
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AskForConfirmationAgentAct">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AskForConfirmationAgentAct-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AskForConfirmationAgentAct.ws" class="md-nav__link">
    <span class="md-ellipsis">
      ws
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AskForConfirmationAgentAct.field" class="md-nav__link">
    <span class="md-ellipsis">
      field
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AskForConfirmationAgentAct.ws_name" class="md-nav__link">
    <span class="md-ellipsis">
      ws_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AskForConfirmationAgentAct.field_name" class="md-nav__link">
    <span class="md-ellipsis">
      field_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AskForConfirmationAgentAct.value" class="md-nav__link">
    <span class="md-ellipsis">
      value
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AskForConfirmationAgentAct-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AskForConfirmationAgentAct.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AskForConfirmationAgentAct.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      __repr__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AgentActs" class="md-nav__link">
    <span class="md-ellipsis">
      AgentActs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AgentActs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AgentActs-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AgentActs.args" class="md-nav__link">
    <span class="md-ellipsis">
      args
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AgentActs.actions" class="md-nav__link">
    <span class="md-ellipsis">
      actions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AgentActs-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AgentActs.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AgentActs.add" class="md-nav__link">
    <span class="md-ellipsis">
      add
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AgentActs._add" class="md-nav__link">
    <span class="md-ellipsis">
      _add
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AgentActs.should_add" class="md-nav__link">
    <span class="md-ellipsis">
      should_add
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AgentActs.extend" class="md-nav__link">
    <span class="md-ellipsis">
      extend
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AgentActs.__iter__" class="md-nav__link">
    <span class="md-ellipsis">
      __iter__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AgentActs.__next__" class="md-nav__link">
    <span class="md-ellipsis">
      __next__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AgentActs.can_have_other_acts" class="md-nav__link">
    <span class="md-ellipsis">
      can_have_other_acts
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.validation_check" class="md-nav__link">
    <span class="md-ellipsis">
      validation_check
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.get_genie_fields_from_ws" class="md-nav__link">
    <span class="md-ellipsis">
      get_genie_fields_from_ws
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.execute_query" class="md-nav__link">
    <span class="md-ellipsis">
      execute_query
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.modify_action_code" class="md-nav__link">
    <span class="md-ellipsis">
      modify_action_code
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.eval_predicates" class="md-nav__link">
    <span class="md-ellipsis">
      eval_predicates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.parse_single_predicate" class="md-nav__link">
    <span class="md-ellipsis">
      parse_single_predicate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.rewrite_action_code" class="md-nav__link">
    <span class="md-ellipsis">
      rewrite_action_code
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.same_field" class="md-nav__link">
    <span class="md-ellipsis">
      same_field
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.same_worksheet" class="md-nav__link">
    <span class="md-ellipsis">
      same_worksheet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.count_number_of_vars" class="md-nav__link">
    <span class="md-ellipsis">
      count_number_of_vars
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.genie_deepcopy" class="md-nav__link">
    <span class="md-ellipsis">
      genie_deepcopy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.get_field_variable_name" class="md-nav__link">
    <span class="md-ellipsis">
      get_field_variable_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.collect_all_parents" class="md-nav__link">
    <span class="md-ellipsis">
      collect_all_parents
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.find_all_variables_matching_name" class="md-nav__link">
    <span class="md-ellipsis">
      find_all_variables_matching_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.replace_undefined_variables" class="md-nav__link">
    <span class="md-ellipsis">
      replace_undefined_variables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.variable_resolver" class="md-nav__link">
    <span class="md-ellipsis">
      variable_resolver
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.select_variable_from_list" class="md-nav__link">
    <span class="md-ellipsis">
      select_variable_from_list
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.get_variable_name" class="md-nav__link">
    <span class="md-ellipsis">
      get_variable_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.propose" class="md-nav__link">
    <span class="md-ellipsis">
      propose
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.say" class="md-nav__link">
    <span class="md-ellipsis">
      say
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.generate_clarification" class="md-nav__link">
    <span class="md-ellipsis">
      generate_clarification
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.answer_clarification_question" class="md-nav__link">
    <span class="md-ellipsis">
      answer_clarification_question
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.confirm" class="md-nav__link">
    <span class="md-ellipsis">
      confirm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.sanitize_dev_code" class="md-nav__link">
    <span class="md-ellipsis">
      sanitize_dev_code
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.any_open_empty_ws" class="md-nav__link">
    <span class="md-ellipsis">
      any_open_empty_ws
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.find_list_variable" class="md-nav__link">
    <span class="md-ellipsis">
      find_list_variable
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../agent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Agent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../knowledge/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Knowledge
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../from_spreadsheet/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    From Spreadsheet
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Utility Modules
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.worksheets.environment" class="md-nav__link">
    <span class="md-ellipsis">
      environment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="environment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieValue" class="md-nav__link">
    <span class="md-ellipsis">
      GenieValue
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GenieValue">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieValue-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieValue.value" class="md-nav__link">
    <span class="md-ellipsis">
      value
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieValue.confirmed" class="md-nav__link">
    <span class="md-ellipsis">
      confirmed
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieValue-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieValue.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieValue.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      __repr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieValue.__eq__" class="md-nav__link">
    <span class="md-ellipsis">
      __eq__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieValue.confirm" class="md-nav__link">
    <span class="md-ellipsis">
      confirm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieValue.__str__" class="md-nav__link">
    <span class="md-ellipsis">
      __str__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieValue.__hash__" class="md-nav__link">
    <span class="md-ellipsis">
      __hash__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieResult" class="md-nav__link">
    <span class="md-ellipsis">
      GenieResult
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GenieResult">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieResult-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieResult.value" class="md-nav__link">
    <span class="md-ellipsis">
      value
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieResult.confirmed" class="md-nav__link">
    <span class="md-ellipsis">
      confirmed
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieResult.parent" class="md-nav__link">
    <span class="md-ellipsis">
      parent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieResult.parent_var_name" class="md-nav__link">
    <span class="md-ellipsis">
      parent_var_name
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieResult-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieResult.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      __repr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieResult.__eq__" class="md-nav__link">
    <span class="md-ellipsis">
      __eq__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieResult.confirm" class="md-nav__link">
    <span class="md-ellipsis">
      confirm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieResult.__str__" class="md-nav__link">
    <span class="md-ellipsis">
      __str__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieResult.__hash__" class="md-nav__link">
    <span class="md-ellipsis">
      __hash__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieResult.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieResult.__getitem__" class="md-nav__link">
    <span class="md-ellipsis">
      __getitem__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieREPR" class="md-nav__link">
    <span class="md-ellipsis">
      GenieREPR
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GenieREPR">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieREPR-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieREPR.__new__" class="md-nav__link">
    <span class="md-ellipsis">
      __new__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieREPR.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      __repr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieREPR.get_semantic_parser_schema" class="md-nav__link">
    <span class="md-ellipsis">
      get_semantic_parser_schema
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField" class="md-nav__link">
    <span class="md-ellipsis">
      GenieField
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GenieField">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.predicate" class="md-nav__link">
    <span class="md-ellipsis">
      predicate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.slottype" class="md-nav__link">
    <span class="md-ellipsis">
      slottype
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.name" class="md-nav__link">
    <span class="md-ellipsis">
      name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.question" class="md-nav__link">
    <span class="md-ellipsis">
      question
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.ask" class="md-nav__link">
    <span class="md-ellipsis">
      ask
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.optional" class="md-nav__link">
    <span class="md-ellipsis">
      optional
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.actions" class="md-nav__link">
    <span class="md-ellipsis">
      actions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.requires_confirmation" class="md-nav__link">
    <span class="md-ellipsis">
      requires_confirmation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.internal" class="md-nav__link">
    <span class="md-ellipsis">
      internal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.description" class="md-nav__link">
    <span class="md-ellipsis">
      description
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.primary_key" class="md-nav__link">
    <span class="md-ellipsis">
      primary_key
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.validation" class="md-nav__link">
    <span class="md-ellipsis">
      validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.parent" class="md-nav__link">
    <span class="md-ellipsis">
      parent
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.bot" class="md-nav__link">
    <span class="md-ellipsis">
      bot
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.action_performed" class="md-nav__link">
    <span class="md-ellipsis">
      action_performed
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField._value" class="md-nav__link">
    <span class="md-ellipsis">
      _value
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField._confirmed" class="md-nav__link">
    <span class="md-ellipsis">
      _confirmed
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.confirmed" class="md-nav__link">
    <span class="md-ellipsis">
      confirmed
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.value" class="md-nav__link">
    <span class="md-ellipsis">
      value
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.__deepcopy__" class="md-nav__link">
    <span class="md-ellipsis">
      __deepcopy__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.perform_action" class="md-nav__link">
    <span class="md-ellipsis">
      perform_action
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      __repr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.schema" class="md-nav__link">
    <span class="md-ellipsis">
      schema
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.schema_without_type" class="md-nav__link">
    <span class="md-ellipsis">
      schema_without_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.init_value" class="md-nav__link">
    <span class="md-ellipsis">
      init_value
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieField.__eq__" class="md-nav__link">
    <span class="md-ellipsis">
      __eq__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieWorksheet" class="md-nav__link">
    <span class="md-ellipsis">
      GenieWorksheet
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GenieWorksheet">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieWorksheet-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieWorksheet.action_performed" class="md-nav__link">
    <span class="md-ellipsis">
      action_performed
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieWorksheet.result" class="md-nav__link">
    <span class="md-ellipsis">
      result
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieWorksheet.random_id" class="md-nav__link">
    <span class="md-ellipsis">
      random_id
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieWorksheet-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieWorksheet.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieWorksheet.perform_action" class="md-nav__link">
    <span class="md-ellipsis">
      perform_action
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieWorksheet.is_complete" class="md-nav__link">
    <span class="md-ellipsis">
      is_complete
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieWorksheet.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      __repr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieWorksheet.schema_without_type" class="md-nav__link">
    <span class="md-ellipsis">
      schema_without_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieWorksheet.execute" class="md-nav__link">
    <span class="md-ellipsis">
      execute
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieWorksheet.new" class="md-nav__link">
    <span class="md-ellipsis">
      new
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieWorksheet.__setattr__" class="md-nav__link">
    <span class="md-ellipsis">
      __setattr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieWorksheet.ask" class="md-nav__link">
    <span class="md-ellipsis">
      ask
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieType" class="md-nav__link">
    <span class="md-ellipsis">
      GenieType
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GenieType">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieType-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieType.action_performed" class="md-nav__link">
    <span class="md-ellipsis">
      action_performed
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieType.result" class="md-nav__link">
    <span class="md-ellipsis">
      result
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieType.random_id" class="md-nav__link">
    <span class="md-ellipsis">
      random_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieType._parent" class="md-nav__link">
    <span class="md-ellipsis">
      _parent
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieType-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieType.perform_action" class="md-nav__link">
    <span class="md-ellipsis">
      perform_action
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieType.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      __repr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieType.schema_without_type" class="md-nav__link">
    <span class="md-ellipsis">
      schema_without_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieType.execute" class="md-nav__link">
    <span class="md-ellipsis">
      execute
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieType.new" class="md-nav__link">
    <span class="md-ellipsis">
      new
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieType.__setattr__" class="md-nav__link">
    <span class="md-ellipsis">
      __setattr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieType.ask" class="md-nav__link">
    <span class="md-ellipsis">
      ask
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieType.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieType.is_complete" class="md-nav__link">
    <span class="md-ellipsis">
      is_complete
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieDB" class="md-nav__link">
    <span class="md-ellipsis">
      GenieDB
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GenieDB">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieDB-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieDB.action_performed" class="md-nav__link">
    <span class="md-ellipsis">
      action_performed
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieDB.result" class="md-nav__link">
    <span class="md-ellipsis">
      result
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieDB.random_id" class="md-nav__link">
    <span class="md-ellipsis">
      random_id
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieDB-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieDB.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieDB.perform_action" class="md-nav__link">
    <span class="md-ellipsis">
      perform_action
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieDB.is_complete" class="md-nav__link">
    <span class="md-ellipsis">
      is_complete
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieDB.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      __repr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieDB.schema_without_type" class="md-nav__link">
    <span class="md-ellipsis">
      schema_without_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieDB.execute" class="md-nav__link">
    <span class="md-ellipsis">
      execute
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieDB.new" class="md-nav__link">
    <span class="md-ellipsis">
      new
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieDB.__setattr__" class="md-nav__link">
    <span class="md-ellipsis">
      __setattr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieDB.ask" class="md-nav__link">
    <span class="md-ellipsis">
      ask
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer" class="md-nav__link">
    <span class="md-ellipsis">
      Answer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Answer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer.random_id" class="md-nav__link">
    <span class="md-ellipsis">
      random_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer.query" class="md-nav__link">
    <span class="md-ellipsis">
      query
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer.actions" class="md-nav__link">
    <span class="md-ellipsis">
      actions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer.result" class="md-nav__link">
    <span class="md-ellipsis">
      result
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer.tables" class="md-nav__link">
    <span class="md-ellipsis">
      tables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer.potential_outputs" class="md-nav__link">
    <span class="md-ellipsis">
      potential_outputs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer.nl_query" class="md-nav__link">
    <span class="md-ellipsis">
      nl_query
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer.param_names" class="md-nav__link">
    <span class="md-ellipsis">
      param_names
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer.action_performed" class="md-nav__link">
    <span class="md-ellipsis">
      action_performed
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer.required_columns" class="md-nav__link">
    <span class="md-ellipsis">
      required_columns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer._ordered_attributes" class="md-nav__link">
    <span class="md-ellipsis">
      _ordered_attributes
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer.perform_action" class="md-nav__link">
    <span class="md-ellipsis">
      perform_action
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer.is_complete" class="md-nav__link">
    <span class="md-ellipsis">
      is_complete
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      __repr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer.schema_without_type" class="md-nav__link">
    <span class="md-ellipsis">
      schema_without_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer.new" class="md-nav__link">
    <span class="md-ellipsis">
      new
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer.__setattr__" class="md-nav__link">
    <span class="md-ellipsis">
      __setattr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer.ask" class="md-nav__link">
    <span class="md-ellipsis">
      ask
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer.execute" class="md-nav__link">
    <span class="md-ellipsis">
      execute
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer.more_field_info_query" class="md-nav__link">
    <span class="md-ellipsis">
      more_field_info_query
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer.output_in_result" class="md-nav__link">
    <span class="md-ellipsis">
      output_in_result
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Answer.update" class="md-nav__link">
    <span class="md-ellipsis">
      update
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.MoreFieldInfo" class="md-nav__link">
    <span class="md-ellipsis">
      MoreFieldInfo
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MoreFieldInfo">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.MoreFieldInfo-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.MoreFieldInfo.result" class="md-nav__link">
    <span class="md-ellipsis">
      result
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.MoreFieldInfo.random_id" class="md-nav__link">
    <span class="md-ellipsis">
      random_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.MoreFieldInfo.api_name" class="md-nav__link">
    <span class="md-ellipsis">
      api_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.MoreFieldInfo.parameter_name" class="md-nav__link">
    <span class="md-ellipsis">
      parameter_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.MoreFieldInfo.actions" class="md-nav__link">
    <span class="md-ellipsis">
      actions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.MoreFieldInfo.action_performed" class="md-nav__link">
    <span class="md-ellipsis">
      action_performed
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.MoreFieldInfo-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.MoreFieldInfo.perform_action" class="md-nav__link">
    <span class="md-ellipsis">
      perform_action
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.MoreFieldInfo.is_complete" class="md-nav__link">
    <span class="md-ellipsis">
      is_complete
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.MoreFieldInfo.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      __repr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.MoreFieldInfo.schema_without_type" class="md-nav__link">
    <span class="md-ellipsis">
      schema_without_type
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.MoreFieldInfo.execute" class="md-nav__link">
    <span class="md-ellipsis">
      execute
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.MoreFieldInfo.new" class="md-nav__link">
    <span class="md-ellipsis">
      new
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.MoreFieldInfo.__setattr__" class="md-nav__link">
    <span class="md-ellipsis">
      __setattr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.MoreFieldInfo.ask" class="md-nav__link">
    <span class="md-ellipsis">
      ask
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.MoreFieldInfo.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Action" class="md-nav__link">
    <span class="md-ellipsis">
      Action
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Action">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Action-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Action.action" class="md-nav__link">
    <span class="md-ellipsis">
      action
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Action-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Action.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Action.__len__" class="md-nav__link">
    <span class="md-ellipsis">
      __len__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.Action.perform" class="md-nav__link">
    <span class="md-ellipsis">
      perform
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime" class="md-nav__link">
    <span class="md-ellipsis">
      GenieRuntime
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GenieRuntime">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.prompt_dir" class="md-nav__link">
    <span class="md-ellipsis">
      prompt_dir
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.args" class="md-nav__link">
    <span class="md-ellipsis">
      args
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.name" class="md-nav__link">
    <span class="md-ellipsis">
      name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.genie_worksheets" class="md-nav__link">
    <span class="md-ellipsis">
      genie_worksheets
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.genie_db_models" class="md-nav__link">
    <span class="md-ellipsis">
      genie_db_models
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.starting_prompt" class="md-nav__link">
    <span class="md-ellipsis">
      starting_prompt
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.description" class="md-nav__link">
    <span class="md-ellipsis">
      description
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.suql_runner" class="md-nav__link">
    <span class="md-ellipsis">
      suql_runner
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.suql_parser" class="md-nav__link">
    <span class="md-ellipsis">
      suql_parser
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime._interpreter" class="md-nav__link">
    <span class="md-ellipsis">
      _interpreter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.context" class="md-nav__link">
    <span class="md-ellipsis">
      context
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.local_context_init" class="md-nav__link">
    <span class="md-ellipsis">
      local_context_init
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.dlg_history" class="md-nav__link">
    <span class="md-ellipsis">
      dlg_history
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.order_of_actions" class="md-nav__link">
    <span class="md-ellipsis">
      order_of_actions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.reset" class="md-nav__link">
    <span class="md-ellipsis">
      reset
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.add_worksheet" class="md-nav__link">
    <span class="md-ellipsis">
      add_worksheet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.add_db_model" class="md-nav__link">
    <span class="md-ellipsis">
      add_db_model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.add_api" class="md-nav__link">
    <span class="md-ellipsis">
      add_api
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.geniews" class="md-nav__link">
    <span class="md-ellipsis">
      geniews
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.genie_sql" class="md-nav__link">
    <span class="md-ellipsis">
      genie_sql
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.execute" class="md-nav__link">
    <span class="md-ellipsis">
      execute
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.eval" class="md-nav__link">
    <span class="md-ellipsis">
      eval
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.update_from_context" class="md-nav__link">
    <span class="md-ellipsis">
      update_from_context
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.get_available_worksheets" class="md-nav__link">
    <span class="md-ellipsis">
      get_available_worksheets
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.get_available_dbs" class="md-nav__link">
    <span class="md-ellipsis">
      get_available_dbs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieRuntime.get_all_variables" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_variables
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieInterpreter" class="md-nav__link">
    <span class="md-ellipsis">
      GenieInterpreter
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GenieInterpreter">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieInterpreter-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieInterpreter.execute" class="md-nav__link">
    <span class="md-ellipsis">
      execute
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieInterpreter.eval" class="md-nav__link">
    <span class="md-ellipsis">
      eval
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieContext" class="md-nav__link">
    <span class="md-ellipsis">
      GenieContext
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GenieContext">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieContext-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieContext.context" class="md-nav__link">
    <span class="md-ellipsis">
      context
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieContext.agent_acts" class="md-nav__link">
    <span class="md-ellipsis">
      agent_acts
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieContext-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieContext.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieContext.reset_agent_acts" class="md-nav__link">
    <span class="md-ellipsis">
      reset_agent_acts
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieContext.update" class="md-nav__link">
    <span class="md-ellipsis">
      update
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieContext.get" class="md-nav__link">
    <span class="md-ellipsis">
      get
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieContext.set" class="md-nav__link">
    <span class="md-ellipsis">
      set
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.GenieContext.delete" class="md-nav__link">
    <span class="md-ellipsis">
      delete
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.TurnContext" class="md-nav__link">
    <span class="md-ellipsis">
      TurnContext
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TurnContext">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.TurnContext-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.TurnContext.context" class="md-nav__link">
    <span class="md-ellipsis">
      context
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.TurnContext-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.TurnContext.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.TurnContext.add_turn_context" class="md-nav__link">
    <span class="md-ellipsis">
      add_turn_context
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AgentAct" class="md-nav__link">
    <span class="md-ellipsis">
      AgentAct
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.ReportAgentAct" class="md-nav__link">
    <span class="md-ellipsis">
      ReportAgentAct
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ReportAgentAct">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.ReportAgentAct-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.ReportAgentAct.query" class="md-nav__link">
    <span class="md-ellipsis">
      query
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.ReportAgentAct.message" class="md-nav__link">
    <span class="md-ellipsis">
      message
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.ReportAgentAct.query_var_name" class="md-nav__link">
    <span class="md-ellipsis">
      query_var_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.ReportAgentAct.message_var_name" class="md-nav__link">
    <span class="md-ellipsis">
      message_var_name
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.ReportAgentAct-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.ReportAgentAct.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.ReportAgentAct.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      __repr__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.ReportAgentAct.__eq__" class="md-nav__link">
    <span class="md-ellipsis">
      __eq__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AskAgentAct" class="md-nav__link">
    <span class="md-ellipsis">
      AskAgentAct
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AskAgentAct">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AskAgentAct-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AskAgentAct.ws" class="md-nav__link">
    <span class="md-ellipsis">
      ws
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AskAgentAct.field" class="md-nav__link">
    <span class="md-ellipsis">
      field
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AskAgentAct.ws_name" class="md-nav__link">
    <span class="md-ellipsis">
      ws_name
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AskAgentAct-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AskAgentAct.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AskAgentAct.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      __repr__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.ProposeAgentAct" class="md-nav__link">
    <span class="md-ellipsis">
      ProposeAgentAct
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ProposeAgentAct">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.ProposeAgentAct-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.ProposeAgentAct.ws" class="md-nav__link">
    <span class="md-ellipsis">
      ws
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.ProposeAgentAct.params" class="md-nav__link">
    <span class="md-ellipsis">
      params
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.ProposeAgentAct.ws_name" class="md-nav__link">
    <span class="md-ellipsis">
      ws_name
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.ProposeAgentAct-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.ProposeAgentAct.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.ProposeAgentAct.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      __repr__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AskForConfirmationAgentAct" class="md-nav__link">
    <span class="md-ellipsis">
      AskForConfirmationAgentAct
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AskForConfirmationAgentAct">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AskForConfirmationAgentAct-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AskForConfirmationAgentAct.ws" class="md-nav__link">
    <span class="md-ellipsis">
      ws
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AskForConfirmationAgentAct.field" class="md-nav__link">
    <span class="md-ellipsis">
      field
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AskForConfirmationAgentAct.ws_name" class="md-nav__link">
    <span class="md-ellipsis">
      ws_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AskForConfirmationAgentAct.field_name" class="md-nav__link">
    <span class="md-ellipsis">
      field_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AskForConfirmationAgentAct.value" class="md-nav__link">
    <span class="md-ellipsis">
      value
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AskForConfirmationAgentAct-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AskForConfirmationAgentAct.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AskForConfirmationAgentAct.__repr__" class="md-nav__link">
    <span class="md-ellipsis">
      __repr__
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AgentActs" class="md-nav__link">
    <span class="md-ellipsis">
      AgentActs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AgentActs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AgentActs-attributes" class="md-nav__link">
    <span class="md-ellipsis">
      Attributes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AgentActs.args" class="md-nav__link">
    <span class="md-ellipsis">
      args
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AgentActs.actions" class="md-nav__link">
    <span class="md-ellipsis">
      actions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AgentActs-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AgentActs.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AgentActs.add" class="md-nav__link">
    <span class="md-ellipsis">
      add
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AgentActs._add" class="md-nav__link">
    <span class="md-ellipsis">
      _add
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AgentActs.should_add" class="md-nav__link">
    <span class="md-ellipsis">
      should_add
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AgentActs.extend" class="md-nav__link">
    <span class="md-ellipsis">
      extend
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AgentActs.__iter__" class="md-nav__link">
    <span class="md-ellipsis">
      __iter__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AgentActs.__next__" class="md-nav__link">
    <span class="md-ellipsis">
      __next__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.AgentActs.can_have_other_acts" class="md-nav__link">
    <span class="md-ellipsis">
      can_have_other_acts
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.validation_check" class="md-nav__link">
    <span class="md-ellipsis">
      validation_check
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.get_genie_fields_from_ws" class="md-nav__link">
    <span class="md-ellipsis">
      get_genie_fields_from_ws
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.execute_query" class="md-nav__link">
    <span class="md-ellipsis">
      execute_query
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.modify_action_code" class="md-nav__link">
    <span class="md-ellipsis">
      modify_action_code
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.eval_predicates" class="md-nav__link">
    <span class="md-ellipsis">
      eval_predicates
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.parse_single_predicate" class="md-nav__link">
    <span class="md-ellipsis">
      parse_single_predicate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.rewrite_action_code" class="md-nav__link">
    <span class="md-ellipsis">
      rewrite_action_code
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.same_field" class="md-nav__link">
    <span class="md-ellipsis">
      same_field
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.same_worksheet" class="md-nav__link">
    <span class="md-ellipsis">
      same_worksheet
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.count_number_of_vars" class="md-nav__link">
    <span class="md-ellipsis">
      count_number_of_vars
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.genie_deepcopy" class="md-nav__link">
    <span class="md-ellipsis">
      genie_deepcopy
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.get_field_variable_name" class="md-nav__link">
    <span class="md-ellipsis">
      get_field_variable_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.collect_all_parents" class="md-nav__link">
    <span class="md-ellipsis">
      collect_all_parents
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.find_all_variables_matching_name" class="md-nav__link">
    <span class="md-ellipsis">
      find_all_variables_matching_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.replace_undefined_variables" class="md-nav__link">
    <span class="md-ellipsis">
      replace_undefined_variables
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.variable_resolver" class="md-nav__link">
    <span class="md-ellipsis">
      variable_resolver
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.select_variable_from_list" class="md-nav__link">
    <span class="md-ellipsis">
      select_variable_from_list
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.get_variable_name" class="md-nav__link">
    <span class="md-ellipsis">
      get_variable_name
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.propose" class="md-nav__link">
    <span class="md-ellipsis">
      propose
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.say" class="md-nav__link">
    <span class="md-ellipsis">
      say
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.generate_clarification" class="md-nav__link">
    <span class="md-ellipsis">
      generate_clarification
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.answer_clarification_question" class="md-nav__link">
    <span class="md-ellipsis">
      answer_clarification_question
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.confirm" class="md-nav__link">
    <span class="md-ellipsis">
      confirm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.sanitize_dev_code" class="md-nav__link">
    <span class="md-ellipsis">
      sanitize_dev_code
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.any_open_empty_ws" class="md-nav__link">
    <span class="md-ellipsis">
      any_open_empty_ws
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.worksheets.environment.find_list_variable" class="md-nav__link">
    <span class="md-ellipsis">
      find_list_variable
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="environment">Environment</h1>


<div class="doc doc-object doc-module">



<h2 id="src.worksheets.environment" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">src.worksheets.environment</span>


</h2>

    <div class="doc doc-contents first">

        <p>Core environment module for Genie worksheets and runtime management.</p>
<p>This module provides the foundational classes and utilities for managing Genie worksheets,
including type handling, context management, and runtime execution. It implements the core
functionality for worksheet validation, action execution, and state management.</p>








  <div class="doc doc-children">






<h3 id="src.worksheets.environment-classes">Classes</h3>

<div class="doc doc-object doc-class">



<h4 id="src.worksheets.environment.GenieValue" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">GenieValue</span>


</h4>


    <div class="doc doc-contents ">


        <p>A class to represent a value in Genie.</p>
<p>This class wraps primitive values (string, int, float, etc.) with additional
functionality like confirmation status tracking.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieValue.value" href="#src.worksheets.environment.GenieValue.value">value</a></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The wrapped primitive value.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieValue.confirmed" href="#src.worksheets.environment.GenieValue.confirmed">confirmed</a></code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether this value has been confirmed by the user.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>src/worksheets/environment.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">GenieValue</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A class to represent a value in Genie.</span>

<span class="sd">    This class wraps primitive values (string, int, float, etc.) with additional</span>
<span class="sd">    functionality like confirmation status tracking.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        value: The wrapped primitive value.</span>
<span class="sd">        confirmed (bool): Whether this value has been confirmed by the user.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize a GenieValue.</span>

<span class="sd">        Args:</span>
<span class="sd">            value: The primitive value to wrap.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">confirmed</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">GenieValue</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">other</span>

    <span class="k">def</span> <span class="nf">confirm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">confirmed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mark the value as confirmed.</span>

<span class="sd">        Args:</span>
<span class="sd">            confirmed (bool, optional): Whether to mark as confirmed. Defaults to True.</span>

<span class="sd">        Returns:</span>
<span class="sd">            GenieValue: The confirmed value instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">confirmed</span> <span class="o">=</span> <span class="n">confirmed</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">





<h5 id="src.worksheets.environment.GenieValue-attributes">Attributes</h5>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieValue.value" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">value</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieValue.confirmed" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">confirmed</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">confirmed</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<h5 id="src.worksheets.environment.GenieValue-functions">Functions</h5>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieValue.__init__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__init__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__init__</span><span class="p">(</span><span class="nf">value</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Initialize a GenieValue.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>value</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The primitive value to wrap.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize a GenieValue.</span>

<span class="sd">    Args:</span>
<span class="sd">        value: The primitive value to wrap.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">confirmed</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieValue.__repr__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__repr__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__repr__</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">53</span>
<span class="normal">54</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieValue.__eq__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__eq__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__eq__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">GenieValue</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">other</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieValue.confirm" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">confirm</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">confirm</span><span class="p">(</span><span class="n">confirmed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Mark the value as confirmed.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>confirmed</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to mark as confirmed. Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>GenieValue</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The confirmed value instance.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">confirm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">confirmed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mark the value as confirmed.</span>

<span class="sd">    Args:</span>
<span class="sd">        confirmed (bool, optional): Whether to mark as confirmed. Defaults to True.</span>

<span class="sd">    Returns:</span>
<span class="sd">        GenieValue: The confirmed value instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">confirmed</span> <span class="o">=</span> <span class="n">confirmed</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieValue.__str__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__str__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__str__</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">75</span>
<span class="normal">76</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieValue.__hash__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__hash__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__hash__</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">78</span>
<span class="normal">79</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="src.worksheets.environment.GenieResult" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">GenieResult</span>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieValue" href="#src.worksheets.environment.GenieValue">GenieValue</a></code></p>


        <p>A class to represent results from executions.</p>
<p>This class extends GenieValue to store results from Answer executions or
other actions, maintaining references to parent objects.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieResult.value" href="#src.worksheets.environment.GenieResult.value">value</a></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The result value.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieResult.parent" href="#src.worksheets.environment.GenieResult.parent">parent</a></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The parent object that produced this result.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieResult.parent_var_name" href="#src.worksheets.environment.GenieResult.parent_var_name">parent_var_name</a></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The variable name of the parent in the context.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>src/worksheets/environment.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">GenieResult</span><span class="p">(</span><span class="n">GenieValue</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A class to represent results from executions.</span>

<span class="sd">    This class extends GenieValue to store results from Answer executions or</span>
<span class="sd">    other actions, maintaining references to parent objects.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        value: The result value.</span>
<span class="sd">        parent: The parent object that produced this result.</span>
<span class="sd">        parent_var_name: The variable name of the parent in the context.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">parent_var_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize a GenieResult.</span>

<span class="sd">        Args:</span>
<span class="sd">            value: The result value.</span>
<span class="sd">            parent: The parent object that produced this result.</span>
<span class="sd">            parent_var_name: The variable name of the parent in the context.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent_var_name</span> <span class="o">=</span> <span class="n">parent_var_name</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">





<h5 id="src.worksheets.environment.GenieResult-attributes">Attributes</h5>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieResult.value" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">value</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieResult.confirmed" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">confirmed</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">confirmed</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieResult.parent" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">parent</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieResult.parent_var_name" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">parent_var_name</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">parent_var_name</span> <span class="o">=</span> <span class="n">parent_var_name</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<h5 id="src.worksheets.environment.GenieResult-functions">Functions</h5>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieResult.__repr__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__repr__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__repr__</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">53</span>
<span class="normal">54</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieResult.__eq__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__eq__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__eq__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">GenieValue</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">other</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieResult.confirm" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">confirm</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">confirm</span><span class="p">(</span><span class="n">confirmed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Mark the value as confirmed.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>confirmed</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to mark as confirmed. Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>GenieValue</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The confirmed value instance.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">confirm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">confirmed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mark the value as confirmed.</span>

<span class="sd">    Args:</span>
<span class="sd">        confirmed (bool, optional): Whether to mark as confirmed. Defaults to True.</span>

<span class="sd">    Returns:</span>
<span class="sd">        GenieValue: The confirmed value instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">confirmed</span> <span class="o">=</span> <span class="n">confirmed</span>
    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieResult.__str__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__str__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__str__</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">75</span>
<span class="normal">76</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieResult.__hash__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__hash__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__hash__</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">78</span>
<span class="normal">79</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieResult.__init__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__init__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__init__</span><span class="p">(</span><span class="nf">value</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">parent_var_name</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Initialize a GenieResult.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>value</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The result value.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>parent</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The parent object that produced this result.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>parent_var_name</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The variable name of the parent in the context.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">parent_var_name</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize a GenieResult.</span>

<span class="sd">    Args:</span>
<span class="sd">        value: The result value.</span>
<span class="sd">        parent: The parent object that produced this result.</span>
<span class="sd">        parent_var_name: The variable name of the parent in the context.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parent_var_name</span> <span class="o">=</span> <span class="n">parent_var_name</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieResult.__getitem__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__getitem__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__getitem__</span><span class="p">(</span><span class="nf">item</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">106</span>
<span class="normal">107</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="src.worksheets.environment.GenieREPR" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">GenieREPR</span>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>type</code></p>


        <p>A metaclass to customize string representation of Genie classes.</p>
<p>This metaclass provides custom string representation for classes that use it,
maintaining ordered attributes and generating schema representations.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.worksheets.environment.GenieREPR._ordered_attributes">_ordered_attributes</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of ordered attribute names for the class.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>src/worksheets/environment.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">GenieREPR</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A metaclass to customize string representation of Genie classes.</span>

<span class="sd">    This metaclass provides custom string representation for classes that use it,</span>
<span class="sd">    maintaining ordered attributes and generating schema representations.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        _ordered_attributes: List of ordered attribute names for the class.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">dct</span><span class="p">):</span>
        <span class="n">new_class</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">dct</span><span class="p">)</span>
        <span class="c1"># Store the ordered attributes, these are used for asking questions in the order they are defined</span>
        <span class="n">new_class</span><span class="o">.</span><span class="n">_ordered_attributes</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dct</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">new_class</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
            <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">schema</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">param</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">param</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">parameters</span><span class="p">])</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="k">def</span> <span class="nf">get_semantic_parser_schema</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s2">&quot;predicate&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">predicate</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">or</span> <span class="bp">cls</span><span class="o">.</span><span class="n">predicate</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">field</span><span class="o">.</span><span class="n">internal</span><span class="p">:</span>
                    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">schema</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">repr</span><span class="p">(</span><span class="n">param</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">param</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">parameters</span><span class="p">])</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<h5 id="src.worksheets.environment.GenieREPR-functions">Functions</h5>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieREPR.__new__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__new__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__new__</span><span class="p">(</span><span class="nf">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">dct</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">dct</span><span class="p">):</span>
    <span class="n">new_class</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">dct</span><span class="p">)</span>
    <span class="c1"># Store the ordered attributes, these are used for asking questions in the order they are defined</span>
    <span class="n">new_class</span><span class="o">.</span><span class="n">_ordered_attributes</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dct</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">new_class</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieREPR.__repr__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__repr__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__repr__</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">schema</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">param</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">param</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">parameters</span><span class="p">])</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieREPR.get_semantic_parser_schema" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_semantic_parser_schema</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_semantic_parser_schema</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_semantic_parser_schema</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s2">&quot;predicate&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">predicate</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">or</span> <span class="bp">cls</span><span class="o">.</span><span class="n">predicate</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">field</span><span class="o">.</span><span class="n">internal</span><span class="p">:</span>
                <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">schema</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">repr</span><span class="p">(</span><span class="n">param</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">param</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">parameters</span><span class="p">])</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="src.worksheets.environment.GenieField" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">GenieField</span>


</h4>


    <div class="doc doc-contents ">


        <p>A class representing a field in a Genie worksheet.</p>
<p>This class handles field definitions, validation, and value management for
worksheet fields. It supports various field types, validation rules, and
action triggers.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieField.slottype" href="#src.worksheets.environment.GenieField.slottype">slottype</a></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The type of the field.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieField.name" href="#src.worksheets.environment.GenieField.name">name</a></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The field name.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieField.question" href="#src.worksheets.environment.GenieField.question">question</a></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Question to ask when field needs filling.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieField.description" href="#src.worksheets.environment.GenieField.description">description</a></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Field description for LLM understanding.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieField.predicate" href="#src.worksheets.environment.GenieField.predicate">predicate</a></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Condition for field relevance.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieField.ask" href="#src.worksheets.environment.GenieField.ask">ask</a></code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to ask user for this field.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieField.optional" href="#src.worksheets.environment.GenieField.optional">optional</a></code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether field is optional.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieField.actions" href="#src.worksheets.environment.GenieField.actions">actions</a></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Actions to perform when field is filled.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieField.requires_confirmation" href="#src.worksheets.environment.GenieField.requires_confirmation">requires_confirmation</a></code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether field needs confirmation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieField.internal" href="#src.worksheets.environment.GenieField.internal">internal</a></code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether field is system-managed.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieField.primary_key" href="#src.worksheets.environment.GenieField.primary_key">primary_key</a></code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether field is a primary key.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieField.validation" href="#src.worksheets.environment.GenieField.validation">validation</a></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Validation criteria.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieField.parent" href="#src.worksheets.environment.GenieField.parent">parent</a></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parent worksheet.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieField.bot" href="#src.worksheets.environment.GenieField.bot">bot</a></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Associated bot instance.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>src/worksheets/environment.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">GenieField</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A class representing a field in a Genie worksheet.</span>

<span class="sd">    This class handles field definitions, validation, and value management for</span>
<span class="sd">    worksheet fields. It supports various field types, validation rules, and</span>
<span class="sd">    action triggers.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        slottype (str): The type of the field.</span>
<span class="sd">        name (str): The field name.</span>
<span class="sd">        question (str): Question to ask when field needs filling.</span>
<span class="sd">        description (str): Field description for LLM understanding.</span>
<span class="sd">        predicate (str): Condition for field relevance.</span>
<span class="sd">        ask (bool): Whether to ask user for this field.</span>
<span class="sd">        optional (bool): Whether field is optional.</span>
<span class="sd">        actions: Actions to perform when field is filled.</span>
<span class="sd">        requires_confirmation (bool): Whether field needs confirmation.</span>
<span class="sd">        internal (bool): Whether field is system-managed.</span>
<span class="sd">        primary_key (bool): Whether field is a primary key.</span>
<span class="sd">        validation (str): Validation criteria.</span>
<span class="sd">        parent: Parent worksheet.</span>
<span class="sd">        bot: Associated bot instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="c1"># The type of the slot, e.g., str, int, etc.</span>
        <span class="n">slottype</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="c1"># The name of the field (variable name)</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="c1"># The question to ask the user if the field is not filled</span>
        <span class="n">question</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="c1"># A description of the field. This is provided to the LLM for better understanding.</span>
        <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="c1"># A predicate to determine if the field should be filled</span>
        <span class="n">predicate</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="c1"># Whether to ask the user for this field</span>
        <span class="n">ask</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="c1"># Whether this field is optional</span>
        <span class="n">optional</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="c1"># Any actions to perform when this field is filled</span>
        <span class="n">actions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="c1"># The initial value of the field</span>
        <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="c1"># Whether this field requires confirmation</span>
        <span class="n">requires_confirmation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="c1"># Whether this field is internal (not shown to the user and filled by the system)</span>
        <span class="n">internal</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="c1"># Whether this field is a primary key. Used for database Worksheets.</span>
        <span class="n">primary_key</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="c1"># Whether this field has been confirmed by the user</span>
        <span class="n">confirmed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="c1"># Any validation criteria for this field</span>
        <span class="n">validation</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="c1"># The parent worksheet</span>
        <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="c1"># The bot instance (GenieRuntime)</span>
        <span class="n">bot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="c1"># Whether an action has been performed for this field</span>
        <span class="n">action_performed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">predicate</span> <span class="o">=</span> <span class="n">predicate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slottype</span> <span class="o">=</span> <span class="n">slottype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">question</span> <span class="o">=</span> <span class="n">question</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ask</span> <span class="o">=</span> <span class="n">ask</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optional</span> <span class="o">=</span> <span class="n">optional</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ask</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">optional</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actions</span> <span class="o">=</span> <span class="n">actions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requires_confirmation</span> <span class="o">=</span> <span class="n">requires_confirmation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">internal</span> <span class="o">=</span> <span class="n">internal</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span> <span class="o">=</span> <span class="n">primary_key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validation</span> <span class="o">=</span> <span class="n">validation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bot</span> <span class="o">=</span> <span class="n">bot</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">action_performed</span> <span class="o">=</span> <span class="n">action_performed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_confirmed</span> <span class="o">=</span> <span class="n">confirmed</span>

    <span class="k">def</span> <span class="nf">__deepcopy__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memo</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">GenieField</span><span class="p">(</span>
            <span class="n">slottype</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slottype</span><span class="p">,</span> <span class="n">memo</span><span class="p">),</span>
            <span class="n">name</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">memo</span><span class="p">),</span>
            <span class="n">question</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">question</span><span class="p">,</span> <span class="n">memo</span><span class="p">),</span>
            <span class="n">description</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">memo</span><span class="p">),</span>
            <span class="n">predicate</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predicate</span><span class="p">,</span> <span class="n">memo</span><span class="p">),</span>
            <span class="n">ask</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ask</span><span class="p">,</span> <span class="n">memo</span><span class="p">),</span>
            <span class="n">optional</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optional</span><span class="p">,</span> <span class="n">memo</span><span class="p">),</span>
            <span class="n">actions</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">,</span> <span class="n">memo</span><span class="p">),</span>
            <span class="n">value</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">memo</span><span class="p">),</span>
            <span class="n">requires_confirmation</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">requires_confirmation</span><span class="p">,</span> <span class="n">memo</span><span class="p">),</span>
            <span class="n">internal</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">internal</span><span class="p">,</span> <span class="n">memo</span><span class="p">),</span>
            <span class="n">primary_key</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="p">,</span> <span class="n">memo</span><span class="p">),</span>
            <span class="n">confirmed</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">confirmed</span><span class="p">,</span> <span class="n">memo</span><span class="p">),</span>
            <span class="n">validation</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">validation</span><span class="p">,</span> <span class="n">memo</span><span class="p">),</span>
            <span class="n">action_performed</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">action_performed</span><span class="p">,</span> <span class="n">memo</span><span class="p">),</span>
            <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span>
            <span class="n">bot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">perform_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">,</span> <span class="n">local_context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform the action associated with this field if it hasn&#39;t been performed yet.</span>

<span class="sd">        Args:</span>
<span class="sd">            bot (GenieRuntime): The bot instance.</span>
<span class="sd">            local_context (GenieContext): The local context for the action.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: A list of actions performed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_performed</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Peforming action for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">action</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">acts</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># If there are no actions, return an empty list</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">acts</span>

        <span class="c1"># Perform the action</span>
        <span class="n">acts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">perform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bot</span><span class="p">,</span> <span class="n">local_context</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action_performed</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="n">acts</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a schema representation of the field.</span>

<span class="sd">        Args:</span>
<span class="sd">            value (bool, optional): Whether to include the value in the schema. Defaults to True.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The schema representation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Getting the type of sources_type as a string</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slottype</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">slottype</span> <span class="o">==</span> <span class="s2">&quot;confirm&quot;</span><span class="p">:</span>
            <span class="n">slottype</span> <span class="o">=</span> <span class="s2">&quot;bool&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">slottype</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;List&quot;</span><span class="p">,</span> <span class="s2">&quot;Dict&quot;</span><span class="p">]:</span>
            <span class="n">slottype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slottype</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s2">&quot;[&quot;</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slottype</span><span class="o">.</span><span class="n">__args__</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">slottype</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slottype</span><span class="o">.</span><span class="n">__args__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">slottype</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slottype</span><span class="o">.</span><span class="n">__args__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="vm">__name__</span>
            <span class="n">slottype</span> <span class="o">+=</span> <span class="s2">&quot;]&quot;</span>
        <span class="c1"># Special case for enums</span>
        <span class="k">elif</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slottype</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slottype</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
            <span class="n">options</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">slottype</span><span class="p">])</span>
            <span class="n">slottype</span> <span class="o">=</span> <span class="s2">&quot;Enum[&quot;</span> <span class="o">+</span> <span class="n">options</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">slottype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slottype</span><span class="o">.</span><span class="vm">__name__</span>

        <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="s2">&quot;None&quot;</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="s1">&#39;&quot;&quot;&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">slottype</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">slottype</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="nf">schema_without_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">no_none</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a schema representation of the field without type information.</span>

<span class="sd">        Args:</span>
<span class="sd">            no_none (bool, optional): Whether to exclude None values. Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The schema representation without type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="s1">&#39;&quot;&quot;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">val</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>

        <span class="k">if</span> <span class="n">no_none</span> <span class="ow">and</span> <span class="n">val</span> <span class="o">==</span> <span class="s2">&quot;None&quot;</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">confirmed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_value&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">,</span> <span class="n">GenieValue</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="o">.</span><span class="n">confirmed</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_confirmed</span>

    <span class="nd">@confirmed</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">confirmed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">confirmed</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_confirmed</span> <span class="o">=</span> <span class="n">confirmed</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">,</span> <span class="n">GenieValue</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="o">.</span><span class="n">value</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span>

    <span class="nd">@value</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action_performed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">init_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize a field value with proper validation and wrapping.</span>

<span class="sd">        Args:</span>
<span class="sd">            value (Any): The value to initialize.</span>

<span class="sd">        Returns:</span>
<span class="sd">            GenieValue: The initialized value, or None if validation fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">previous_action_contains_confirm</span><span class="p">():</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Only allow confirmation if the previous action was a confirmation action.&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">dlg_history</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">dlg_history</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">dlg_history</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">system_action</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">dlg_history</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">system_action</span><span class="o">.</span><span class="n">actions</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">act</span><span class="p">,</span> <span class="n">AskAgentAct</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">act</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">slottype</span> <span class="o">==</span> <span class="s2">&quot;confirm&quot;</span><span class="p">:</span>
                                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># TODO: If the value is set by the user for internal field, then do not assign.</span>
        <span class="c1"># if done by the system, then assign.</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">or</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">slottype</span> <span class="o">==</span> <span class="s2">&quot;confirm&quot;</span><span class="p">:</span>
                <span class="n">prev_confirm</span> <span class="o">=</span> <span class="n">previous_action_contains_confirm</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">prev_confirm</span><span class="p">:</span>
                    <span class="k">return</span>

            <span class="n">valid</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation</span><span class="p">:</span>
                <span class="c1"># Use LLM to check if the value is valid based on the validation rule</span>
                <span class="n">matches_criteria</span><span class="p">,</span> <span class="n">reason</span> <span class="o">=</span> <span class="n">validation_check</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">matches_criteria</span><span class="p">:</span>
                    <span class="c1"># If the validation fails, use the original value, log the error and set valid to False</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">GenieValue</span><span class="p">):</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">value</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">agent_acts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                        <span class="n">ReportAgentAct</span><span class="p">(</span>
                            <span class="n">query</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Invalid value for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">reason</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="n">valid</span><span class="p">:</span>
                <span class="c1"># If the value is valid, create a GenieValue instance</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">GenieValue</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">value</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">GenieValue</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="c1"># For equality check, we compare the name and value of the fields</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">GenieField</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">





<h5 id="src.worksheets.environment.GenieField-attributes">Attributes</h5>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieField.predicate" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">predicate</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">predicate</span> <span class="o">=</span> <span class="n">predicate</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieField.slottype" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">slottype</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">slottype</span> <span class="o">=</span> <span class="n">slottype</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieField.name" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">name</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieField.question" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">question</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">question</span> <span class="o">=</span> <span class="n">question</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieField.ask" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">ask</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">ask</span> <span class="o">=</span> <span class="n">ask</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieField.optional" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">optional</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">optional</span> <span class="o">=</span> <span class="n">optional</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieField.actions" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">actions</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">actions</span> <span class="o">=</span> <span class="n">actions</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieField.requires_confirmation" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">requires_confirmation</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">requires_confirmation</span> <span class="o">=</span> <span class="n">requires_confirmation</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieField.internal" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">internal</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">internal</span> <span class="o">=</span> <span class="n">internal</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieField.description" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">description</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieField.primary_key" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">primary_key</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">primary_key</span> <span class="o">=</span> <span class="n">primary_key</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieField.validation" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">validation</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">validation</span> <span class="o">=</span> <span class="n">validation</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieField.parent" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">parent</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieField.bot" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">bot</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">bot</span> <span class="o">=</span> <span class="n">bot</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieField.action_performed" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">action_performed</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">action_performed</span> <span class="o">=</span> <span class="n">action_performed</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieField._value" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">_value</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">_value</span> <span class="o">=</span> <span class="n">init_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieField._confirmed" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">_confirmed</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">_confirmed</span> <span class="o">=</span> <span class="n">confirmed</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieField.confirmed" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">confirmed</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
      <small class="doc doc-label doc-label-writable"><code>writable</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">confirmed</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieField.value" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">value</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
      <small class="doc doc-label doc-label-writable"><code>writable</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">value</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<h5 id="src.worksheets.environment.GenieField-functions">Functions</h5>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieField.__init__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__init__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__init__</span><span class="p">(</span><span class="nf">slottype</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">question</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">predicate</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ask</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">optional</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">actions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">requires_confirmation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">internal</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">primary_key</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">confirmed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">validation</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">action_performed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="c1"># The type of the slot, e.g., str, int, etc.</span>
    <span class="n">slottype</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="c1"># The name of the field (variable name)</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="c1"># The question to ask the user if the field is not filled</span>
    <span class="n">question</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="c1"># A description of the field. This is provided to the LLM for better understanding.</span>
    <span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="c1"># A predicate to determine if the field should be filled</span>
    <span class="n">predicate</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="c1"># Whether to ask the user for this field</span>
    <span class="n">ask</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="c1"># Whether this field is optional</span>
    <span class="n">optional</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="c1"># Any actions to perform when this field is filled</span>
    <span class="n">actions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="c1"># The initial value of the field</span>
    <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="c1"># Whether this field requires confirmation</span>
    <span class="n">requires_confirmation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="c1"># Whether this field is internal (not shown to the user and filled by the system)</span>
    <span class="n">internal</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="c1"># Whether this field is a primary key. Used for database Worksheets.</span>
    <span class="n">primary_key</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="c1"># Whether this field has been confirmed by the user</span>
    <span class="n">confirmed</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="c1"># Any validation criteria for this field</span>
    <span class="n">validation</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="c1"># The parent worksheet</span>
    <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="c1"># The bot instance (GenieRuntime)</span>
    <span class="n">bot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="c1"># Whether an action has been performed for this field</span>
    <span class="n">action_performed</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">predicate</span> <span class="o">=</span> <span class="n">predicate</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">slottype</span> <span class="o">=</span> <span class="n">slottype</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">question</span> <span class="o">=</span> <span class="n">question</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ask</span> <span class="o">=</span> <span class="n">ask</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">optional</span> <span class="o">=</span> <span class="n">optional</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ask</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">optional</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">actions</span> <span class="o">=</span> <span class="n">actions</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">requires_confirmation</span> <span class="o">=</span> <span class="n">requires_confirmation</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">internal</span> <span class="o">=</span> <span class="n">internal</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span> <span class="o">=</span> <span class="n">primary_key</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">validation</span> <span class="o">=</span> <span class="n">validation</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bot</span> <span class="o">=</span> <span class="n">bot</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">action_performed</span> <span class="o">=</span> <span class="n">action_performed</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_confirmed</span> <span class="o">=</span> <span class="n">confirmed</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieField.__deepcopy__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__deepcopy__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__deepcopy__</span><span class="p">(</span><span class="n">memo</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">__deepcopy__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memo</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">GenieField</span><span class="p">(</span>
        <span class="n">slottype</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slottype</span><span class="p">,</span> <span class="n">memo</span><span class="p">),</span>
        <span class="n">name</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">memo</span><span class="p">),</span>
        <span class="n">question</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">question</span><span class="p">,</span> <span class="n">memo</span><span class="p">),</span>
        <span class="n">description</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">memo</span><span class="p">),</span>
        <span class="n">predicate</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">predicate</span><span class="p">,</span> <span class="n">memo</span><span class="p">),</span>
        <span class="n">ask</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ask</span><span class="p">,</span> <span class="n">memo</span><span class="p">),</span>
        <span class="n">optional</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">optional</span><span class="p">,</span> <span class="n">memo</span><span class="p">),</span>
        <span class="n">actions</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">,</span> <span class="n">memo</span><span class="p">),</span>
        <span class="n">value</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">memo</span><span class="p">),</span>
        <span class="n">requires_confirmation</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">requires_confirmation</span><span class="p">,</span> <span class="n">memo</span><span class="p">),</span>
        <span class="n">internal</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">internal</span><span class="p">,</span> <span class="n">memo</span><span class="p">),</span>
        <span class="n">primary_key</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">primary_key</span><span class="p">,</span> <span class="n">memo</span><span class="p">),</span>
        <span class="n">confirmed</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">confirmed</span><span class="p">,</span> <span class="n">memo</span><span class="p">),</span>
        <span class="n">validation</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">validation</span><span class="p">,</span> <span class="n">memo</span><span class="p">),</span>
        <span class="n">action_performed</span><span class="o">=</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">action_performed</span><span class="p">,</span> <span class="n">memo</span><span class="p">),</span>
        <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span>
        <span class="n">bot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieField.perform_action" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">perform_action</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">perform_action</span><span class="p">(</span><span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">,</span> <span class="n">local_context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Perform the action associated with this field if it hasn't been performed yet.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bot</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieRuntime" href="#src.worksheets.environment.GenieRuntime">GenieRuntime</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The bot instance.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>local_context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieContext" href="#src.worksheets.environment.GenieContext">GenieContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The local context for the action.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>list</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of actions performed.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">perform_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">,</span> <span class="n">local_context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform the action associated with this field if it hasn&#39;t been performed yet.</span>

<span class="sd">    Args:</span>
<span class="sd">        bot (GenieRuntime): The bot instance.</span>
<span class="sd">        local_context (GenieContext): The local context for the action.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: A list of actions performed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_performed</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Peforming action for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">action</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">acts</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># If there are no actions, return an empty list</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">acts</span>

    <span class="c1"># Perform the action</span>
    <span class="n">acts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">perform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bot</span><span class="p">,</span> <span class="n">local_context</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">action_performed</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="n">acts</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieField.__repr__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__repr__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__repr__</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">309</span>
<span class="normal">310</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieField.schema" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">schema</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">schema</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Generate a schema representation of the field.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>value</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to include the value in the schema. Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The schema representation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a schema representation of the field.</span>

<span class="sd">    Args:</span>
<span class="sd">        value (bool, optional): Whether to include the value in the schema. Defaults to True.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The schema representation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Getting the type of sources_type as a string</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slottype</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">slottype</span> <span class="o">==</span> <span class="s2">&quot;confirm&quot;</span><span class="p">:</span>
        <span class="n">slottype</span> <span class="o">=</span> <span class="s2">&quot;bool&quot;</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">slottype</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;List&quot;</span><span class="p">,</span> <span class="s2">&quot;Dict&quot;</span><span class="p">]:</span>
        <span class="n">slottype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slottype</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s2">&quot;[&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slottype</span><span class="o">.</span><span class="n">__args__</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">slottype</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slottype</span><span class="o">.</span><span class="n">__args__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">slottype</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slottype</span><span class="o">.</span><span class="n">__args__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="n">slottype</span> <span class="o">+=</span> <span class="s2">&quot;]&quot;</span>
    <span class="c1"># Special case for enums</span>
    <span class="k">elif</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slottype</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slottype</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
        <span class="n">options</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">slottype</span><span class="p">])</span>
        <span class="n">slottype</span> <span class="o">=</span> <span class="s2">&quot;Enum[&quot;</span> <span class="o">+</span> <span class="n">options</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">slottype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slottype</span><span class="o">.</span><span class="vm">__name__</span>

    <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="s2">&quot;None&quot;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="s1">&#39;&quot;&quot;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">slottype</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">slottype</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieField.schema_without_type" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">schema_without_type</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">schema_without_type</span><span class="p">(</span><span class="n">no_none</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Generate a schema representation of the field without type information.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>no_none</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to exclude None values. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The schema representation without type.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">schema_without_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">no_none</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a schema representation of the field without type information.</span>

<span class="sd">    Args:</span>
<span class="sd">        no_none (bool, optional): Whether to exclude None values. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The schema representation without type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">val</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="n">val</span> <span class="o">=</span> <span class="s1">&#39;&quot;&quot;&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">val</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>

    <span class="k">if</span> <span class="n">no_none</span> <span class="ow">and</span> <span class="n">val</span> <span class="o">==</span> <span class="s2">&quot;None&quot;</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">val</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieField.init_value" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">init_value</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">init_value</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Initialize a field value with proper validation and wrapping.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>value</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The value to initialize.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>GenieValue</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The initialized value, or None if validation fails.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">init_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize a field value with proper validation and wrapping.</span>

<span class="sd">    Args:</span>
<span class="sd">        value (Any): The value to initialize.</span>

<span class="sd">    Returns:</span>
<span class="sd">        GenieValue: The initialized value, or None if validation fails.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">previous_action_contains_confirm</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Only allow confirmation if the previous action was a confirmation action.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">dlg_history</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">dlg_history</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">dlg_history</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">system_action</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">dlg_history</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">system_action</span><span class="o">.</span><span class="n">actions</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">act</span><span class="p">,</span> <span class="n">AskAgentAct</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">act</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">slottype</span> <span class="o">==</span> <span class="s2">&quot;confirm&quot;</span><span class="p">:</span>
                            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># TODO: If the value is set by the user for internal field, then do not assign.</span>
    <span class="c1"># if done by the system, then assign.</span>
    <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">or</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">slottype</span> <span class="o">==</span> <span class="s2">&quot;confirm&quot;</span><span class="p">:</span>
            <span class="n">prev_confirm</span> <span class="o">=</span> <span class="n">previous_action_contains_confirm</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">prev_confirm</span><span class="p">:</span>
                <span class="k">return</span>

        <span class="n">valid</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation</span><span class="p">:</span>
            <span class="c1"># Use LLM to check if the value is valid based on the validation rule</span>
            <span class="n">matches_criteria</span><span class="p">,</span> <span class="n">reason</span> <span class="o">=</span> <span class="n">validation_check</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">validation</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">matches_criteria</span><span class="p">:</span>
                <span class="c1"># If the validation fails, use the original value, log the error and set valid to False</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">GenieValue</span><span class="p">):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">value</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">agent_acts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                    <span class="n">ReportAgentAct</span><span class="p">(</span>
                        <span class="n">query</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Invalid value for </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">reason</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="n">valid</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">valid</span><span class="p">:</span>
            <span class="c1"># If the value is valid, create a GenieValue instance</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">GenieValue</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">GenieValue</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieField.__eq__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__eq__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__eq__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="c1"># For equality check, we compare the name and value of the fields</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">GenieField</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">name</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="src.worksheets.environment.GenieWorksheet" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">GenieWorksheet</span>


</h4>


    <div class="doc doc-contents ">


        <p>Base class for Genie worksheets.</p>
<p>This class provides the foundation for defining worksheets with fields,
actions, and state management. It handles initialization, field management,
and action execution.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieWorksheet.action_performed" href="#src.worksheets.environment.GenieWorksheet.action_performed">action_performed</a></code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether worksheet actions have been executed.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieWorksheet.result" href="#src.worksheets.environment.GenieWorksheet.result">result</a></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The result of worksheet execution.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieWorksheet.random_id" href="#src.worksheets.environment.GenieWorksheet.random_id">random_id</a></code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique identifier for the worksheet instance.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>src/worksheets/environment.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">GenieWorksheet</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">GenieREPR</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for Genie worksheets.</span>

<span class="sd">    This class provides the foundation for defining worksheets with fields,</span>
<span class="sd">    actions, and state management. It handles initialization, field management,</span>
<span class="sd">    and action execution.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        action_performed (bool): Whether worksheet actions have been executed.</span>
<span class="sd">        result: The result of worksheet execution.</span>
<span class="sd">        random_id (int): Unique identifier for the worksheet instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action_performed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">random_id</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Since the user doesn&#39;t initialize the fields, we need to do it for them</span>
        <span class="c1"># first, we go over all the GenieFields in the class</span>
        <span class="c1"># then, we create a params dict with all the fields in the GenieField</span>
        <span class="c1"># finally, we check if the user has passed in a value for any GenieField</span>
        <span class="c1"># if they have, we set the value of the GenieField to the value passed in</span>
        <span class="c1"># and then we set the attribute of the class to the GenieField</span>
        <span class="k">for</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attr_value</span><span class="p">,</span> <span class="n">GenieField</span><span class="p">):</span>
                <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="n">field</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">attr_value</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">attr_value</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">field</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="c1"># if the user has passed in a value for the GenieField, set it</span>
                <span class="c1"># eg. Book(booking_id=125)</span>
                <span class="c1"># then the user has passed in a value for booking_id</span>
                <span class="c1"># attr_name is all the GenieFields in the class</span>
                <span class="c1"># kwargs is all the values the user has passed in (like booking_id=125)</span>
                <span class="k">if</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                    <span class="n">params</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">attr_name</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">if</span> <span class="s2">&quot;optional&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;optional&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;NA&quot;</span><span class="p">:</span>
                        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">GenieField</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">perform_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">,</span> <span class="n">local_context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform the action associated with this worksheet if it hasn&#39;t been performed yet.</span>

<span class="sd">        Args:</span>
<span class="sd">            bot (GenieRuntime): The bot instance.</span>
<span class="sd">            local_context (GenieContext): The local context for the action.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: A list of actions performed.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_performed</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="n">acts</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">acts</span>

        <span class="n">acts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">perform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bot</span><span class="p">,</span> <span class="n">local_context</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action_performed</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="n">acts</span>

    <span class="k">def</span> <span class="nf">is_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the worksheet is complete by evaluating all fields.</span>

<span class="sd">        Args:</span>
<span class="sd">            bot (GenieRuntime): The bot instance.</span>
<span class="sd">            context (GenieContext): The context for evaluation.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the worksheet is complete, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">eval_predicates</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">predicate</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">bot</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">GenieWorksheet</span><span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">is_complete</span><span class="p">(</span><span class="n">bot</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
                        <span class="k">return</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">field</span><span class="o">.</span><span class="n">optional</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>

                <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">requires_confirmation</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">field</span><span class="o">.</span><span class="n">confirmed</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">GenieField</span><span class="p">):</span>
                <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">repr</span><span class="p">(</span><span class="n">param</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">param</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">parameters</span><span class="p">])</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="k">def</span> <span class="nf">schema_without_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a schema representation of the worksheet without type information.</span>

<span class="sd">        Args:</span>
<span class="sd">            context (GenieContext): The context for the worksheet.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The schema representation without type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">confirmed</span><span class="p">:</span>
                    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = confirmed(</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">_value</span><span class="p">,</span> <span class="n">GenieResult</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">parent_var_name</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="n">indices</span> <span class="o">=</span> <span class="p">[]</span>

                    <span class="n">result_strings</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">GenieType</span><span class="p">):</span>
                            <span class="n">var_name</span><span class="p">,</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">find_list_variable</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">var_name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">idx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">result_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">if</span> <span class="p">(</span>
                                    <span class="n">parent_var_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                                    <span class="ow">and</span> <span class="n">parent_var_name</span> <span class="o">!=</span> <span class="n">var_name</span>
                                <span class="p">):</span>
                                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                                        <span class="s2">&quot;Cannot handle multiple list variables in the same answer&quot;</span>
                                    <span class="p">)</span>
                                <span class="n">parent_var_name</span> <span class="o">=</span> <span class="n">var_name</span>  <span class="c1"># Ignoring any potential multiple list variables</span>

                                <span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">result_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">parent_var_name</span><span class="p">:</span>
                        <span class="n">indices_str</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
                            <span class="n">indices_str</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent_var_name</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>

                        <span class="n">result_strings</span> <span class="o">=</span> <span class="s2">&quot;[&quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">indices_str</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result_strings</span><span class="p">):</span>
                    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">result_strings</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># TODO: Instead of getting the var_name from paren, we should search and find the same type of answer from the context</span>
                    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">GenieType</span><span class="p">):</span>
                <span class="c1"># This should be straight forward, same as the one above</span>
                <span class="n">var_name</span><span class="p">,</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">find_list_variable</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">var_name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">idx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">confirmed</span><span class="p">:</span>
                        <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = confirmed(</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">confirmed</span><span class="p">:</span>
                        <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = confirmed(</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">])&quot;</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">var_name</span> <span class="o">=</span> <span class="n">get_variable_name</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">confirmed</span><span class="p">:</span>
                        <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = confirmed(</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">schema_without_type</span><span class="p">(</span><span class="n">no_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">val</span><span class="p">:</span>
                        <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">param</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">param</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">parameters</span><span class="p">])</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">,</span> <span class="n">local_context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute the actions associated with this worksheet.</span>

<span class="sd">        Args:</span>
<span class="sd">            bot (GenieRuntime): The bot instance.</span>
<span class="sd">            local_context (GenieContext): The local context for execution.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parameters</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;= &quot;</span> <span class="o">+</span> <span class="s2">&quot;self.&quot;</span> <span class="o">+</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend_api</span> <span class="o">+</span> <span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
        <span class="n">var_name</span> <span class="o">=</span> <span class="n">get_variable_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">local_context</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">GenieResult</span><span class="p">(</span>
            <span class="n">execute_query</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">bot</span><span class="p">,</span> <span class="n">local_context</span><span class="p">),</span> <span class="bp">self</span><span class="p">,</span> <span class="n">var_name</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">agent_acts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
            <span class="n">ReportAgentAct</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">var_name</span> <span class="o">+</span> <span class="s2">&quot;.result&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action_performed</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># local_context.context[</span>
        <span class="c1">#     f&quot;{generate_var_name(self.__class__.__name__)}_result&quot;</span>
        <span class="c1"># ] = self.result</span>

    <span class="c1"># This might give me some troubles since we are already using .value at certain places.</span>
    <span class="c1"># def __getattr__(self, name):</span>
    <span class="c1">#     for field in get_genie_fields_from_ws(self):</span>
    <span class="c1">#         if field.name == name:</span>
    <span class="c1">#             return field.value</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">new</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">initialize_from_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">initialize_from_dict</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">GenieField</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">action_performed</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="c1"># if the worksheet has a confirm type field which is set to true</span>
                <span class="c1"># upon update, we need to set it to false</span>
                <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">slottype</span> <span class="o">==</span> <span class="s2">&quot;confirm&quot;</span> <span class="ow">and</span> <span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">GenieField</span><span class="p">)</span> <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                    <span class="n">value</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span>
                    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                    <span class="k">return</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">GenieValue</span><span class="p">):</span>
                    <span class="n">attr</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">attr</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">GenieValue</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">return</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This is a hack for when the user asks the system to ask a question from a different worksheet.</span>

<span class="sd">        We increment the random_id to make sure that the ws is updated and the system with ask the question naturally</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ask: </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">random_id</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">





<h5 id="src.worksheets.environment.GenieWorksheet-attributes">Attributes</h5>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieWorksheet.action_performed" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">action_performed</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">action_performed</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieWorksheet.result" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">result</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieWorksheet.random_id" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">random_id</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">random_id</span> <span class="o">=</span> <span class="mi">0</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<h5 id="src.worksheets.environment.GenieWorksheet-functions">Functions</h5>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieWorksheet.__init__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__init__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="nf">kwargs</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">action_performed</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">random_id</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Since the user doesn&#39;t initialize the fields, we need to do it for them</span>
    <span class="c1"># first, we go over all the GenieFields in the class</span>
    <span class="c1"># then, we create a params dict with all the fields in the GenieField</span>
    <span class="c1"># finally, we check if the user has passed in a value for any GenieField</span>
    <span class="c1"># if they have, we set the value of the GenieField to the value passed in</span>
    <span class="c1"># and then we set the attribute of the class to the GenieField</span>
    <span class="k">for</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attr_value</span><span class="p">,</span> <span class="n">GenieField</span><span class="p">):</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">field</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">attr_value</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">attr_value</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">field</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="c1"># if the user has passed in a value for the GenieField, set it</span>
            <span class="c1"># eg. Book(booking_id=125)</span>
            <span class="c1"># then the user has passed in a value for booking_id</span>
            <span class="c1"># attr_name is all the GenieFields in the class</span>
            <span class="c1"># kwargs is all the values the user has passed in (like booking_id=125)</span>
            <span class="k">if</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">attr_name</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">params</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="s2">&quot;optional&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;optional&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;NA&quot;</span><span class="p">:</span>
                    <span class="n">params</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">GenieField</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieWorksheet.perform_action" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">perform_action</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">perform_action</span><span class="p">(</span><span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">,</span> <span class="n">local_context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Perform the action associated with this worksheet if it hasn't been performed yet.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bot</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieRuntime" href="#src.worksheets.environment.GenieRuntime">GenieRuntime</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The bot instance.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>local_context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieContext" href="#src.worksheets.environment.GenieContext">GenieContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The local context for the action.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>list</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of actions performed.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">perform_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">,</span> <span class="n">local_context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform the action associated with this worksheet if it hasn&#39;t been performed yet.</span>

<span class="sd">    Args:</span>
<span class="sd">        bot (GenieRuntime): The bot instance.</span>
<span class="sd">        local_context (GenieContext): The local context for the action.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: A list of actions performed.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_performed</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="n">acts</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">acts</span>

    <span class="n">acts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">perform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bot</span><span class="p">,</span> <span class="n">local_context</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">action_performed</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="n">acts</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieWorksheet.is_complete" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">is_complete</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">is_complete</span><span class="p">(</span><span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Check if the worksheet is complete by evaluating all fields.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bot</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieRuntime" href="#src.worksheets.environment.GenieRuntime">GenieRuntime</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The bot instance.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieContext" href="#src.worksheets.environment.GenieContext">GenieContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The context for evaluation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the worksheet is complete, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if the worksheet is complete by evaluating all fields.</span>

<span class="sd">    Args:</span>
<span class="sd">        bot (GenieRuntime): The bot instance.</span>
<span class="sd">        context (GenieContext): The context for evaluation.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the worksheet is complete, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">eval_predicates</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">predicate</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">bot</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">GenieWorksheet</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">is_complete</span><span class="p">(</span><span class="n">bot</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">field</span><span class="o">.</span><span class="n">optional</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">requires_confirmation</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">field</span><span class="o">.</span><span class="n">confirmed</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieWorksheet.__repr__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__repr__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__repr__</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">GenieField</span><span class="p">):</span>
            <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>

    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">repr</span><span class="p">(</span><span class="n">param</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">param</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">parameters</span><span class="p">])</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieWorksheet.schema_without_type" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">schema_without_type</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">schema_without_type</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Generate a schema representation of the worksheet without type information.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieContext" href="#src.worksheets.environment.GenieContext">GenieContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The context for the worksheet.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The schema representation without type.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">schema_without_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a schema representation of the worksheet without type information.</span>

<span class="sd">    Args:</span>
<span class="sd">        context (GenieContext): The context for the worksheet.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The schema representation without type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">confirmed</span><span class="p">:</span>
                <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = confirmed(</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">_value</span><span class="p">,</span> <span class="n">GenieResult</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">parent_var_name</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">indices</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="n">result_strings</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">GenieType</span><span class="p">):</span>
                        <span class="n">var_name</span><span class="p">,</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">find_list_variable</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">var_name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">idx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">result_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="p">(</span>
                                <span class="n">parent_var_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                                <span class="ow">and</span> <span class="n">parent_var_name</span> <span class="o">!=</span> <span class="n">var_name</span>
                            <span class="p">):</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                                    <span class="s2">&quot;Cannot handle multiple list variables in the same answer&quot;</span>
                                <span class="p">)</span>
                            <span class="n">parent_var_name</span> <span class="o">=</span> <span class="n">var_name</span>  <span class="c1"># Ignoring any potential multiple list variables</span>

                            <span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">result_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">parent_var_name</span><span class="p">:</span>
                    <span class="n">indices_str</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
                        <span class="n">indices_str</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent_var_name</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>

                    <span class="n">result_strings</span> <span class="o">=</span> <span class="s2">&quot;[&quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">indices_str</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result_strings</span><span class="p">):</span>
                <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">result_strings</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># TODO: Instead of getting the var_name from paren, we should search and find the same type of answer from the context</span>
                <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">GenieType</span><span class="p">):</span>
            <span class="c1"># This should be straight forward, same as the one above</span>
            <span class="n">var_name</span><span class="p">,</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">find_list_variable</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">var_name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">idx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">confirmed</span><span class="p">:</span>
                    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = confirmed(</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">confirmed</span><span class="p">:</span>
                    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = confirmed(</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">])&quot;</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">var_name</span> <span class="o">=</span> <span class="n">get_variable_name</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">confirmed</span><span class="p">:</span>
                    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = confirmed(</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">schema_without_type</span><span class="p">(</span><span class="n">no_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">val</span><span class="p">:</span>
                    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">param</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">param</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">parameters</span><span class="p">])</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieWorksheet.execute" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">execute</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">execute</span><span class="p">(</span><span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">,</span> <span class="n">local_context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Execute the actions associated with this worksheet.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bot</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieRuntime" href="#src.worksheets.environment.GenieRuntime">GenieRuntime</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The bot instance.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>local_context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieContext" href="#src.worksheets.environment.GenieContext">GenieContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The local context for execution.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">,</span> <span class="n">local_context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute the actions associated with this worksheet.</span>

<span class="sd">    Args:</span>
<span class="sd">        bot (GenieRuntime): The bot instance.</span>
<span class="sd">        local_context (GenieContext): The local context for execution.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;= &quot;</span> <span class="o">+</span> <span class="s2">&quot;self.&quot;</span> <span class="o">+</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend_api</span> <span class="o">+</span> <span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
    <span class="n">var_name</span> <span class="o">=</span> <span class="n">get_variable_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">local_context</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">GenieResult</span><span class="p">(</span>
        <span class="n">execute_query</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">bot</span><span class="p">,</span> <span class="n">local_context</span><span class="p">),</span> <span class="bp">self</span><span class="p">,</span> <span class="n">var_name</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">agent_acts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="n">ReportAgentAct</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">var_name</span> <span class="o">+</span> <span class="s2">&quot;.result&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">action_performed</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieWorksheet.new" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">new</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">new</span><span class="p">(</span><span class="n">initialize_from_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">new</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">initialize_from_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">initialize_from_dict</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieWorksheet.__setattr__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__setattr__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__setattr__</span><span class="p">(</span><span class="nf">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">GenieField</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">action_performed</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># if the worksheet has a confirm type field which is set to true</span>
            <span class="c1"># upon update, we need to set it to false</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">slottype</span> <span class="o">==</span> <span class="s2">&quot;confirm&quot;</span> <span class="ow">and</span> <span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">GenieField</span><span class="p">)</span> <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                <span class="n">value</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span>
                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">GenieValue</span><span class="p">):</span>
                <span class="n">attr</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">attr</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">GenieValue</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">return</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieWorksheet.ask" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">ask</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">ask</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>This is a hack for when the user asks the system to ask a question from a different worksheet.</p>
<p>We increment the random_id to make sure that the ws is updated and the system with ask the question naturally</p>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">ask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This is a hack for when the user asks the system to ask a question from a different worksheet.</span>

<span class="sd">    We increment the random_id to make sure that the ws is updated and the system with ask the question naturally</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ask: </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">random_id</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="src.worksheets.environment.GenieType" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">GenieType</span>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieWorksheet" href="#src.worksheets.environment.GenieWorksheet">GenieWorksheet</a></code></p>


        <p>Base class for Genie type definitions.</p>
<p>This class extends GenieWorksheet to provide type-specific functionality
and validation. It's used to define custom types in the Genie system.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieType._parent" href="#src.worksheets.environment.GenieType._parent">_parent</a></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parent object reference.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>src/worksheets/environment.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">GenieType</span><span class="p">(</span><span class="n">GenieWorksheet</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for Genie type definitions.</span>

<span class="sd">    This class extends GenieWorksheet to provide type-specific functionality</span>
<span class="sd">    and validation. It&#39;s used to define custom types in the Genie system.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        _parent: Parent object reference.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">is_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">primary_key</span> <span class="ow">and</span> <span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">





<h5 id="src.worksheets.environment.GenieType-attributes">Attributes</h5>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieType.action_performed" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">action_performed</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">action_performed</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieType.result" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">result</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieType.random_id" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">random_id</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">random_id</span> <span class="o">=</span> <span class="mi">0</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieType._parent" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">_parent</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">_parent</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<h5 id="src.worksheets.environment.GenieType-functions">Functions</h5>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieType.perform_action" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">perform_action</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">perform_action</span><span class="p">(</span><span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">,</span> <span class="n">local_context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Perform the action associated with this worksheet if it hasn't been performed yet.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bot</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieRuntime" href="#src.worksheets.environment.GenieRuntime">GenieRuntime</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The bot instance.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>local_context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieContext" href="#src.worksheets.environment.GenieContext">GenieContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The local context for the action.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>list</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of actions performed.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">perform_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">,</span> <span class="n">local_context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform the action associated with this worksheet if it hasn&#39;t been performed yet.</span>

<span class="sd">    Args:</span>
<span class="sd">        bot (GenieRuntime): The bot instance.</span>
<span class="sd">        local_context (GenieContext): The local context for the action.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: A list of actions performed.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_performed</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="n">acts</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">acts</span>

    <span class="n">acts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">perform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bot</span><span class="p">,</span> <span class="n">local_context</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">action_performed</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="n">acts</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieType.__repr__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__repr__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__repr__</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">GenieField</span><span class="p">):</span>
            <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>

    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">repr</span><span class="p">(</span><span class="n">param</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">param</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">parameters</span><span class="p">])</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieType.schema_without_type" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">schema_without_type</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">schema_without_type</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Generate a schema representation of the worksheet without type information.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieContext" href="#src.worksheets.environment.GenieContext">GenieContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The context for the worksheet.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The schema representation without type.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">schema_without_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a schema representation of the worksheet without type information.</span>

<span class="sd">    Args:</span>
<span class="sd">        context (GenieContext): The context for the worksheet.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The schema representation without type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">confirmed</span><span class="p">:</span>
                <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = confirmed(</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">_value</span><span class="p">,</span> <span class="n">GenieResult</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">parent_var_name</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">indices</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="n">result_strings</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">GenieType</span><span class="p">):</span>
                        <span class="n">var_name</span><span class="p">,</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">find_list_variable</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">var_name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">idx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">result_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="p">(</span>
                                <span class="n">parent_var_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                                <span class="ow">and</span> <span class="n">parent_var_name</span> <span class="o">!=</span> <span class="n">var_name</span>
                            <span class="p">):</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                                    <span class="s2">&quot;Cannot handle multiple list variables in the same answer&quot;</span>
                                <span class="p">)</span>
                            <span class="n">parent_var_name</span> <span class="o">=</span> <span class="n">var_name</span>  <span class="c1"># Ignoring any potential multiple list variables</span>

                            <span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">result_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">parent_var_name</span><span class="p">:</span>
                    <span class="n">indices_str</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
                        <span class="n">indices_str</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent_var_name</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>

                    <span class="n">result_strings</span> <span class="o">=</span> <span class="s2">&quot;[&quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">indices_str</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result_strings</span><span class="p">):</span>
                <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">result_strings</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># TODO: Instead of getting the var_name from paren, we should search and find the same type of answer from the context</span>
                <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">GenieType</span><span class="p">):</span>
            <span class="c1"># This should be straight forward, same as the one above</span>
            <span class="n">var_name</span><span class="p">,</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">find_list_variable</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">var_name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">idx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">confirmed</span><span class="p">:</span>
                    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = confirmed(</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">confirmed</span><span class="p">:</span>
                    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = confirmed(</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">])&quot;</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">var_name</span> <span class="o">=</span> <span class="n">get_variable_name</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">confirmed</span><span class="p">:</span>
                    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = confirmed(</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">schema_without_type</span><span class="p">(</span><span class="n">no_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">val</span><span class="p">:</span>
                    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">param</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">param</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">parameters</span><span class="p">])</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieType.execute" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">execute</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">execute</span><span class="p">(</span><span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">,</span> <span class="n">local_context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Execute the actions associated with this worksheet.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bot</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieRuntime" href="#src.worksheets.environment.GenieRuntime">GenieRuntime</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The bot instance.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>local_context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieContext" href="#src.worksheets.environment.GenieContext">GenieContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The local context for execution.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">,</span> <span class="n">local_context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute the actions associated with this worksheet.</span>

<span class="sd">    Args:</span>
<span class="sd">        bot (GenieRuntime): The bot instance.</span>
<span class="sd">        local_context (GenieContext): The local context for execution.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;= &quot;</span> <span class="o">+</span> <span class="s2">&quot;self.&quot;</span> <span class="o">+</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend_api</span> <span class="o">+</span> <span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
    <span class="n">var_name</span> <span class="o">=</span> <span class="n">get_variable_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">local_context</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">GenieResult</span><span class="p">(</span>
        <span class="n">execute_query</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">bot</span><span class="p">,</span> <span class="n">local_context</span><span class="p">),</span> <span class="bp">self</span><span class="p">,</span> <span class="n">var_name</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">agent_acts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="n">ReportAgentAct</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">var_name</span> <span class="o">+</span> <span class="s2">&quot;.result&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">action_performed</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieType.new" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">new</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">new</span><span class="p">(</span><span class="n">initialize_from_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">new</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">initialize_from_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">initialize_from_dict</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieType.__setattr__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__setattr__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__setattr__</span><span class="p">(</span><span class="nf">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">GenieField</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">action_performed</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># if the worksheet has a confirm type field which is set to true</span>
            <span class="c1"># upon update, we need to set it to false</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">slottype</span> <span class="o">==</span> <span class="s2">&quot;confirm&quot;</span> <span class="ow">and</span> <span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">GenieField</span><span class="p">)</span> <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                <span class="n">value</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span>
                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">GenieValue</span><span class="p">):</span>
                <span class="n">attr</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">attr</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">GenieValue</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">return</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieType.ask" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">ask</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">ask</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>This is a hack for when the user asks the system to ask a question from a different worksheet.</p>
<p>We increment the random_id to make sure that the ws is updated and the system with ask the question naturally</p>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">ask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This is a hack for when the user asks the system to ask a question from a different worksheet.</span>

<span class="sd">    We increment the random_id to make sure that the ws is updated and the system with ask the question naturally</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ask: </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">random_id</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieType.__init__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__init__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="nf">kwargs</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_parent</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieType.is_complete" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">is_complete</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">is_complete</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">primary_key</span> <span class="ow">and</span> <span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="src.worksheets.environment.GenieDB" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">GenieDB</span>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieWorksheet" href="#src.worksheets.environment.GenieWorksheet">GenieWorksheet</a></code></p>


        <p>Base class for Genie database models.</p>
<p>This class extends GenieWorksheet to provide database-specific functionality
and schema management.</p>






              <details class="quote">
                <summary>Source code in <code>src/worksheets/environment.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">GenieDB</span><span class="p">(</span><span class="n">GenieWorksheet</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for Genie database models.</span>

<span class="sd">    This class extends GenieWorksheet to provide database-specific functionality</span>
<span class="sd">    and schema management.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">





<h5 id="src.worksheets.environment.GenieDB-attributes">Attributes</h5>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieDB.action_performed" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">action_performed</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">action_performed</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieDB.result" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">result</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieDB.random_id" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">random_id</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">random_id</span> <span class="o">=</span> <span class="mi">0</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<h5 id="src.worksheets.environment.GenieDB-functions">Functions</h5>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieDB.__init__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__init__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="nf">kwargs</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">action_performed</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">random_id</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Since the user doesn&#39;t initialize the fields, we need to do it for them</span>
    <span class="c1"># first, we go over all the GenieFields in the class</span>
    <span class="c1"># then, we create a params dict with all the fields in the GenieField</span>
    <span class="c1"># finally, we check if the user has passed in a value for any GenieField</span>
    <span class="c1"># if they have, we set the value of the GenieField to the value passed in</span>
    <span class="c1"># and then we set the attribute of the class to the GenieField</span>
    <span class="k">for</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attr_value</span><span class="p">,</span> <span class="n">GenieField</span><span class="p">):</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">field</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">attr_value</span><span class="p">,</span> <span class="n">field</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">attr_value</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">field</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;__&quot;</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="c1"># if the user has passed in a value for the GenieField, set it</span>
            <span class="c1"># eg. Book(booking_id=125)</span>
            <span class="c1"># then the user has passed in a value for booking_id</span>
            <span class="c1"># attr_name is all the GenieFields in the class</span>
            <span class="c1"># kwargs is all the values the user has passed in (like booking_id=125)</span>
            <span class="k">if</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">params</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">attr_name</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">params</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="s2">&quot;optional&quot;</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;optional&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;NA&quot;</span><span class="p">:</span>
                    <span class="n">params</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">GenieField</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieDB.perform_action" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">perform_action</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">perform_action</span><span class="p">(</span><span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">,</span> <span class="n">local_context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Perform the action associated with this worksheet if it hasn't been performed yet.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bot</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieRuntime" href="#src.worksheets.environment.GenieRuntime">GenieRuntime</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The bot instance.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>local_context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieContext" href="#src.worksheets.environment.GenieContext">GenieContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The local context for the action.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>list</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of actions performed.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">perform_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">,</span> <span class="n">local_context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform the action associated with this worksheet if it hasn&#39;t been performed yet.</span>

<span class="sd">    Args:</span>
<span class="sd">        bot (GenieRuntime): The bot instance.</span>
<span class="sd">        local_context (GenieContext): The local context for the action.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: A list of actions performed.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_performed</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="n">acts</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">acts</span>

    <span class="n">acts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">perform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bot</span><span class="p">,</span> <span class="n">local_context</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">action_performed</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="n">acts</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieDB.is_complete" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">is_complete</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">is_complete</span><span class="p">(</span><span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Check if the worksheet is complete by evaluating all fields.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bot</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieRuntime" href="#src.worksheets.environment.GenieRuntime">GenieRuntime</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The bot instance.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieContext" href="#src.worksheets.environment.GenieContext">GenieContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The context for evaluation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the worksheet is complete, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if the worksheet is complete by evaluating all fields.</span>

<span class="sd">    Args:</span>
<span class="sd">        bot (GenieRuntime): The bot instance.</span>
<span class="sd">        context (GenieContext): The context for evaluation.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the worksheet is complete, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">eval_predicates</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">predicate</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">bot</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">GenieWorksheet</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">is_complete</span><span class="p">(</span><span class="n">bot</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">field</span><span class="o">.</span><span class="n">optional</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">requires_confirmation</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">field</span><span class="o">.</span><span class="n">confirmed</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieDB.__repr__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__repr__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__repr__</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">GenieField</span><span class="p">):</span>
            <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>

    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">repr</span><span class="p">(</span><span class="n">param</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">param</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">parameters</span><span class="p">])</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieDB.schema_without_type" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">schema_without_type</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">schema_without_type</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Generate a schema representation of the worksheet without type information.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieContext" href="#src.worksheets.environment.GenieContext">GenieContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The context for the worksheet.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The schema representation without type.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">schema_without_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a schema representation of the worksheet without type information.</span>

<span class="sd">    Args:</span>
<span class="sd">        context (GenieContext): The context for the worksheet.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The schema representation without type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">confirmed</span><span class="p">:</span>
                <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = confirmed(</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">_value</span><span class="p">,</span> <span class="n">GenieResult</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">parent_var_name</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">indices</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="n">result_strings</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">GenieType</span><span class="p">):</span>
                        <span class="n">var_name</span><span class="p">,</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">find_list_variable</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">var_name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">idx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">result_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="p">(</span>
                                <span class="n">parent_var_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                                <span class="ow">and</span> <span class="n">parent_var_name</span> <span class="o">!=</span> <span class="n">var_name</span>
                            <span class="p">):</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                                    <span class="s2">&quot;Cannot handle multiple list variables in the same answer&quot;</span>
                                <span class="p">)</span>
                            <span class="n">parent_var_name</span> <span class="o">=</span> <span class="n">var_name</span>  <span class="c1"># Ignoring any potential multiple list variables</span>

                            <span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">result_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">parent_var_name</span><span class="p">:</span>
                    <span class="n">indices_str</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
                        <span class="n">indices_str</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent_var_name</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>

                    <span class="n">result_strings</span> <span class="o">=</span> <span class="s2">&quot;[&quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">indices_str</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result_strings</span><span class="p">):</span>
                <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">result_strings</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># TODO: Instead of getting the var_name from paren, we should search and find the same type of answer from the context</span>
                <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">GenieType</span><span class="p">):</span>
            <span class="c1"># This should be straight forward, same as the one above</span>
            <span class="n">var_name</span><span class="p">,</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">find_list_variable</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">var_name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">idx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">confirmed</span><span class="p">:</span>
                    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = confirmed(</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">confirmed</span><span class="p">:</span>
                    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = confirmed(</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">])&quot;</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">var_name</span> <span class="o">=</span> <span class="n">get_variable_name</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">confirmed</span><span class="p">:</span>
                    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = confirmed(</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">schema_without_type</span><span class="p">(</span><span class="n">no_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">val</span><span class="p">:</span>
                    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">param</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">param</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">parameters</span><span class="p">])</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieDB.execute" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">execute</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">execute</span><span class="p">(</span><span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">,</span> <span class="n">local_context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Execute the actions associated with this worksheet.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bot</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieRuntime" href="#src.worksheets.environment.GenieRuntime">GenieRuntime</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The bot instance.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>local_context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieContext" href="#src.worksheets.environment.GenieContext">GenieContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The local context for execution.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">,</span> <span class="n">local_context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute the actions associated with this worksheet.</span>

<span class="sd">    Args:</span>
<span class="sd">        bot (GenieRuntime): The bot instance.</span>
<span class="sd">        local_context (GenieContext): The local context for execution.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;= &quot;</span> <span class="o">+</span> <span class="s2">&quot;self.&quot;</span> <span class="o">+</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend_api</span> <span class="o">+</span> <span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
    <span class="n">var_name</span> <span class="o">=</span> <span class="n">get_variable_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">local_context</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">GenieResult</span><span class="p">(</span>
        <span class="n">execute_query</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">bot</span><span class="p">,</span> <span class="n">local_context</span><span class="p">),</span> <span class="bp">self</span><span class="p">,</span> <span class="n">var_name</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">agent_acts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="n">ReportAgentAct</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">var_name</span> <span class="o">+</span> <span class="s2">&quot;.result&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">action_performed</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieDB.new" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">new</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">new</span><span class="p">(</span><span class="n">initialize_from_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">new</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">initialize_from_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">initialize_from_dict</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieDB.__setattr__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__setattr__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__setattr__</span><span class="p">(</span><span class="nf">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">GenieField</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">action_performed</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># if the worksheet has a confirm type field which is set to true</span>
            <span class="c1"># upon update, we need to set it to false</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">slottype</span> <span class="o">==</span> <span class="s2">&quot;confirm&quot;</span> <span class="ow">and</span> <span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">GenieField</span><span class="p">)</span> <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                <span class="n">value</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span>
                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">GenieValue</span><span class="p">):</span>
                <span class="n">attr</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">attr</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">GenieValue</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">return</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieDB.ask" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">ask</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">ask</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>This is a hack for when the user asks the system to ask a question from a different worksheet.</p>
<p>We increment the random_id to make sure that the ws is updated and the system with ask the question naturally</p>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">ask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This is a hack for when the user asks the system to ask a question from a different worksheet.</span>

<span class="sd">    We increment the random_id to make sure that the ws is updated and the system with ask the question naturally</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ask: </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">random_id</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="src.worksheets.environment.Answer" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">Answer</span>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieWorksheet" href="#src.worksheets.environment.GenieWorksheet">GenieWorksheet</a></code></p>


        <p>Class representing an answer in the Genie system.</p>
<p>This class handles query execution, result management, and parameter tracking
for answers to user queries.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.Answer.query" href="#src.worksheets.environment.Answer.query">query</a></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieField" href="#src.worksheets.environment.GenieField">GenieField</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The query to execute.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.Answer.actions" href="#src.worksheets.environment.Answer.actions">actions</a></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Associated actions.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.Answer.result" href="#src.worksheets.environment.Answer.result">result</a></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Query execution result.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.Answer.tables" href="#src.worksheets.environment.Answer.tables">tables</a></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Related database tables.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.Answer.potential_outputs" href="#src.worksheets.environment.Answer.potential_outputs">potential_outputs</a></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Possible output types.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.Answer.nl_query" href="#src.worksheets.environment.Answer.nl_query">nl_query</a></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Natural language query.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.Answer.param_names" href="#src.worksheets.environment.Answer.param_names">param_names</a></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Required parameter names.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>src/worksheets/environment.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Answer</span><span class="p">(</span><span class="n">GenieWorksheet</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class representing an answer in the Genie system.</span>

<span class="sd">    This class handles query execution, result management, and parameter tracking</span>
<span class="sd">    for answers to user queries.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        query (GenieField): The query to execute.</span>
<span class="sd">        actions: Associated actions.</span>
<span class="sd">        result: Query execution result.</span>
<span class="sd">        tables: Related database tables.</span>
<span class="sd">        potential_outputs: Possible output types.</span>
<span class="sd">        nl_query: Natural language query.</span>
<span class="sd">        param_names: Required parameter names.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">required_params</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">nl_query</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query</span> <span class="o">=</span> <span class="n">GenieField</span><span class="p">(</span><span class="s2">&quot;str&quot;</span><span class="p">,</span> <span class="s2">&quot;query&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">query</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actions</span> <span class="o">=</span> <span class="n">Action</span><span class="p">(</span><span class="s2">&quot;&gt;suql_runner(self.query.value, self.required_columns)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tables</span> <span class="o">=</span> <span class="n">tables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potential_outputs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nl_query</span> <span class="o">=</span> <span class="n">nl_query</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action_performed</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">potential_outputs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="n">table</span><span class="p">]</span><span class="o">.</span><span class="n">outputs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">required_columns</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">field</span><span class="o">.</span><span class="n">name</span>
            <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="n">table</span><span class="p">])</span>
        <span class="p">]</span>

        <span class="c1"># Create required params and add them to ordered attributes</span>
        <span class="n">_ordered_attributes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;query&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">required_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">db_name</span><span class="p">,</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">required_params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span>
                        <span class="bp">self</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">db_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">GenieField</span><span class="p">(</span><span class="s2">&quot;str&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">db_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">param_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">db_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">_ordered_attributes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">db_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_ordered_attributes</span> <span class="o">=</span> <span class="n">_ordered_attributes</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">,</span> <span class="n">local_context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute the actions associated with this answer.</span>

<span class="sd">        Args:</span>
<span class="sd">            bot (GenieRuntime): The bot instance.</span>
<span class="sd">            local_context (GenieContext): The local context for the execution.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_performed</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">execute_query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">action</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">bot</span><span class="p">,</span> <span class="n">local_context</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action_performed</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">results</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Get more information about the fields</span>
        <span class="n">ws</span><span class="p">,</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">more_field_info_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">more_field_info_query</span><span class="p">(</span><span class="n">bot</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;More Field Info: </span><span class="si">{</span><span class="n">more_field_info_result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Results: </span><span class="si">{</span><span class="n">results</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Earlier we had a mechanism to check if the user is asking to execute a query or asking for more information</span>
        <span class="c1"># about the field. Hence we have output_idx.</span>
        <span class="c1"># For now we are going to assume that the user is asking for the output of the query</span>
        <span class="n">output_idx</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output_idx</span><span class="p">):</span>
            <span class="n">output_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">output_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">output_idx</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># Check if the output type is in the results</span>
                <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_in_result</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
                <span class="n">var_name</span> <span class="o">=</span> <span class="n">get_variable_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">local_context</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">GenieResult</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">var_name</span><span class="p">)</span>

                <span class="c1"># Report the agent act</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">agent_acts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                    <span class="n">ReportAgentAct</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">,</span> <span class="n">var_name</span><span class="p">,</span> <span class="n">var_name</span> <span class="o">+</span> <span class="s2">&quot;.result&quot;</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_output</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">output</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_output</span><span class="p">,</span> <span class="n">GenieWorksheet</span><span class="p">):</span>
                        <span class="c1"># add the output to the local context</span>
                        <span class="n">local_context</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">camel_to_snake</span><span class="p">(</span><span class="n">_output</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">_output</span>
                        <span class="p">)</span>
            <span class="k">elif</span> <span class="n">output_idx</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="c1"># We don&#39;t use this for now but we can use it to ask for more information</span>
                <span class="n">var_name</span> <span class="o">=</span> <span class="n">get_variable_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">local_context</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">GenieResult</span><span class="p">(</span><span class="n">more_field_info_result</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">var_name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">agent_acts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                    <span class="n">ReportAgentAct</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;AskClarificationQuestion(</span><span class="si">{</span><span class="n">ws</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">field_name</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">,</span>
                        <span class="n">message_var_name</span><span class="o">=</span><span class="n">var_name</span> <span class="o">+</span> <span class="s2">&quot;.result&quot;</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

        <span class="c1"># for i, _output in enumerate(output):</span>
        <span class="c1">#     local_context.context[f&quot;__{var_name}_result_{i}&quot;] = _output</span>

    <span class="k">def</span> <span class="nf">more_field_info_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">bot</span><span class="o">.</span><span class="n">dlg_history</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">bot</span><span class="o">.</span><span class="n">dlg_history</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">bot</span><span class="o">.</span><span class="n">dlg_history</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">system_action</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
        <span class="n">acts</span> <span class="o">=</span> <span class="n">bot</span><span class="o">.</span><span class="n">dlg_history</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">system_action</span><span class="o">.</span><span class="n">actions</span>
        <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">acts</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">act</span><span class="p">,</span> <span class="n">AskAgentAct</span><span class="p">):</span>
                <span class="n">more_field_info</span> <span class="o">=</span> <span class="n">generate_clarification</span><span class="p">(</span><span class="n">act</span><span class="o">.</span><span class="n">ws</span><span class="p">,</span> <span class="n">act</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">more_field_info</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">act</span><span class="o">.</span><span class="n">ws</span><span class="p">,</span> <span class="n">act</span><span class="o">.</span><span class="n">field</span><span class="p">,</span> <span class="n">more_field_info</span>

        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">output_in_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the output type is in the results.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">potential_outputs</span><span class="p">):</span>
            <span class="n">output_results</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">output_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">potential_outputs</span><span class="p">:</span>
                    <span class="n">found_primary_key</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="n">output_type</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">primary_key</span> <span class="ow">and</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                            <span class="n">output_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_type</span><span class="p">(</span><span class="o">**</span><span class="n">result</span><span class="p">))</span>
                            <span class="n">found_primary_key</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="k">break</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">found_primary_key</span><span class="p">:</span>
                        <span class="n">output_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">output_results</span>
        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">unfilled_params</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">query_str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the answer with new parameters and tables.</span>

<span class="sd">        We are not using this method anymore, but we can keep it for reference.&quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updating Answer: </span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">, This has been deprecated&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">query</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_names</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">param</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_ordered_attributes</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">param_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">required_columns</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">field</span><span class="o">.</span><span class="n">name</span>
            <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">tables</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="n">table</span><span class="p">])</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tables</span> <span class="o">=</span> <span class="n">tables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potential_outputs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">potential_outputs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="n">table</span><span class="p">]</span><span class="o">.</span><span class="n">outputs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">unfilled_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">db_name</span><span class="p">,</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">unfilled_params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span>
                        <span class="bp">self</span><span class="p">,</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">db_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">GenieField</span><span class="p">(</span><span class="s2">&quot;str&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">db_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
                    <span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">param_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">db_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_ordered_attributes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">db_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">nl_query</span> <span class="o">=</span> <span class="n">query_str</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">





<h5 id="src.worksheets.environment.Answer-attributes">Attributes</h5>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.Answer.random_id" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">random_id</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">random_id</span> <span class="o">=</span> <span class="mi">0</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.Answer.query" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">query</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">query</span> <span class="o">=</span> <span class="n">GenieField</span><span class="p">(</span><span class="s1">&#39;str&#39;</span><span class="p">,</span> <span class="s1">&#39;query&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">query</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.Answer.actions" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">actions</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">actions</span> <span class="o">=</span> <span class="n">Action</span><span class="p">(</span><span class="s1">&#39;&gt;suql_runner(self.query.value, self.required_columns)&#39;</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.Answer.result" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">result</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.Answer.tables" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">tables</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">tables</span> <span class="o">=</span> <span class="n">tables</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.Answer.potential_outputs" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">potential_outputs</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">potential_outputs</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.Answer.nl_query" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">nl_query</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">nl_query</span> <span class="o">=</span> <span class="n">nl_query</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.Answer.param_names" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">param_names</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">param_names</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.Answer.action_performed" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">action_performed</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">action_performed</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.Answer.required_columns" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">required_columns</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">required_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">tables</span> <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="n">context</span><span class="p">[</span><span class="n">table</span><span class="p">])]</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.Answer._ordered_attributes" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">_ordered_attributes</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">_ordered_attributes</span> <span class="o">=</span> <span class="n">_ordered_attributes</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<h5 id="src.worksheets.environment.Answer-functions">Functions</h5>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.Answer.perform_action" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">perform_action</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">perform_action</span><span class="p">(</span><span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">,</span> <span class="n">local_context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Perform the action associated with this worksheet if it hasn't been performed yet.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bot</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieRuntime" href="#src.worksheets.environment.GenieRuntime">GenieRuntime</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The bot instance.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>local_context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieContext" href="#src.worksheets.environment.GenieContext">GenieContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The local context for the action.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>list</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of actions performed.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">perform_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">,</span> <span class="n">local_context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform the action associated with this worksheet if it hasn&#39;t been performed yet.</span>

<span class="sd">    Args:</span>
<span class="sd">        bot (GenieRuntime): The bot instance.</span>
<span class="sd">        local_context (GenieContext): The local context for the action.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: A list of actions performed.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_performed</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="n">acts</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">acts</span>

    <span class="n">acts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">perform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bot</span><span class="p">,</span> <span class="n">local_context</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">action_performed</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="n">acts</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.Answer.is_complete" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">is_complete</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">is_complete</span><span class="p">(</span><span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Check if the worksheet is complete by evaluating all fields.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bot</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieRuntime" href="#src.worksheets.environment.GenieRuntime">GenieRuntime</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The bot instance.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieContext" href="#src.worksheets.environment.GenieContext">GenieContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The context for evaluation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the worksheet is complete, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if the worksheet is complete by evaluating all fields.</span>

<span class="sd">    Args:</span>
<span class="sd">        bot (GenieRuntime): The bot instance.</span>
<span class="sd">        context (GenieContext): The context for evaluation.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the worksheet is complete, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">eval_predicates</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">predicate</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">bot</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">GenieWorksheet</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">is_complete</span><span class="p">(</span><span class="n">bot</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">field</span><span class="o">.</span><span class="n">optional</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">requires_confirmation</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">field</span><span class="o">.</span><span class="n">confirmed</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.Answer.__repr__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__repr__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__repr__</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">GenieField</span><span class="p">):</span>
            <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>

    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">repr</span><span class="p">(</span><span class="n">param</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">param</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">parameters</span><span class="p">])</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.Answer.schema_without_type" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">schema_without_type</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">schema_without_type</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Generate a schema representation of the worksheet without type information.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieContext" href="#src.worksheets.environment.GenieContext">GenieContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The context for the worksheet.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The schema representation without type.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">schema_without_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a schema representation of the worksheet without type information.</span>

<span class="sd">    Args:</span>
<span class="sd">        context (GenieContext): The context for the worksheet.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The schema representation without type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">confirmed</span><span class="p">:</span>
                <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = confirmed(</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">_value</span><span class="p">,</span> <span class="n">GenieResult</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">parent_var_name</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">indices</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="n">result_strings</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">GenieType</span><span class="p">):</span>
                        <span class="n">var_name</span><span class="p">,</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">find_list_variable</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">var_name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">idx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">result_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="p">(</span>
                                <span class="n">parent_var_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                                <span class="ow">and</span> <span class="n">parent_var_name</span> <span class="o">!=</span> <span class="n">var_name</span>
                            <span class="p">):</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                                    <span class="s2">&quot;Cannot handle multiple list variables in the same answer&quot;</span>
                                <span class="p">)</span>
                            <span class="n">parent_var_name</span> <span class="o">=</span> <span class="n">var_name</span>  <span class="c1"># Ignoring any potential multiple list variables</span>

                            <span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">result_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">parent_var_name</span><span class="p">:</span>
                    <span class="n">indices_str</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
                        <span class="n">indices_str</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent_var_name</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>

                    <span class="n">result_strings</span> <span class="o">=</span> <span class="s2">&quot;[&quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">indices_str</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result_strings</span><span class="p">):</span>
                <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">result_strings</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># TODO: Instead of getting the var_name from paren, we should search and find the same type of answer from the context</span>
                <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">GenieType</span><span class="p">):</span>
            <span class="c1"># This should be straight forward, same as the one above</span>
            <span class="n">var_name</span><span class="p">,</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">find_list_variable</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">var_name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">idx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">confirmed</span><span class="p">:</span>
                    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = confirmed(</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">confirmed</span><span class="p">:</span>
                    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = confirmed(</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">])&quot;</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">var_name</span> <span class="o">=</span> <span class="n">get_variable_name</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">confirmed</span><span class="p">:</span>
                    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = confirmed(</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">schema_without_type</span><span class="p">(</span><span class="n">no_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">val</span><span class="p">:</span>
                    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">param</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">param</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">parameters</span><span class="p">])</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.Answer.new" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">new</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">new</span><span class="p">(</span><span class="n">initialize_from_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">new</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">initialize_from_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">initialize_from_dict</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.Answer.__setattr__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__setattr__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__setattr__</span><span class="p">(</span><span class="nf">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">GenieField</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">action_performed</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># if the worksheet has a confirm type field which is set to true</span>
            <span class="c1"># upon update, we need to set it to false</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">slottype</span> <span class="o">==</span> <span class="s2">&quot;confirm&quot;</span> <span class="ow">and</span> <span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">GenieField</span><span class="p">)</span> <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                <span class="n">value</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span>
                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">GenieValue</span><span class="p">):</span>
                <span class="n">attr</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">attr</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">GenieValue</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">return</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.Answer.ask" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">ask</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">ask</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>This is a hack for when the user asks the system to ask a question from a different worksheet.</p>
<p>We increment the random_id to make sure that the ws is updated and the system with ask the question naturally</p>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">ask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This is a hack for when the user asks the system to ask a question from a different worksheet.</span>

<span class="sd">    We increment the random_id to make sure that the ws is updated and the system with ask the question naturally</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ask: </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">random_id</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.Answer.__init__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__init__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__init__</span><span class="p">(</span><span class="nf">query</span><span class="p">,</span> <span class="n">required_params</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">nl_query</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">required_params</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">nl_query</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">query</span> <span class="o">=</span> <span class="n">GenieField</span><span class="p">(</span><span class="s2">&quot;str&quot;</span><span class="p">,</span> <span class="s2">&quot;query&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">query</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">actions</span> <span class="o">=</span> <span class="n">Action</span><span class="p">(</span><span class="s2">&quot;&gt;suql_runner(self.query.value, self.required_columns)&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tables</span> <span class="o">=</span> <span class="n">tables</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">potential_outputs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nl_query</span> <span class="o">=</span> <span class="n">nl_query</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">param_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">action_performed</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potential_outputs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="n">table</span><span class="p">]</span><span class="o">.</span><span class="n">outputs</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">required_columns</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">field</span><span class="o">.</span><span class="n">name</span>
        <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="n">table</span><span class="p">])</span>
    <span class="p">]</span>

    <span class="c1"># Create required params and add them to ordered attributes</span>
    <span class="n">_ordered_attributes</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;query&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">required_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">db_name</span><span class="p">,</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">required_params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">db_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">GenieField</span><span class="p">(</span><span class="s2">&quot;str&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">db_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">param_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">db_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">_ordered_attributes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">db_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_ordered_attributes</span> <span class="o">=</span> <span class="n">_ordered_attributes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.Answer.execute" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">execute</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">execute</span><span class="p">(</span><span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">,</span> <span class="n">local_context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Execute the actions associated with this answer.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bot</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieRuntime" href="#src.worksheets.environment.GenieRuntime">GenieRuntime</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The bot instance.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>local_context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieContext" href="#src.worksheets.environment.GenieContext">GenieContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The local context for the execution.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">,</span> <span class="n">local_context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute the actions associated with this answer.</span>

<span class="sd">    Args:</span>
<span class="sd">        bot (GenieRuntime): The bot instance.</span>
<span class="sd">        local_context (GenieContext): The local context for the execution.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_performed</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">execute_query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">action</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">bot</span><span class="p">,</span> <span class="n">local_context</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">action_performed</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">results</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Get more information about the fields</span>
    <span class="n">ws</span><span class="p">,</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">more_field_info_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">more_field_info_query</span><span class="p">(</span><span class="n">bot</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;More Field Info: </span><span class="si">{</span><span class="n">more_field_info_result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Results: </span><span class="si">{</span><span class="n">results</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Earlier we had a mechanism to check if the user is asking to execute a query or asking for more information</span>
    <span class="c1"># about the field. Hence we have output_idx.</span>
    <span class="c1"># For now we are going to assume that the user is asking for the output of the query</span>
    <span class="n">output_idx</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">output_idx</span><span class="p">):</span>
        <span class="n">output_idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">output_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">output_idx</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Check if the output type is in the results</span>
            <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">output_in_result</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
            <span class="n">var_name</span> <span class="o">=</span> <span class="n">get_variable_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">local_context</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">GenieResult</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">var_name</span><span class="p">)</span>

            <span class="c1"># Report the agent act</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">agent_acts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                <span class="n">ReportAgentAct</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">,</span> <span class="n">var_name</span><span class="p">,</span> <span class="n">var_name</span> <span class="o">+</span> <span class="s2">&quot;.result&quot;</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_output</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">output</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_output</span><span class="p">,</span> <span class="n">GenieWorksheet</span><span class="p">):</span>
                    <span class="c1"># add the output to the local context</span>
                    <span class="n">local_context</span><span class="o">.</span><span class="n">set</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">camel_to_snake</span><span class="p">(</span><span class="n">_output</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">_output</span>
                    <span class="p">)</span>
        <span class="k">elif</span> <span class="n">output_idx</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># We don&#39;t use this for now but we can use it to ask for more information</span>
            <span class="n">var_name</span> <span class="o">=</span> <span class="n">get_variable_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">local_context</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">GenieResult</span><span class="p">(</span><span class="n">more_field_info_result</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">var_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">agent_acts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
                <span class="n">ReportAgentAct</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;AskClarificationQuestion(</span><span class="si">{</span><span class="n">ws</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">field_name</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">,</span>
                    <span class="n">message_var_name</span><span class="o">=</span><span class="n">var_name</span> <span class="o">+</span> <span class="s2">&quot;.result&quot;</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.Answer.more_field_info_query" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">more_field_info_query</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">more_field_info_query</span><span class="p">(</span><span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">more_field_info_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">bot</span><span class="o">.</span><span class="n">dlg_history</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">bot</span><span class="o">.</span><span class="n">dlg_history</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">bot</span><span class="o">.</span><span class="n">dlg_history</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">system_action</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
    <span class="n">acts</span> <span class="o">=</span> <span class="n">bot</span><span class="o">.</span><span class="n">dlg_history</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">system_action</span><span class="o">.</span><span class="n">actions</span>
    <span class="k">for</span> <span class="n">act</span> <span class="ow">in</span> <span class="n">acts</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">act</span><span class="p">,</span> <span class="n">AskAgentAct</span><span class="p">):</span>
            <span class="n">more_field_info</span> <span class="o">=</span> <span class="n">generate_clarification</span><span class="p">(</span><span class="n">act</span><span class="o">.</span><span class="n">ws</span><span class="p">,</span> <span class="n">act</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">more_field_info</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">act</span><span class="o">.</span><span class="n">ws</span><span class="p">,</span> <span class="n">act</span><span class="o">.</span><span class="n">field</span><span class="p">,</span> <span class="n">more_field_info</span>

    <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.Answer.output_in_result" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">output_in_result</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">output_in_result</span><span class="p">(</span><span class="n">results</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Check if the output type is in the results.</p>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">output_in_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if the output type is in the results.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">potential_outputs</span><span class="p">):</span>
        <span class="n">output_results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">result</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">output_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">potential_outputs</span><span class="p">:</span>
                <span class="n">found_primary_key</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="n">output_type</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">primary_key</span> <span class="ow">and</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                        <span class="n">output_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">output_type</span><span class="p">(</span><span class="o">**</span><span class="n">result</span><span class="p">))</span>
                        <span class="n">found_primary_key</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">found_primary_key</span><span class="p">:</span>
                    <span class="n">output_results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">output_results</span>
    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.Answer.update" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">update</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">update</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">unfilled_params</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">query_str</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Update the answer with new parameters and tables.</p>
<p>We are not using this method anymore, but we can keep it for reference.</p>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">unfilled_params</span><span class="p">,</span> <span class="n">tables</span><span class="p">,</span> <span class="n">query_str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update the answer with new parameters and tables.</span>

<span class="sd">    We are not using this method anymore, but we can keep it for reference.&quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Updating Answer: </span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">, This has been deprecated&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">query</span>
    <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">param_names</span><span class="p">:</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="n">param</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ordered_attributes</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">param_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">required_columns</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">field</span><span class="o">.</span><span class="n">name</span>
        <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">tables</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="n">table</span><span class="p">])</span>
    <span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">tables</span> <span class="o">=</span> <span class="n">tables</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">potential_outputs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tables</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potential_outputs</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="n">table</span><span class="p">]</span><span class="o">.</span><span class="n">outputs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">unfilled_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">db_name</span><span class="p">,</span> <span class="n">params</span> <span class="ow">in</span> <span class="n">unfilled_params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">db_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">GenieField</span><span class="p">(</span><span class="s2">&quot;str&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">db_name</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
                <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">param_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">db_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_ordered_attributes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">db_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">param</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">nl_query</span> <span class="o">=</span> <span class="n">query_str</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="src.worksheets.environment.MoreFieldInfo" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">MoreFieldInfo</span>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieWorksheet" href="#src.worksheets.environment.GenieWorksheet">GenieWorksheet</a></code></p>


        <p>Class for managing additional field information requests.</p>
<p>This class handles requests for clarification or additional information
about specific fields.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.MoreFieldInfo.api_name" href="#src.worksheets.environment.MoreFieldInfo.api_name">api_name</a></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieField" href="#src.worksheets.environment.GenieField">GenieField</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the API.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.MoreFieldInfo.parameter_name" href="#src.worksheets.environment.MoreFieldInfo.parameter_name">parameter_name</a></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieField" href="#src.worksheets.environment.GenieField">GenieField</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the parameter.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.MoreFieldInfo.actions" href="#src.worksheets.environment.MoreFieldInfo.actions">actions</a></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Associated actions.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>src/worksheets/environment.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">MoreFieldInfo</span><span class="p">(</span><span class="n">GenieWorksheet</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class for managing additional field information requests.</span>

<span class="sd">    This class handles requests for clarification or additional information</span>
<span class="sd">    about specific fields.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        api_name (GenieField): Name of the API.</span>
<span class="sd">        parameter_name (GenieField): Name of the parameter.</span>
<span class="sd">        actions: Associated actions.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_name</span><span class="p">,</span> <span class="n">parameter_name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_name</span> <span class="o">=</span> <span class="n">GenieField</span><span class="p">(</span><span class="s2">&quot;str&quot;</span><span class="p">,</span> <span class="s2">&quot;api_name&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">api_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parameter_name</span> <span class="o">=</span> <span class="n">GenieField</span><span class="p">(</span><span class="s2">&quot;str&quot;</span><span class="p">,</span> <span class="s2">&quot;parameter_name&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">parameter_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actions</span> <span class="o">=</span> <span class="n">Action</span><span class="p">(</span>
            <span class="s2">&quot;&gt;answer_clarification_question(self.api_name, self.parameter_name)&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action_performed</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">





<h5 id="src.worksheets.environment.MoreFieldInfo-attributes">Attributes</h5>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.MoreFieldInfo.result" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">result</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.MoreFieldInfo.random_id" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">random_id</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">random_id</span> <span class="o">=</span> <span class="mi">0</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.MoreFieldInfo.api_name" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">api_name</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">api_name</span> <span class="o">=</span> <span class="n">GenieField</span><span class="p">(</span><span class="s1">&#39;str&#39;</span><span class="p">,</span> <span class="s1">&#39;api_name&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">api_name</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.MoreFieldInfo.parameter_name" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">parameter_name</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">parameter_name</span> <span class="o">=</span> <span class="n">GenieField</span><span class="p">(</span><span class="s1">&#39;str&#39;</span><span class="p">,</span> <span class="s1">&#39;parameter_name&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">parameter_name</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.MoreFieldInfo.actions" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">actions</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">actions</span> <span class="o">=</span> <span class="n">Action</span><span class="p">(</span><span class="s1">&#39;&gt;answer_clarification_question(self.api_name, self.parameter_name)&#39;</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.MoreFieldInfo.action_performed" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">action_performed</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">action_performed</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<h5 id="src.worksheets.environment.MoreFieldInfo-functions">Functions</h5>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.MoreFieldInfo.perform_action" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">perform_action</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">perform_action</span><span class="p">(</span><span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">,</span> <span class="n">local_context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Perform the action associated with this worksheet if it hasn't been performed yet.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bot</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieRuntime" href="#src.worksheets.environment.GenieRuntime">GenieRuntime</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The bot instance.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>local_context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieContext" href="#src.worksheets.environment.GenieContext">GenieContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The local context for the action.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>list</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of actions performed.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">perform_action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">,</span> <span class="n">local_context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform the action associated with this worksheet if it hasn&#39;t been performed yet.</span>

<span class="sd">    Args:</span>
<span class="sd">        bot (GenieRuntime): The bot instance.</span>
<span class="sd">        local_context (GenieContext): The local context for the action.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: A list of actions performed.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_performed</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="n">acts</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">acts</span>

    <span class="n">acts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">perform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bot</span><span class="p">,</span> <span class="n">local_context</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">action_performed</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="n">acts</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.MoreFieldInfo.is_complete" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">is_complete</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">is_complete</span><span class="p">(</span><span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Check if the worksheet is complete by evaluating all fields.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bot</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieRuntime" href="#src.worksheets.environment.GenieRuntime">GenieRuntime</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The bot instance.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieContext" href="#src.worksheets.environment.GenieContext">GenieContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The context for evaluation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the worksheet is complete, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if the worksheet is complete by evaluating all fields.</span>

<span class="sd">    Args:</span>
<span class="sd">        bot (GenieRuntime): The bot instance.</span>
<span class="sd">        context (GenieContext): The context for evaluation.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the worksheet is complete, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">eval_predicates</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">predicate</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">bot</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">GenieWorksheet</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">is_complete</span><span class="p">(</span><span class="n">bot</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">field</span><span class="o">.</span><span class="n">optional</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">requires_confirmation</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">field</span><span class="o">.</span><span class="n">confirmed</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.MoreFieldInfo.__repr__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__repr__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__repr__</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">GenieField</span><span class="p">):</span>
            <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>

    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">repr</span><span class="p">(</span><span class="n">param</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">param</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">parameters</span><span class="p">])</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.MoreFieldInfo.schema_without_type" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">schema_without_type</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">schema_without_type</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Generate a schema representation of the worksheet without type information.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieContext" href="#src.worksheets.environment.GenieContext">GenieContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The context for the worksheet.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The schema representation without type.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">schema_without_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a schema representation of the worksheet without type information.</span>

<span class="sd">    Args:</span>
<span class="sd">        context (GenieContext): The context for the worksheet.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The schema representation without type.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">confirmed</span><span class="p">:</span>
                <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = confirmed(</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">_value</span><span class="p">,</span> <span class="n">GenieResult</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">parent_var_name</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">indices</span> <span class="o">=</span> <span class="p">[]</span>

                <span class="n">result_strings</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">GenieType</span><span class="p">):</span>
                        <span class="n">var_name</span><span class="p">,</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">find_list_variable</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">var_name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">idx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">result_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">if</span> <span class="p">(</span>
                                <span class="n">parent_var_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                                <span class="ow">and</span> <span class="n">parent_var_name</span> <span class="o">!=</span> <span class="n">var_name</span>
                            <span class="p">):</span>
                                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                                    <span class="s2">&quot;Cannot handle multiple list variables in the same answer&quot;</span>
                                <span class="p">)</span>
                            <span class="n">parent_var_name</span> <span class="o">=</span> <span class="n">var_name</span>  <span class="c1"># Ignoring any potential multiple list variables</span>

                            <span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">result_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">parent_var_name</span><span class="p">:</span>
                    <span class="n">indices_str</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
                        <span class="n">indices_str</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">parent_var_name</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>

                    <span class="n">result_strings</span> <span class="o">=</span> <span class="s2">&quot;[&quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">indices_str</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;]&quot;</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result_strings</span><span class="p">):</span>
                <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">result_strings</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># TODO: Instead of getting the var_name from paren, we should search and find the same type of answer from the context</span>
                <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">GenieType</span><span class="p">):</span>
            <span class="c1"># This should be straight forward, same as the one above</span>
            <span class="n">var_name</span><span class="p">,</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">find_list_variable</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">var_name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">idx</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">confirmed</span><span class="p">:</span>
                    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = confirmed(</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">confirmed</span><span class="p">:</span>
                    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = confirmed(</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">])&quot;</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">var_name</span> <span class="o">=</span> <span class="n">get_variable_name</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">confirmed</span><span class="p">:</span>
                    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = confirmed(</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">schema_without_type</span><span class="p">(</span><span class="n">no_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">val</span><span class="p">:</span>
                    <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">param</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">param</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">parameters</span><span class="p">])</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.MoreFieldInfo.execute" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">execute</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">execute</span><span class="p">(</span><span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">,</span> <span class="n">local_context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Execute the actions associated with this worksheet.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>bot</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieRuntime" href="#src.worksheets.environment.GenieRuntime">GenieRuntime</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The bot instance.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>local_context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieContext" href="#src.worksheets.environment.GenieContext">GenieContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The local context for execution.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">,</span> <span class="n">local_context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute the actions associated with this worksheet.</span>

<span class="sd">    Args:</span>
<span class="sd">        bot (GenieRuntime): The bot instance.</span>
<span class="sd">        local_context (GenieContext): The local context for execution.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parameters</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">parameters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;= &quot;</span> <span class="o">+</span> <span class="s2">&quot;self.&quot;</span> <span class="o">+</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backend_api</span> <span class="o">+</span> <span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>
    <span class="n">var_name</span> <span class="o">=</span> <span class="n">get_variable_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">local_context</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">GenieResult</span><span class="p">(</span>
        <span class="n">execute_query</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">bot</span><span class="p">,</span> <span class="n">local_context</span><span class="p">),</span> <span class="bp">self</span><span class="p">,</span> <span class="n">var_name</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">agent_acts</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>
        <span class="n">ReportAgentAct</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">var_name</span> <span class="o">+</span> <span class="s2">&quot;.result&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">action_performed</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.MoreFieldInfo.new" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">new</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">new</span><span class="p">(</span><span class="n">initialize_from_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">new</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">initialize_from_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="o">**</span><span class="n">initialize_from_dict</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.MoreFieldInfo.__setattr__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__setattr__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__setattr__</span><span class="p">(</span><span class="nf">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">GenieField</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">action_performed</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># if the worksheet has a confirm type field which is set to true</span>
            <span class="c1"># upon update, we need to set it to false</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">slottype</span> <span class="o">==</span> <span class="s2">&quot;confirm&quot;</span> <span class="ow">and</span> <span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                    <span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">GenieField</span><span class="p">)</span> <span class="ow">and</span> <span class="n">value</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                <span class="n">value</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span>
                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">GenieValue</span><span class="p">):</span>
                <span class="n">attr</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">attr</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">GenieValue</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">return</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.MoreFieldInfo.ask" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">ask</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">ask</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>This is a hack for when the user asks the system to ask a question from a different worksheet.</p>
<p>We increment the random_id to make sure that the ws is updated and the system with ask the question naturally</p>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">ask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This is a hack for when the user asks the system to ask a question from a different worksheet.</span>

<span class="sd">    We increment the random_id to make sure that the ws is updated and the system with ask the question naturally</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Ask: </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">random_id</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.MoreFieldInfo.__init__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__init__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__init__</span><span class="p">(</span><span class="nf">api_name</span><span class="p">,</span> <span class="n">parameter_name</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_name</span><span class="p">,</span> <span class="n">parameter_name</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">api_name</span> <span class="o">=</span> <span class="n">GenieField</span><span class="p">(</span><span class="s2">&quot;str&quot;</span><span class="p">,</span> <span class="s2">&quot;api_name&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">api_name</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">parameter_name</span> <span class="o">=</span> <span class="n">GenieField</span><span class="p">(</span><span class="s2">&quot;str&quot;</span><span class="p">,</span> <span class="s2">&quot;parameter_name&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">parameter_name</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">actions</span> <span class="o">=</span> <span class="n">Action</span><span class="p">(</span>
        <span class="s2">&quot;&gt;answer_clarification_question(self.api_name, self.parameter_name)&quot;</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">action_performed</span> <span class="o">=</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="src.worksheets.environment.Action" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">Action</span>


</h4>


    <div class="doc doc-contents ">


        <p>Class for managing worksheet actions.</p>
<p>This class handles action definition, execution, and result management
for worksheet operations.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.Action.action" href="#src.worksheets.environment.Action.action">action</a></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The action to perform.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>src/worksheets/environment.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span>
<span class="normal">981</span>
<span class="normal">982</span>
<span class="normal">983</span>
<span class="normal">984</span>
<span class="normal">985</span>
<span class="normal">986</span>
<span class="normal">987</span>
<span class="normal">988</span>
<span class="normal">989</span>
<span class="normal">990</span>
<span class="normal">991</span>
<span class="normal">992</span>
<span class="normal">993</span>
<span class="normal">994</span>
<span class="normal">995</span>
<span class="normal">996</span>
<span class="normal">997</span>
<span class="normal">998</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Action</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Class for managing worksheet actions.</span>

<span class="sd">    This class handles action definition, execution, and result management</span>
<span class="sd">    for worksheet operations.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        action: The action to perform.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="n">action</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">perform</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">GenieWorksheet</span><span class="p">,</span> <span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">,</span> <span class="n">local_context</span><span class="p">:</span> <span class="n">GenieContext</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Perform the action with the given context.</span>

<span class="sd">        Args:</span>
<span class="sd">            obj (GenieWorksheet): The worksheet object.</span>
<span class="sd">            bot (GenieRuntime): The bot instance.</span>
<span class="sd">            local_context (GenieContext): The local context.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: List of actions performed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">code</span> <span class="o">=</span> <span class="n">modify_action_code</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">bot</span><span class="p">,</span> <span class="n">local_context</span><span class="p">)</span>
        <span class="n">code</span> <span class="o">=</span> <span class="n">sanitize_dev_code</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">bot</span><span class="o">.</span><span class="n">get_all_variables</span><span class="p">())</span>

        <span class="c1"># this is right now a hack. We are just going to assign all the statments to a variable</span>
        <span class="c1"># and then return the variable</span>
        <span class="n">acts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># here what i need to do is:</span>
        <span class="c1"># 1. rewrite the code such that and inbuilt function appends its result to __return</span>
        <span class="c1"># 2. then return __return</span>

        <span class="c1"># We append the results to the __return variable. This is done by the rewriter</span>
        <span class="n">transformed_code</span> <span class="o">=</span> <span class="n">rewrite_action_code</span><span class="p">(</span>
            <span class="n">code</span><span class="p">,</span>
            <span class="p">[</span><span class="s2">&quot;say&quot;</span><span class="p">,</span> <span class="s2">&quot;propose&quot;</span><span class="p">,</span> <span class="s2">&quot;answer_clarification_question&quot;</span><span class="p">],</span>  <span class="c1"># predefined actions</span>
        <span class="p">)</span>
        <span class="n">code_</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;__return = []</span><span class="se">\n</span><span class="si">{</span><span class="n">transformed_code</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">local_context</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;__return&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Execute the action code</span>
        <span class="n">bot</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">code_</span><span class="p">,</span> <span class="n">local_context</span><span class="p">)</span>

        <span class="c1"># Context management</span>
        <span class="k">if</span> <span class="n">local_context</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;__return&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">acts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">local_context</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;__return&quot;</span><span class="p">])</span>
        <span class="k">del</span> <span class="n">local_context</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;__return&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="s2">&quot;_obj&quot;</span> <span class="ow">in</span> <span class="n">local_context</span><span class="o">.</span><span class="n">context</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">local_context</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;_obj&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">acts</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">





<h5 id="src.worksheets.environment.Action-attributes">Attributes</h5>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.Action.action" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">action</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">action</span> <span class="o">=</span> <span class="n">action</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<h5 id="src.worksheets.environment.Action-functions">Functions</h5>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.Action.__init__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__init__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__init__</span><span class="p">(</span><span class="nf">action</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">949</span>
<span class="normal">950</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="n">action</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.Action.__len__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__len__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__len__</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">952</span>
<span class="normal">953</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.Action.perform" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">perform</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">perform</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">GenieWorksheet</span><span class="p">,</span> <span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">,</span> <span class="n">local_context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Perform the action with the given context.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>obj</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieWorksheet" href="#src.worksheets.environment.GenieWorksheet">GenieWorksheet</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The worksheet object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bot</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieRuntime" href="#src.worksheets.environment.GenieRuntime">GenieRuntime</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The bot instance.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>local_context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieContext" href="#src.worksheets.environment.GenieContext">GenieContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The local context.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>list</code></td>            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of actions performed.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span>
<span class="normal">981</span>
<span class="normal">982</span>
<span class="normal">983</span>
<span class="normal">984</span>
<span class="normal">985</span>
<span class="normal">986</span>
<span class="normal">987</span>
<span class="normal">988</span>
<span class="normal">989</span>
<span class="normal">990</span>
<span class="normal">991</span>
<span class="normal">992</span>
<span class="normal">993</span>
<span class="normal">994</span>
<span class="normal">995</span>
<span class="normal">996</span>
<span class="normal">997</span>
<span class="normal">998</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">perform</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">GenieWorksheet</span><span class="p">,</span> <span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">,</span> <span class="n">local_context</span><span class="p">:</span> <span class="n">GenieContext</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform the action with the given context.</span>

<span class="sd">    Args:</span>
<span class="sd">        obj (GenieWorksheet): The worksheet object.</span>
<span class="sd">        bot (GenieRuntime): The bot instance.</span>
<span class="sd">        local_context (GenieContext): The local context.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: List of actions performed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">modify_action_code</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">action</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">bot</span><span class="p">,</span> <span class="n">local_context</span><span class="p">)</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">sanitize_dev_code</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">bot</span><span class="o">.</span><span class="n">get_all_variables</span><span class="p">())</span>

    <span class="c1"># this is right now a hack. We are just going to assign all the statments to a variable</span>
    <span class="c1"># and then return the variable</span>
    <span class="n">acts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># here what i need to do is:</span>
    <span class="c1"># 1. rewrite the code such that and inbuilt function appends its result to __return</span>
    <span class="c1"># 2. then return __return</span>

    <span class="c1"># We append the results to the __return variable. This is done by the rewriter</span>
    <span class="n">transformed_code</span> <span class="o">=</span> <span class="n">rewrite_action_code</span><span class="p">(</span>
        <span class="n">code</span><span class="p">,</span>
        <span class="p">[</span><span class="s2">&quot;say&quot;</span><span class="p">,</span> <span class="s2">&quot;propose&quot;</span><span class="p">,</span> <span class="s2">&quot;answer_clarification_question&quot;</span><span class="p">],</span>  <span class="c1"># predefined actions</span>
    <span class="p">)</span>
    <span class="n">code_</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;__return = []</span><span class="se">\n</span><span class="si">{</span><span class="n">transformed_code</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="n">local_context</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;__return&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Execute the action code</span>
    <span class="n">bot</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">code_</span><span class="p">,</span> <span class="n">local_context</span><span class="p">)</span>

    <span class="c1"># Context management</span>
    <span class="k">if</span> <span class="n">local_context</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;__return&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">acts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">local_context</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;__return&quot;</span><span class="p">])</span>
    <span class="k">del</span> <span class="n">local_context</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;__return&quot;</span><span class="p">]</span>

    <span class="k">if</span> <span class="s2">&quot;_obj&quot;</span> <span class="ow">in</span> <span class="n">local_context</span><span class="o">.</span><span class="n">context</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">local_context</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;_obj&quot;</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">acts</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="src.worksheets.environment.GenieRuntime" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">GenieRuntime</span>


</h4>


    <div class="doc doc-contents ">


        <p>Main runtime environment for Genie system.</p>
<p>This class manages the execution environment, including worksheet registration,
context management, and action execution.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieRuntime.name" href="#src.worksheets.environment.GenieRuntime.name">name</a></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Runtime instance name.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieRuntime.prompt_dir" href="#src.worksheets.environment.GenieRuntime.prompt_dir">prompt_dir</a></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory for prompts.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieRuntime.args" href="#src.worksheets.environment.GenieRuntime.args">args</a></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional arguments.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieRuntime.genie_worksheets" href="#src.worksheets.environment.GenieRuntime.genie_worksheets">genie_worksheets</a></code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Registered worksheets.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieRuntime.genie_db_models" href="#src.worksheets.environment.GenieRuntime.genie_db_models">genie_db_models</a></code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Registered database models.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieRuntime.starting_prompt" href="#src.worksheets.environment.GenieRuntime.starting_prompt">starting_prompt</a></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Initial system prompt.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieRuntime.description" href="#src.worksheets.environment.GenieRuntime.description">description</a></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Runtime description.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieRuntime.suql_runner" href="#src.worksheets.environment.GenieRuntime.suql_runner">suql_runner</a></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>SQL query runner.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieRuntime.suql_parser" href="#src.worksheets.environment.GenieRuntime.suql_parser">suql_parser</a></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>SQL query parser.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieRuntime.context" href="#src.worksheets.environment.GenieRuntime.context">context</a></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieContext" href="#src.worksheets.environment.GenieContext">GenieContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Global context.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieRuntime.dlg_history" href="#src.worksheets.environment.GenieRuntime.dlg_history">dlg_history</a></code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dialogue history.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>src/worksheets/environment.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">GenieRuntime</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Main runtime environment for Genie system.</span>

<span class="sd">    This class manages the execution environment, including worksheet registration,</span>
<span class="sd">    context management, and action execution.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        name (str): Runtime instance name.</span>
<span class="sd">        prompt_dir (str): Directory for prompts.</span>
<span class="sd">        args: Additional arguments.</span>
<span class="sd">        genie_worksheets (list): Registered worksheets.</span>
<span class="sd">        genie_db_models (list): Registered database models.</span>
<span class="sd">        starting_prompt (str): Initial system prompt.</span>
<span class="sd">        description (str): Runtime description.</span>
<span class="sd">        suql_runner: SQL query runner.</span>
<span class="sd">        suql_parser: SQL query parser.</span>
<span class="sd">        context (GenieContext): Global context.</span>
<span class="sd">        dlg_history (list): Dialogue history.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="c1"># The name of the bot</span>
        <span class="n">name</span><span class="p">,</span>
        <span class="c1"># The directory where the prompts are stored</span>
        <span class="n">prompt_dir</span><span class="p">,</span>
        <span class="c1"># The starting prompt of the bot</span>
        <span class="n">starting_prompt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="c1"># A description of the bot</span>
        <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="c1"># Any additional arguments</span>
        <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="c1"># Define the API to be used</span>
        <span class="n">api</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="c1"># The SUQL runner (SUQLKnowledgeBase)</span>
        <span class="n">suql_runner</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="c1"># The SUQL parser (SUQLParser)</span>
        <span class="n">suql_parser</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prompt_dir</span> <span class="o">=</span> <span class="n">prompt_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">genie_worksheets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">genie_db_models</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">starting_prompt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">starting_prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Hello! I&#39;m the </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">. What would you like to do?&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">starting_prompt</span> <span class="o">=</span> <span class="n">starting_prompt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">suql_runner</span> <span class="o">=</span> <span class="n">suql_runner</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">suql_parser</span> <span class="o">=</span> <span class="n">suql_parser</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_interpreter</span> <span class="o">=</span> <span class="n">GenieInterpreter</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">GenieContext</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">local_context_init</span> <span class="o">=</span> <span class="n">GenieContext</span><span class="p">()</span>

        <span class="c1"># add the api to the context</span>
        <span class="k">if</span> <span class="n">api</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">apis</span> <span class="o">=</span> <span class="n">api</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">api_funcs</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isfunction</span><span class="p">)</span>
                <span class="n">apis</span> <span class="o">=</span> <span class="p">[</span><span class="n">func</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">api_funcs</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">apis</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dlg_history</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">order_of_actions</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">apis</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">suql_runner</span><span class="p">])</span>

        <span class="n">Answer</span><span class="o">.</span><span class="n">bot</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="c1"># Add the predefined apis and functions</span>
        <span class="n">apis</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">propose</span><span class="p">,</span>
                <span class="n">confirm</span><span class="p">,</span>
                <span class="n">GenieValue</span><span class="p">,</span>
                <span class="n">partial</span><span class="p">(</span><span class="n">answer_clarification_question</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">),</span>
                <span class="n">Answer</span><span class="p">,</span>
                <span class="n">MoreFieldInfo</span><span class="p">,</span>
                <span class="n">say</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">api</span> <span class="ow">in</span> <span class="n">apis</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_api</span><span class="p">(</span><span class="n">api</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reset the bot&#39;s context and state.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">reset_agent_acts</span><span class="p">()</span>
        <span class="n">to_delete</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">GenieWorksheet</span><span class="p">):</span>
                <span class="n">to_delete</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">to_delete</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dlg_history</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">order_of_actions</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">add_worksheet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ws</span><span class="p">:</span> <span class="nb">type</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a worksheet to the bot&#39;s context.</span>

<span class="sd">        Args:</span>
<span class="sd">            ws (type): The worksheet class to add.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ws</span><span class="o">.</span><span class="n">bot</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="n">ws</span><span class="p">):</span>
            <span class="n">field</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">ws</span>
            <span class="n">field</span><span class="o">.</span><span class="n">bot</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">genie_worksheets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ws</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">ws</span><span class="p">)</span>
        <span class="c1"># self.context.update(self._grab_all_variables(ws))</span>
        <span class="c1"># self.local_context_init.update(self._grab_all_variables(ws))</span>

    <span class="k">def</span> <span class="nf">add_db_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_model</span><span class="p">:</span> <span class="nb">type</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a database model to the bot&#39;s context.</span>

<span class="sd">        Args:</span>
<span class="sd">            db_model (type): The database model class to add.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">db_model</span><span class="o">.</span><span class="n">bot</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="n">db_model</span><span class="p">):</span>
            <span class="n">field</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">db_model</span>
            <span class="n">field</span><span class="o">.</span><span class="n">bot</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">genie_db_models</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">db_model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">db_model</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">db_model</span><span class="p">)</span>
        <span class="c1"># self.context.update(self._grab_all_variables(db_model))</span>
        <span class="c1"># self.local_context_init.update(self._grab_all_variables(db_model))</span>

    <span class="k">def</span> <span class="nf">add_api</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add an API function to the context.</span>

<span class="sd">        Args:</span>
<span class="sd">            api (Any): The API function or object to add.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">callable_name</span><span class="p">(</span><span class="n">api</span><span class="p">),</span> <span class="n">api</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">geniews</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">predicates</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">outputs</span><span class="p">:</span> <span class="n">GenieWorksheet</span> <span class="o">|</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">backend_api</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">actions</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Decorator to define a Genie worksheet.&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">predicate</span> <span class="o">=</span> <span class="n">predicates</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">outputs</span> <span class="o">=</span> <span class="n">outputs</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">backend_api</span> <span class="o">=</span> <span class="n">backend_api</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">actions</span> <span class="o">=</span> <span class="n">actions</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_worksheet</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">cls</span>

        <span class="k">return</span> <span class="n">decorator</span>

    <span class="k">def</span> <span class="nf">genie_sql</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">outputs</span><span class="p">:</span> <span class="n">GenieWorksheet</span> <span class="o">|</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">actions</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Decorator to define a Genie database model.&quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">outputs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">outputs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">outputs</span> <span class="o">=</span> <span class="n">outputs</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">actions</span> <span class="o">=</span> <span class="n">actions</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_db_model</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">cls</span>

        <span class="k">return</span> <span class="n">decorator</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">local_context</span><span class="p">:</span> <span class="n">GenieContext</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sp</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute the given code in the context of the bot.</span>

<span class="sd">        Args:</span>
<span class="sd">            code (str): The code to execute.</span>
<span class="sd">            local_context (GenieContext | None, optional): Local context to use. Defaults to None.</span>
<span class="sd">            sp (bool, optional): Whether this is a semantic parser execution. Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">local_context</span><span class="p">:</span>
            <span class="n">local_context</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_context_init</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">local_context</span> <span class="o">=</span> <span class="n">GenieContext</span><span class="p">(</span>
                <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_context_init</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_interpreter</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="n">code</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">,</span>
            <span class="n">local_context</span><span class="p">,</span>
            <span class="n">sp</span><span class="o">=</span><span class="n">sp</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Add the parents for all the objects in the local context</span>
        <span class="n">collect_all_parents</span><span class="p">(</span><span class="n">local_context</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">local_context</span><span class="p">:</span> <span class="n">GenieContext</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluate the given code in the context of the bot.</span>

<span class="sd">        Args:</span>
<span class="sd">            code (str): The code to evaluate.</span>
<span class="sd">            local_context (GenieContext | None, optional): Local context to use. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Any: The result of the evaluation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">local_context</span><span class="p">:</span>
            <span class="n">local_context</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_context_init</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">local_context</span> <span class="o">=</span> <span class="n">GenieContext</span><span class="p">(</span>
                <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_context_init</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interpreter</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span>
            <span class="n">code</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">,</span>
            <span class="n">local_context</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">update_from_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;add new variables to the context&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_available_worksheets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all available worksheets based on their predicates.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">ws</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">genie_worksheets</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ws</span><span class="o">.</span><span class="n">predicate</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">eval_predicates</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">predicate</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
                    <span class="k">yield</span> <span class="n">ws</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">ws</span>

    <span class="k">def</span> <span class="nf">get_available_dbs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all available database models based on their predicates.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">db</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">genie_db_models</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">db</span><span class="o">.</span><span class="n">predicate</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">eval_predicates</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">predicate</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
                    <span class="k">yield</span> <span class="n">db</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">db</span>

    <span class="k">def</span> <span class="nf">get_all_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all fields (variables) from all worksheets.&quot;&quot;&quot;</span>
        <span class="n">all_variables</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ws</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">genie_worksheets</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="n">ws</span><span class="p">):</span>
                <span class="n">all_variables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">all_variables</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">





<h5 id="src.worksheets.environment.GenieRuntime-attributes">Attributes</h5>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieRuntime.prompt_dir" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">prompt_dir</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">prompt_dir</span> <span class="o">=</span> <span class="n">prompt_dir</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieRuntime.args" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">args</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieRuntime.name" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">name</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieRuntime.genie_worksheets" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">genie_worksheets</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">genie_worksheets</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieRuntime.genie_db_models" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">genie_db_models</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">genie_db_models</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieRuntime.starting_prompt" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">starting_prompt</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">starting_prompt</span> <span class="o">=</span> <span class="n">starting_prompt</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieRuntime.description" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">description</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieRuntime.suql_runner" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">suql_runner</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">suql_runner</span> <span class="o">=</span> <span class="n">suql_runner</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieRuntime.suql_parser" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">suql_parser</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">suql_parser</span> <span class="o">=</span> <span class="n">suql_parser</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieRuntime._interpreter" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">_interpreter</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">_interpreter</span> <span class="o">=</span> <span class="n">GenieInterpreter</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieRuntime.context" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">context</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">context</span> <span class="o">=</span> <span class="n">GenieContext</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieRuntime.local_context_init" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">local_context_init</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">local_context_init</span> <span class="o">=</span> <span class="n">GenieContext</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieRuntime.dlg_history" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">dlg_history</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">dlg_history</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieRuntime.order_of_actions" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">order_of_actions</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">order_of_actions</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<h5 id="src.worksheets.environment.GenieRuntime-functions">Functions</h5>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieRuntime.__init__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__init__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__init__</span><span class="p">(</span><span class="nf">name</span><span class="p">,</span> <span class="n">prompt_dir</span><span class="p">,</span> <span class="n">starting_prompt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">api</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">suql_runner</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">suql_parser</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="c1"># The name of the bot</span>
    <span class="n">name</span><span class="p">,</span>
    <span class="c1"># The directory where the prompts are stored</span>
    <span class="n">prompt_dir</span><span class="p">,</span>
    <span class="c1"># The starting prompt of the bot</span>
    <span class="n">starting_prompt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="c1"># A description of the bot</span>
    <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="c1"># Any additional arguments</span>
    <span class="n">args</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="c1"># Define the API to be used</span>
    <span class="n">api</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="c1"># The SUQL runner (SUQLKnowledgeBase)</span>
    <span class="n">suql_runner</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="c1"># The SUQL parser (SUQLParser)</span>
    <span class="n">suql_parser</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">prompt_dir</span> <span class="o">=</span> <span class="n">prompt_dir</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">genie_worksheets</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">genie_db_models</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">starting_prompt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">starting_prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Hello! I&#39;m the </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">. What would you like to do?&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">starting_prompt</span> <span class="o">=</span> <span class="n">starting_prompt</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">suql_runner</span> <span class="o">=</span> <span class="n">suql_runner</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">suql_parser</span> <span class="o">=</span> <span class="n">suql_parser</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_interpreter</span> <span class="o">=</span> <span class="n">GenieInterpreter</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">GenieContext</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">local_context_init</span> <span class="o">=</span> <span class="n">GenieContext</span><span class="p">()</span>

    <span class="c1"># add the api to the context</span>
    <span class="k">if</span> <span class="n">api</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">apis</span> <span class="o">=</span> <span class="n">api</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">api_funcs</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span><span class="n">api</span><span class="p">,</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isfunction</span><span class="p">)</span>
            <span class="n">apis</span> <span class="o">=</span> <span class="p">[</span><span class="n">func</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">func</span> <span class="ow">in</span> <span class="n">api_funcs</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">apis</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dlg_history</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">order_of_actions</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">apis</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">suql_runner</span><span class="p">])</span>

    <span class="n">Answer</span><span class="o">.</span><span class="n">bot</span> <span class="o">=</span> <span class="bp">self</span>

    <span class="c1"># Add the predefined apis and functions</span>
    <span class="n">apis</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">propose</span><span class="p">,</span>
            <span class="n">confirm</span><span class="p">,</span>
            <span class="n">GenieValue</span><span class="p">,</span>
            <span class="n">partial</span><span class="p">(</span><span class="n">answer_clarification_question</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">),</span>
            <span class="n">Answer</span><span class="p">,</span>
            <span class="n">MoreFieldInfo</span><span class="p">,</span>
            <span class="n">say</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">api</span> <span class="ow">in</span> <span class="n">apis</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_api</span><span class="p">(</span><span class="n">api</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieRuntime.reset" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">reset</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">reset</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Reset the bot's context and state.</p>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reset the bot&#39;s context and state.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">reset_agent_acts</span><span class="p">()</span>
    <span class="n">to_delete</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">GenieWorksheet</span><span class="p">):</span>
            <span class="n">to_delete</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">to_delete</span><span class="p">:</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dlg_history</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">order_of_actions</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieRuntime.add_worksheet" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">add_worksheet</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">add_worksheet</span><span class="p">(</span><span class="n">ws</span><span class="p">:</span> <span class="nb">type</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Add a worksheet to the bot's context.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ws</code>
            </td>
            <td>
                  <code>type</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The worksheet class to add.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_worksheet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ws</span><span class="p">:</span> <span class="nb">type</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a worksheet to the bot&#39;s context.</span>

<span class="sd">    Args:</span>
<span class="sd">        ws (type): The worksheet class to add.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ws</span><span class="o">.</span><span class="n">bot</span> <span class="o">=</span> <span class="bp">self</span>
    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="n">ws</span><span class="p">):</span>
        <span class="n">field</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">ws</span>
        <span class="n">field</span><span class="o">.</span><span class="n">bot</span> <span class="o">=</span> <span class="bp">self</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">genie_worksheets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ws</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">ws</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieRuntime.add_db_model" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">add_db_model</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">add_db_model</span><span class="p">(</span><span class="n">db_model</span><span class="p">:</span> <span class="nb">type</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Add a database model to the bot's context.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>db_model</code>
            </td>
            <td>
                  <code>type</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The database model class to add.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_db_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_model</span><span class="p">:</span> <span class="nb">type</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a database model to the bot&#39;s context.</span>

<span class="sd">    Args:</span>
<span class="sd">        db_model (type): The database model class to add.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">db_model</span><span class="o">.</span><span class="n">bot</span> <span class="o">=</span> <span class="bp">self</span>
    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="n">db_model</span><span class="p">):</span>
        <span class="n">field</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">db_model</span>
        <span class="n">field</span><span class="o">.</span><span class="n">bot</span> <span class="o">=</span> <span class="bp">self</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">genie_db_models</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">db_model</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">db_model</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">db_model</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieRuntime.add_api" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">add_api</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">add_api</span><span class="p">(</span><span class="n">api</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Add an API function to the context.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>api</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The API function or object to add.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_api</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add an API function to the context.</span>

<span class="sd">    Args:</span>
<span class="sd">        api (Any): The API function or object to add.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">callable_name</span><span class="p">(</span><span class="n">api</span><span class="p">),</span> <span class="n">api</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieRuntime.geniews" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">geniews</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">geniews</span><span class="p">(</span><span class="n">predicates</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">outputs</span><span class="p">:</span> <span class="n">GenieWorksheet</span> <span class="o">|</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">backend_api</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">actions</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Decorator to define a Genie worksheet.</p>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">geniews</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">predicates</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">outputs</span><span class="p">:</span> <span class="n">GenieWorksheet</span> <span class="o">|</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">backend_api</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">actions</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Decorator to define a Genie worksheet.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">predicate</span> <span class="o">=</span> <span class="n">predicates</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">outputs</span> <span class="o">=</span> <span class="n">outputs</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">backend_api</span> <span class="o">=</span> <span class="n">backend_api</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">actions</span> <span class="o">=</span> <span class="n">actions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_worksheet</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span>

    <span class="k">return</span> <span class="n">decorator</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieRuntime.genie_sql" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">genie_sql</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">genie_sql</span><span class="p">(</span><span class="n">outputs</span><span class="p">:</span> <span class="n">GenieWorksheet</span> <span class="o">|</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">actions</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Decorator to define a Genie database model.</p>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">genie_sql</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">outputs</span><span class="p">:</span> <span class="n">GenieWorksheet</span> <span class="o">|</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">actions</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Decorator to define a Genie database model.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">outputs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">outputs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">outputs</span> <span class="o">=</span> <span class="n">outputs</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">actions</span> <span class="o">=</span> <span class="n">actions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_db_model</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span>

    <span class="k">return</span> <span class="n">decorator</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieRuntime.execute" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">execute</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">execute</span><span class="p">(</span><span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">local_context</span><span class="p">:</span> <span class="n">GenieContext</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sp</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Execute the given code in the context of the bot.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>code</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The code to execute.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>local_context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieContext" href="#src.worksheets.environment.GenieContext">GenieContext</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Local context to use. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sp</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether this is a semantic parser execution. Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">execute</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">local_context</span><span class="p">:</span> <span class="n">GenieContext</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sp</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute the given code in the context of the bot.</span>

<span class="sd">    Args:</span>
<span class="sd">        code (str): The code to execute.</span>
<span class="sd">        local_context (GenieContext | None, optional): Local context to use. Defaults to None.</span>
<span class="sd">        sp (bool, optional): Whether this is a semantic parser execution. Defaults to False.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">local_context</span><span class="p">:</span>
        <span class="n">local_context</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_context_init</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">local_context</span> <span class="o">=</span> <span class="n">GenieContext</span><span class="p">(</span>
            <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_context_init</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_interpreter</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
        <span class="n">code</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">,</span>
        <span class="n">local_context</span><span class="p">,</span>
        <span class="n">sp</span><span class="o">=</span><span class="n">sp</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Add the parents for all the objects in the local context</span>
    <span class="n">collect_all_parents</span><span class="p">(</span><span class="n">local_context</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieRuntime.eval" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">eval</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nb">eval</span><span class="p">(</span><span class="nf">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">local_context</span><span class="p">:</span> <span class="n">GenieContext</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Evaluate the given code in the context of the bot.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>code</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The code to evaluate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>local_context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieContext" href="#src.worksheets.environment.GenieContext">GenieContext</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Local context to use. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Any</code></td>            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The result of the evaluation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">local_context</span><span class="p">:</span> <span class="n">GenieContext</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Evaluate the given code in the context of the bot.</span>

<span class="sd">    Args:</span>
<span class="sd">        code (str): The code to evaluate.</span>
<span class="sd">        local_context (GenieContext | None, optional): Local context to use. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Any: The result of the evaluation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">local_context</span><span class="p">:</span>
        <span class="n">local_context</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_context_init</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">local_context</span> <span class="o">=</span> <span class="n">GenieContext</span><span class="p">(</span>
            <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">local_context_init</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_interpreter</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span>
        <span class="n">code</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">,</span>
        <span class="n">local_context</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieRuntime.update_from_context" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">update_from_context</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">update_from_context</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>add new variables to the context</p>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update_from_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;add new variables to the context&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieRuntime.get_available_worksheets" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_available_worksheets</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_available_worksheets</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get all available worksheets based on their predicates.</p>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_available_worksheets</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all available worksheets based on their predicates.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">ws</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">genie_worksheets</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ws</span><span class="o">.</span><span class="n">predicate</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">eval_predicates</span><span class="p">(</span><span class="n">ws</span><span class="o">.</span><span class="n">predicate</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">ws</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">ws</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieRuntime.get_available_dbs" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_available_dbs</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_available_dbs</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get all available database models based on their predicates.</p>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_available_dbs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all available database models based on their predicates.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">db</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">genie_db_models</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">db</span><span class="o">.</span><span class="n">predicate</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">eval_predicates</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">predicate</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
                <span class="k">yield</span> <span class="n">db</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">db</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieRuntime.get_all_variables" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_all_variables</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_all_variables</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get all fields (variables) from all worksheets.</p>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_all_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all fields (variables) from all worksheets.&quot;&quot;&quot;</span>
    <span class="n">all_variables</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ws</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">genie_worksheets</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="n">ws</span><span class="p">):</span>
            <span class="n">all_variables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">all_variables</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="src.worksheets.environment.GenieInterpreter" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">GenieInterpreter</span>


</h4>


    <div class="doc doc-contents ">


        <p>Interpreter for executing Genie code.</p>
<p>This class provides code execution capabilities within the Genie environment,
handling variable resolution and context management.</p>






              <details class="quote">
                <summary>Source code in <code>src/worksheets/environment.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">GenieInterpreter</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interpreter for executing Genie code.</span>

<span class="sd">    This class provides code execution capabilities within the Genie environment,</span>
<span class="sd">    handling variable resolution and context management.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">global_context</span><span class="p">,</span> <span class="n">local_context</span><span class="p">,</span> <span class="n">sp</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="c1"># There are some issues here. since there are no numbers now,</span>
        <span class="c1"># when we do courses_to_take = CoursesToTake(courses_0_details=course)</span>
        <span class="c1"># since courses_to_take is a field in main worksheet, the code gets modified to:</span>
        <span class="c1"># main.courses_to_take.value = CoursesToTake(courses_0_details=course)</span>
        <span class="c1"># One easy fix could be if you are setting a GenieWorksheet to a field, then</span>
        <span class="c1"># do not modify the code.</span>

        <span class="c1"># Another way is to have an, argument which mentions if the execution is from semantic parser</span>
        <span class="c1"># if it is, then do not modify the code.</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">sp</span><span class="p">:</span>
            <span class="c1"># If the execution is for action then we replace the undefined variables</span>
            <span class="n">code</span> <span class="o">=</span> <span class="n">replace_undefined_variables</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">local_context</span><span class="p">,</span> <span class="n">global_context</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">exec</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">global_context</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="n">local_context</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">NameError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">local_context</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="c1"># regex to catch the variable name. If the variable name is &quot;user_task&quot; then we want to find &quot;user_task.value&quot; as well until we hit a space.</span>
                <span class="c1"># This is just a hack ideally we should traverse the ast or at least use the tokenize module to find the variable name</span>
                <span class="n">var_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">rf</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">\.\w+&quot;</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">var_name</span><span class="p">:</span>
                    <span class="n">code</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">var_name</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">exec</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">global_context</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="n">local_context</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
                <span class="n">local_context</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Code: </span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">global_context</span><span class="p">,</span> <span class="n">local_context</span><span class="p">):</span>
        <span class="c1"># perform rewrite to update any variables that is not in the local context</span>
        <span class="c1"># by using the variable resolver</span>
        <span class="n">code</span> <span class="o">=</span> <span class="n">replace_undefined_variables</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">local_context</span><span class="p">,</span> <span class="n">global_context</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">global_context</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="n">local_context</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">NameError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<h5 id="src.worksheets.environment.GenieInterpreter-functions">Functions</h5>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieInterpreter.execute" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">execute</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">execute</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">global_context</span><span class="p">,</span> <span class="n">local_context</span><span class="p">,</span> <span class="n">sp</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">global_context</span><span class="p">,</span> <span class="n">local_context</span><span class="p">,</span> <span class="n">sp</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="c1"># There are some issues here. since there are no numbers now,</span>
    <span class="c1"># when we do courses_to_take = CoursesToTake(courses_0_details=course)</span>
    <span class="c1"># since courses_to_take is a field in main worksheet, the code gets modified to:</span>
    <span class="c1"># main.courses_to_take.value = CoursesToTake(courses_0_details=course)</span>
    <span class="c1"># One easy fix could be if you are setting a GenieWorksheet to a field, then</span>
    <span class="c1"># do not modify the code.</span>

    <span class="c1"># Another way is to have an, argument which mentions if the execution is from semantic parser</span>
    <span class="c1"># if it is, then do not modify the code.</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">sp</span><span class="p">:</span>
        <span class="c1"># If the execution is for action then we replace the undefined variables</span>
        <span class="n">code</span> <span class="o">=</span> <span class="n">replace_undefined_variables</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">local_context</span><span class="p">,</span> <span class="n">global_context</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">exec</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">global_context</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="n">local_context</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">NameError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">local_context</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="c1"># regex to catch the variable name. If the variable name is &quot;user_task&quot; then we want to find &quot;user_task.value&quot; as well until we hit a space.</span>
            <span class="c1"># This is just a hack ideally we should traverse the ast or at least use the tokenize module to find the variable name</span>
            <span class="n">var_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="sa">rf</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">\.\w+&quot;</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">var_name</span><span class="p">:</span>
                <span class="n">code</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">var_name</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">exec</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">global_context</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="n">local_context</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
            <span class="n">local_context</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Code: </span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieInterpreter.eval" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">eval</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nb">eval</span><span class="p">(</span><span class="nf">code</span><span class="p">,</span> <span class="n">global_context</span><span class="p">,</span> <span class="n">local_context</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">global_context</span><span class="p">,</span> <span class="n">local_context</span><span class="p">):</span>
    <span class="c1"># perform rewrite to update any variables that is not in the local context</span>
    <span class="c1"># by using the variable resolver</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">replace_undefined_variables</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">local_context</span><span class="p">,</span> <span class="n">global_context</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">global_context</span><span class="o">.</span><span class="n">context</span><span class="p">,</span> <span class="n">local_context</span><span class="o">.</span><span class="n">context</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">NameError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="src.worksheets.environment.GenieContext" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">GenieContext</span>


</h4>


    <div class="doc doc-contents ">


        <p>Context manager for Genie runtime.</p>
<p>This class manages variable context and agent actions during runtime.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieContext.context" href="#src.worksheets.environment.GenieContext.context">context</a></code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The context dictionary.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieContext.agent_acts" href="#src.worksheets.environment.GenieContext.agent_acts">agent_acts</a></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current agent actions.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>src/worksheets/environment.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">GenieContext</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Context manager for Genie runtime.</span>

<span class="sd">    This class manages variable context and agent actions during runtime.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        context (dict): The context dictionary.</span>
<span class="sd">        agent_acts: Current agent actions.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">context</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">agent_acts</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_agent_acts</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">reset_agent_acts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">agent_acts</span> <span class="o">=</span> <span class="n">AgentActs</span><span class="p">({})</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update the context with new content.</span>

<span class="sd">        Args:</span>
<span class="sd">            content (dict): Dictionary of content to update with.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">content</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s2">&quot;answer&quot;</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">!=</span> <span class="n">value</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                        <span class="p">]</span>  <span class="c1"># TODO: make the line below this else: if</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a value from the context.</span>

<span class="sd">        Args:</span>
<span class="sd">            key (str): The key to get.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Any: The value associated with the key.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set a value in the context.</span>

<span class="sd">        Args:</span>
<span class="sd">            key (str): The key to set.</span>
<span class="sd">            value (Any): The value to set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s2">&quot;answer&quot;</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="n">key</span><span class="p">]]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete a key from the context.</span>

<span class="sd">        Args:</span>
<span class="sd">            key (str): The key to delete.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">





<h5 id="src.worksheets.environment.GenieContext-attributes">Attributes</h5>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieContext.context" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">context</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">context</span> <span class="o">=</span> <span class="n">context</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.GenieContext.agent_acts" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">agent_acts</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">agent_acts</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<h5 id="src.worksheets.environment.GenieContext-functions">Functions</h5>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieContext.__init__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__init__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__init__</span><span class="p">(</span><span class="nf">context</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">context</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">agent_acts</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">reset_agent_acts</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieContext.reset_agent_acts" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">reset_agent_acts</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">reset_agent_acts</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1323</span>
<span class="normal">1324</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">reset_agent_acts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">agent_acts</span> <span class="o">=</span> <span class="n">AgentActs</span><span class="p">({})</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieContext.update" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">update</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">update</span><span class="p">(</span><span class="n">content</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Update the context with new content.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>content</code>
            </td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of content to update with.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Update the context with new content.</span>

<span class="sd">    Args:</span>
<span class="sd">        content (dict): Dictionary of content to update with.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">content</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s2">&quot;answer&quot;</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">!=</span> <span class="n">value</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                    <span class="p">]</span>  <span class="c1"># TODO: make the line below this else: if</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">v</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieContext.get" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get a value from the context.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>key</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The key to get.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Any</code></td>            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The value associated with the key.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a value from the context.</span>

<span class="sd">    Args:</span>
<span class="sd">        key (str): The key to get.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Any: The value associated with the key.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieContext.set" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">set</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nb">set</span><span class="p">(</span><span class="nf">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Set a value in the context.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>key</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The key to set.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>value</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The value to set.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set a value in the context.</span>

<span class="sd">    Args:</span>
<span class="sd">        key (str): The key to set.</span>
<span class="sd">        value (Any): The value to set.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s2">&quot;answer&quot;</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="nb">list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="n">key</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.GenieContext.delete" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">delete</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">delete</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Delete a key from the context.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>key</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The key to delete.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Delete a key from the context.</span>

<span class="sd">    Args:</span>
<span class="sd">        key (str): The key to delete.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="src.worksheets.environment.TurnContext" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">TurnContext</span>


</h4>


    <div class="doc doc-contents ">


        <p>Context manager for dialogue turns.</p>
<p>This class manages context for individual dialogue turns.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.TurnContext.context" href="#src.worksheets.environment.TurnContext.context">context</a></code></td>
            <td>
                  <code>list[<a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieContext" href="#src.worksheets.environment.GenieContext">GenieContext</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of contexts for each turn.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>src/worksheets/environment.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TurnContext</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Context manager for dialogue turns.</span>

<span class="sd">    This class manages context for individual dialogue turns.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        context (list[GenieContext]): List of contexts for each turn.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">GenieContext</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">add_turn_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add a new turn context.</span>

<span class="sd">        Args:</span>
<span class="sd">            context (GenieContext): The context to add for this turn.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">context</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">





<h5 id="src.worksheets.environment.TurnContext-attributes">Attributes</h5>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.TurnContext.context" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">context</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">context</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">GenieContext</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<h5 id="src.worksheets.environment.TurnContext-functions">Functions</h5>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.TurnContext.__init__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__init__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__init__</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1392</span>
<span class="normal">1393</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">GenieContext</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.TurnContext.add_turn_context" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">add_turn_context</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">add_turn_context</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Add a new turn context.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieContext" href="#src.worksheets.environment.GenieContext">GenieContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The context to add for this turn.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_turn_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a new turn context.</span>

<span class="sd">    Args:</span>
<span class="sd">        context (GenieContext): The context to add for this turn.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">context</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="src.worksheets.environment.AgentAct" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">AgentAct</span>


</h4>


    <div class="doc doc-contents ">


        <p>Base class for agent actions.</p>
<p>This class serves as the foundation for different types of agent actions
in the system.</p>






              <details class="quote">
                <summary>Source code in <code>src/worksheets/environment.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1931</span>
<span class="normal">1932</span>
<span class="normal">1933</span>
<span class="normal">1934</span>
<span class="normal">1935</span>
<span class="normal">1936</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">AgentAct</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base class for agent actions.</span>

<span class="sd">    This class serves as the foundation for different types of agent actions</span>
<span class="sd">    in the system.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="src.worksheets.environment.ReportAgentAct" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">ReportAgentAct</span>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.AgentAct" href="#src.worksheets.environment.AgentAct">AgentAct</a></code></p>


        <p>Action for reporting query results or messages.</p>
<p>This class handles reporting of query results and system messages.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.ReportAgentAct.query" href="#src.worksheets.environment.ReportAgentAct.query">query</a></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieField" href="#src.worksheets.environment.GenieField">GenieField</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The query being reported.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.ReportAgentAct.message" href="#src.worksheets.environment.ReportAgentAct.message">message</a></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The message or result to report.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.ReportAgentAct.query_var_name" href="#src.worksheets.environment.ReportAgentAct.query_var_name">query_var_name</a></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Variable name for the query.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.ReportAgentAct.message_var_name" href="#src.worksheets.environment.ReportAgentAct.message_var_name">message_var_name</a></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Variable name for the message.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>src/worksheets/environment.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1939</span>
<span class="normal">1940</span>
<span class="normal">1941</span>
<span class="normal">1942</span>
<span class="normal">1943</span>
<span class="normal">1944</span>
<span class="normal">1945</span>
<span class="normal">1946</span>
<span class="normal">1947</span>
<span class="normal">1948</span>
<span class="normal">1949</span>
<span class="normal">1950</span>
<span class="normal">1951</span>
<span class="normal">1952</span>
<span class="normal">1953</span>
<span class="normal">1954</span>
<span class="normal">1955</span>
<span class="normal">1956</span>
<span class="normal">1957</span>
<span class="normal">1958</span>
<span class="normal">1959</span>
<span class="normal">1960</span>
<span class="normal">1961</span>
<span class="normal">1962</span>
<span class="normal">1963</span>
<span class="normal">1964</span>
<span class="normal">1965</span>
<span class="normal">1966</span>
<span class="normal">1967</span>
<span class="normal">1968</span>
<span class="normal">1969</span>
<span class="normal">1970</span>
<span class="normal">1971</span>
<span class="normal">1972</span>
<span class="normal">1973</span>
<span class="normal">1974</span>
<span class="normal">1975</span>
<span class="normal">1976</span>
<span class="normal">1977</span>
<span class="normal">1978</span>
<span class="normal">1979</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ReportAgentAct</span><span class="p">(</span><span class="n">AgentAct</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Action for reporting query results or messages.</span>

<span class="sd">    This class handles reporting of query results and system messages.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        query (GenieField): The query being reported.</span>
<span class="sd">        message: The message or result to report.</span>
<span class="sd">        query_var_name: Variable name for the query.</span>
<span class="sd">        message_var_name: Variable name for the message.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">query</span><span class="p">:</span> <span class="n">GenieField</span><span class="p">,</span>
        <span class="n">message</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">query_var_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">message_var_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query</span> <span class="o">=</span> <span class="n">query</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_var_name</span> <span class="o">=</span> <span class="n">query_var_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message_var_name</span> <span class="o">=</span> <span class="n">message_var_name</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_var_name</span><span class="p">:</span>
            <span class="n">query_var_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_var_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query_var_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">message_var_name</span><span class="p">:</span>
            <span class="n">message_var_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">message_var_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">message_var_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Report(</span><span class="si">{</span><span class="n">query_var_name</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">message_var_name</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ReportAgentAct</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">query</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">message</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">





<h5 id="src.worksheets.environment.ReportAgentAct-attributes">Attributes</h5>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.ReportAgentAct.query" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">query</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">query</span> <span class="o">=</span> <span class="n">query</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.ReportAgentAct.message" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">message</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">message</span> <span class="o">=</span> <span class="n">message</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.ReportAgentAct.query_var_name" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">query_var_name</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">query_var_name</span> <span class="o">=</span> <span class="n">query_var_name</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.ReportAgentAct.message_var_name" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">message_var_name</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">message_var_name</span> <span class="o">=</span> <span class="n">message_var_name</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<h5 id="src.worksheets.environment.ReportAgentAct-functions">Functions</h5>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.ReportAgentAct.__init__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__init__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__init__</span><span class="p">(</span><span class="nf">query</span><span class="p">:</span> <span class="n">GenieField</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">query_var_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">message_var_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1951</span>
<span class="normal">1952</span>
<span class="normal">1953</span>
<span class="normal">1954</span>
<span class="normal">1955</span>
<span class="normal">1956</span>
<span class="normal">1957</span>
<span class="normal">1958</span>
<span class="normal">1959</span>
<span class="normal">1960</span>
<span class="normal">1961</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">query</span><span class="p">:</span> <span class="n">GenieField</span><span class="p">,</span>
    <span class="n">message</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
    <span class="n">query_var_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">message_var_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">query</span> <span class="o">=</span> <span class="n">query</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">=</span> <span class="n">message</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">query_var_name</span> <span class="o">=</span> <span class="n">query_var_name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">message_var_name</span> <span class="o">=</span> <span class="n">message_var_name</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.ReportAgentAct.__repr__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__repr__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__repr__</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1963</span>
<span class="normal">1964</span>
<span class="normal">1965</span>
<span class="normal">1966</span>
<span class="normal">1967</span>
<span class="normal">1968</span>
<span class="normal">1969</span>
<span class="normal">1970</span>
<span class="normal">1971</span>
<span class="normal">1972</span>
<span class="normal">1973</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_var_name</span><span class="p">:</span>
        <span class="n">query_var_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_var_name</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">query_var_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">message_var_name</span><span class="p">:</span>
        <span class="n">message_var_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">message_var_name</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">message_var_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Report(</span><span class="si">{</span><span class="n">query_var_name</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">message_var_name</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.ReportAgentAct.__eq__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__eq__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__eq__</span><span class="p">(</span><span class="nf">other</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1975</span>
<span class="normal">1976</span>
<span class="normal">1977</span>
<span class="normal">1978</span>
<span class="normal">1979</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">ReportAgentAct</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">query</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">message</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">message</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="src.worksheets.environment.AskAgentAct" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">AskAgentAct</span>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.AgentAct" href="#src.worksheets.environment.AgentAct">AgentAct</a></code></p>


        <p>Action for requesting information from users.</p>
<p>This class handles user information requests.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.AskAgentAct.ws" href="#src.worksheets.environment.AskAgentAct.ws">ws</a></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieWorksheet" href="#src.worksheets.environment.GenieWorksheet">GenieWorksheet</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The worksheet context.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.AskAgentAct.field" href="#src.worksheets.environment.AskAgentAct.field">field</a></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieField" href="#src.worksheets.environment.GenieField">GenieField</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The field to ask about.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.AskAgentAct.ws_name" href="#src.worksheets.environment.AskAgentAct.ws_name">ws_name</a></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Worksheet name override.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>src/worksheets/environment.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1982</span>
<span class="normal">1983</span>
<span class="normal">1984</span>
<span class="normal">1985</span>
<span class="normal">1986</span>
<span class="normal">1987</span>
<span class="normal">1988</span>
<span class="normal">1989</span>
<span class="normal">1990</span>
<span class="normal">1991</span>
<span class="normal">1992</span>
<span class="normal">1993</span>
<span class="normal">1994</span>
<span class="normal">1995</span>
<span class="normal">1996</span>
<span class="normal">1997</span>
<span class="normal">1998</span>
<span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span>
<span class="normal">2003</span>
<span class="normal">2004</span>
<span class="normal">2005</span>
<span class="normal">2006</span>
<span class="normal">2007</span>
<span class="normal">2008</span>
<span class="normal">2009</span>
<span class="normal">2010</span>
<span class="normal">2011</span>
<span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">AskAgentAct</span><span class="p">(</span><span class="n">AgentAct</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Action for requesting information from users.</span>

<span class="sd">    This class handles user information requests.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        ws (GenieWorksheet): The worksheet context.</span>
<span class="sd">        field (GenieField): The field to ask about.</span>
<span class="sd">        ws_name: Worksheet name override.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ws</span><span class="p">:</span> <span class="n">GenieWorksheet</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="n">GenieField</span><span class="p">,</span> <span class="n">ws_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ws</span> <span class="o">=</span> <span class="n">ws</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">field</span> <span class="o">=</span> <span class="n">field</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ws_name</span> <span class="o">=</span> <span class="n">ws_name</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">description</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">slottype</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">slottype</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
                <span class="n">options</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">slottype</span><span class="o">.</span><span class="n">__members__</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
                <span class="p">]</span>
                <span class="n">options</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
                <span class="n">description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">description</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; Options are: </span><span class="si">{</span><span class="n">options</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="n">description</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">description</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">description</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws_name</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;AskField(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ws_name</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">description</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;AskField(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">description</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">





<h5 id="src.worksheets.environment.AskAgentAct-attributes">Attributes</h5>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.AskAgentAct.ws" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">ws</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">ws</span> <span class="o">=</span> <span class="n">ws</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.AskAgentAct.field" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">field</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">field</span> <span class="o">=</span> <span class="n">field</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.AskAgentAct.ws_name" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">ws_name</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">ws_name</span> <span class="o">=</span> <span class="n">ws_name</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<h5 id="src.worksheets.environment.AskAgentAct-functions">Functions</h5>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.AskAgentAct.__init__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__init__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__init__</span><span class="p">(</span><span class="nf">ws</span><span class="p">:</span> <span class="n">GenieWorksheet</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="n">GenieField</span><span class="p">,</span> <span class="n">ws_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1993</span>
<span class="normal">1994</span>
<span class="normal">1995</span>
<span class="normal">1996</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ws</span><span class="p">:</span> <span class="n">GenieWorksheet</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="n">GenieField</span><span class="p">,</span> <span class="n">ws_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ws</span> <span class="o">=</span> <span class="n">ws</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">field</span> <span class="o">=</span> <span class="n">field</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ws_name</span> <span class="o">=</span> <span class="n">ws_name</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.AskAgentAct.__repr__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__repr__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__repr__</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1998</span>
<span class="normal">1999</span>
<span class="normal">2000</span>
<span class="normal">2001</span>
<span class="normal">2002</span>
<span class="normal">2003</span>
<span class="normal">2004</span>
<span class="normal">2005</span>
<span class="normal">2006</span>
<span class="normal">2007</span>
<span class="normal">2008</span>
<span class="normal">2009</span>
<span class="normal">2010</span>
<span class="normal">2011</span>
<span class="normal">2012</span>
<span class="normal">2013</span>
<span class="normal">2014</span>
<span class="normal">2015</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">description</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">slottype</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">slottype</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
            <span class="n">options</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">slottype</span><span class="o">.</span><span class="n">__members__</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="p">]</span>
            <span class="n">options</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
            <span class="n">description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">description</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; Options are: </span><span class="si">{</span><span class="n">options</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">if</span> <span class="n">description</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">description</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">description</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">description</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws_name</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;AskField(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ws_name</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">description</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="k">return</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;AskField(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">description</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="src.worksheets.environment.ProposeAgentAct" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">ProposeAgentAct</span>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.AgentAct" href="#src.worksheets.environment.AgentAct">AgentAct</a></code></p>


        <p>Action for proposing worksheet values.</p>
<p>This class handles proposals for worksheet field values.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.ProposeAgentAct.ws" href="#src.worksheets.environment.ProposeAgentAct.ws">ws</a></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieWorksheet" href="#src.worksheets.environment.GenieWorksheet">GenieWorksheet</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The worksheet context.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.ProposeAgentAct.params" href="#src.worksheets.environment.ProposeAgentAct.params">params</a></code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Proposed parameters.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.ProposeAgentAct.ws_name" href="#src.worksheets.environment.ProposeAgentAct.ws_name">ws_name</a></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Worksheet name override.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>src/worksheets/environment.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2018</span>
<span class="normal">2019</span>
<span class="normal">2020</span>
<span class="normal">2021</span>
<span class="normal">2022</span>
<span class="normal">2023</span>
<span class="normal">2024</span>
<span class="normal">2025</span>
<span class="normal">2026</span>
<span class="normal">2027</span>
<span class="normal">2028</span>
<span class="normal">2029</span>
<span class="normal">2030</span>
<span class="normal">2031</span>
<span class="normal">2032</span>
<span class="normal">2033</span>
<span class="normal">2034</span>
<span class="normal">2035</span>
<span class="normal">2036</span>
<span class="normal">2037</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ProposeAgentAct</span><span class="p">(</span><span class="n">AgentAct</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Action for proposing worksheet values.</span>

<span class="sd">    This class handles proposals for worksheet field values.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        ws (GenieWorksheet): The worksheet context.</span>
<span class="sd">        params (dict): Proposed parameters.</span>
<span class="sd">        ws_name: Worksheet name override.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ws</span><span class="p">:</span> <span class="n">GenieWorksheet</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">ws_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ws</span> <span class="o">=</span> <span class="n">ws</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">params</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ws_name</span> <span class="o">=</span> <span class="n">ws_name</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws_name</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;ProposeAgentAct(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ws_name</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;ProposeAgentAct(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">





<h5 id="src.worksheets.environment.ProposeAgentAct-attributes">Attributes</h5>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.ProposeAgentAct.ws" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">ws</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">ws</span> <span class="o">=</span> <span class="n">ws</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.ProposeAgentAct.params" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">params</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">params</span> <span class="o">=</span> <span class="n">params</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.ProposeAgentAct.ws_name" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">ws_name</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">ws_name</span> <span class="o">=</span> <span class="n">ws_name</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<h5 id="src.worksheets.environment.ProposeAgentAct-functions">Functions</h5>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.ProposeAgentAct.__init__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__init__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__init__</span><span class="p">(</span><span class="nf">ws</span><span class="p">:</span> <span class="n">GenieWorksheet</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">ws_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2029</span>
<span class="normal">2030</span>
<span class="normal">2031</span>
<span class="normal">2032</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ws</span><span class="p">:</span> <span class="n">GenieWorksheet</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">ws_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ws</span> <span class="o">=</span> <span class="n">ws</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">params</span> <span class="o">=</span> <span class="n">params</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ws_name</span> <span class="o">=</span> <span class="n">ws_name</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.ProposeAgentAct.__repr__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__repr__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__repr__</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2034</span>
<span class="normal">2035</span>
<span class="normal">2036</span>
<span class="normal">2037</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws_name</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;ProposeAgentAct(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ws_name</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;ProposeAgentAct(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">params</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="src.worksheets.environment.AskForConfirmationAgentAct" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">AskForConfirmationAgentAct</span>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.AgentAct" href="#src.worksheets.environment.AgentAct">AgentAct</a></code></p>


        <p>Action for requesting user confirmation.</p>
<p>This class handles confirmation requests for field values.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.AskForConfirmationAgentAct.ws" href="#src.worksheets.environment.AskForConfirmationAgentAct.ws">ws</a></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieWorksheet" href="#src.worksheets.environment.GenieWorksheet">GenieWorksheet</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The worksheet context.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.AskForConfirmationAgentAct.field" href="#src.worksheets.environment.AskForConfirmationAgentAct.field">field</a></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieField" href="#src.worksheets.environment.GenieField">GenieField</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The field to confirm.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.AskForConfirmationAgentAct.ws_name" href="#src.worksheets.environment.AskForConfirmationAgentAct.ws_name">ws_name</a></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Worksheet name override.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.AskForConfirmationAgentAct.field_name" href="#src.worksheets.environment.AskForConfirmationAgentAct.field_name">field_name</a></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Field name override.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.AskForConfirmationAgentAct.value" href="#src.worksheets.environment.AskForConfirmationAgentAct.value">value</a></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Value to confirm.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>src/worksheets/environment.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2040</span>
<span class="normal">2041</span>
<span class="normal">2042</span>
<span class="normal">2043</span>
<span class="normal">2044</span>
<span class="normal">2045</span>
<span class="normal">2046</span>
<span class="normal">2047</span>
<span class="normal">2048</span>
<span class="normal">2049</span>
<span class="normal">2050</span>
<span class="normal">2051</span>
<span class="normal">2052</span>
<span class="normal">2053</span>
<span class="normal">2054</span>
<span class="normal">2055</span>
<span class="normal">2056</span>
<span class="normal">2057</span>
<span class="normal">2058</span>
<span class="normal">2059</span>
<span class="normal">2060</span>
<span class="normal">2061</span>
<span class="normal">2062</span>
<span class="normal">2063</span>
<span class="normal">2064</span>
<span class="normal">2065</span>
<span class="normal">2066</span>
<span class="normal">2067</span>
<span class="normal">2068</span>
<span class="normal">2069</span>
<span class="normal">2070</span>
<span class="normal">2071</span>
<span class="normal">2072</span>
<span class="normal">2073</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">AskForConfirmationAgentAct</span><span class="p">(</span><span class="n">AgentAct</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Action for requesting user confirmation.</span>

<span class="sd">    This class handles confirmation requests for field values.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        ws (GenieWorksheet): The worksheet context.</span>
<span class="sd">        field (GenieField): The field to confirm.</span>
<span class="sd">        ws_name: Worksheet name override.</span>
<span class="sd">        field_name: Field name override.</span>
<span class="sd">        value: Value to confirm.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">ws</span><span class="p">:</span> <span class="s2">&quot;GenieWorksheet&quot;</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="s2">&quot;GenieField&quot;</span><span class="p">,</span> <span class="n">ws_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">field_name</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ws</span> <span class="o">=</span> <span class="n">ws</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">field</span> <span class="o">=</span> <span class="n">field</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ws_name</span> <span class="o">=</span> <span class="n">ws_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">field_name</span> <span class="o">=</span> <span class="n">field_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws_name</span><span class="p">:</span>
            <span class="n">ws_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ws_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_name</span><span class="p">:</span>
            <span class="n">field_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_name</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">field_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">name</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;AskForFieldConfirmation(</span><span class="si">{</span><span class="n">ws_name</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">field_name</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">





<h5 id="src.worksheets.environment.AskForConfirmationAgentAct-attributes">Attributes</h5>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.AskForConfirmationAgentAct.ws" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">ws</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">ws</span> <span class="o">=</span> <span class="n">ws</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.AskForConfirmationAgentAct.field" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">field</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">field</span> <span class="o">=</span> <span class="n">field</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.AskForConfirmationAgentAct.ws_name" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">ws_name</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">ws_name</span> <span class="o">=</span> <span class="n">ws_name</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.AskForConfirmationAgentAct.field_name" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">field_name</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">field_name</span> <span class="o">=</span> <span class="n">field_name</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.AskForConfirmationAgentAct.value" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">value</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<h5 id="src.worksheets.environment.AskForConfirmationAgentAct-functions">Functions</h5>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.AskForConfirmationAgentAct.__init__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__init__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__init__</span><span class="p">(</span><span class="nf">ws</span><span class="p">:</span> <span class="s1">&#39;GenieWorksheet&#39;</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="s1">&#39;GenieField&#39;</span><span class="p">,</span> <span class="n">ws_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">field_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2053</span>
<span class="normal">2054</span>
<span class="normal">2055</span>
<span class="normal">2056</span>
<span class="normal">2057</span>
<span class="normal">2058</span>
<span class="normal">2059</span>
<span class="normal">2060</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">ws</span><span class="p">:</span> <span class="s2">&quot;GenieWorksheet&quot;</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="s2">&quot;GenieField&quot;</span><span class="p">,</span> <span class="n">ws_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">field_name</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ws</span> <span class="o">=</span> <span class="n">ws</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">field</span> <span class="o">=</span> <span class="n">field</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ws_name</span> <span class="o">=</span> <span class="n">ws_name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">field_name</span> <span class="o">=</span> <span class="n">field_name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.AskForConfirmationAgentAct.__repr__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__repr__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__repr__</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2062</span>
<span class="normal">2063</span>
<span class="normal">2064</span>
<span class="normal">2065</span>
<span class="normal">2066</span>
<span class="normal">2067</span>
<span class="normal">2068</span>
<span class="normal">2069</span>
<span class="normal">2070</span>
<span class="normal">2071</span>
<span class="normal">2072</span>
<span class="normal">2073</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws_name</span><span class="p">:</span>
        <span class="n">ws_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws_name</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ws_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ws</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_name</span><span class="p">:</span>
        <span class="n">field_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_name</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">field_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="o">.</span><span class="n">name</span>

    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;AskForFieldConfirmation(</span><span class="si">{</span><span class="n">ws_name</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">field_name</span><span class="si">}</span><span class="s2">)&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="src.worksheets.environment.AgentActs" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">AgentActs</span>


</h4>


    <div class="doc doc-contents ">


        <p>Container for managing multiple agent actions.</p>
<p>This class manages collections of agent actions, handling action ordering
and compatibility.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.AgentActs.args" href="#src.worksheets.environment.AgentActs.args">args</a></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Arguments for action management.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="src.worksheets.environment.AgentActs.actions" href="#src.worksheets.environment.AgentActs.actions">actions</a></code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of agent actions.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>src/worksheets/environment.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2076</span>
<span class="normal">2077</span>
<span class="normal">2078</span>
<span class="normal">2079</span>
<span class="normal">2080</span>
<span class="normal">2081</span>
<span class="normal">2082</span>
<span class="normal">2083</span>
<span class="normal">2084</span>
<span class="normal">2085</span>
<span class="normal">2086</span>
<span class="normal">2087</span>
<span class="normal">2088</span>
<span class="normal">2089</span>
<span class="normal">2090</span>
<span class="normal">2091</span>
<span class="normal">2092</span>
<span class="normal">2093</span>
<span class="normal">2094</span>
<span class="normal">2095</span>
<span class="normal">2096</span>
<span class="normal">2097</span>
<span class="normal">2098</span>
<span class="normal">2099</span>
<span class="normal">2100</span>
<span class="normal">2101</span>
<span class="normal">2102</span>
<span class="normal">2103</span>
<span class="normal">2104</span>
<span class="normal">2105</span>
<span class="normal">2106</span>
<span class="normal">2107</span>
<span class="normal">2108</span>
<span class="normal">2109</span>
<span class="normal">2110</span>
<span class="normal">2111</span>
<span class="normal">2112</span>
<span class="normal">2113</span>
<span class="normal">2114</span>
<span class="normal">2115</span>
<span class="normal">2116</span>
<span class="normal">2117</span>
<span class="normal">2118</span>
<span class="normal">2119</span>
<span class="normal">2120</span>
<span class="normal">2121</span>
<span class="normal">2122</span>
<span class="normal">2123</span>
<span class="normal">2124</span>
<span class="normal">2125</span>
<span class="normal">2126</span>
<span class="normal">2127</span>
<span class="normal">2128</span>
<span class="normal">2129</span>
<span class="normal">2130</span>
<span class="normal">2131</span>
<span class="normal">2132</span>
<span class="normal">2133</span>
<span class="normal">2134</span>
<span class="normal">2135</span>
<span class="normal">2136</span>
<span class="normal">2137</span>
<span class="normal">2138</span>
<span class="normal">2139</span>
<span class="normal">2140</span>
<span class="normal">2141</span>
<span class="normal">2142</span>
<span class="normal">2143</span>
<span class="normal">2144</span>
<span class="normal">2145</span>
<span class="normal">2146</span>
<span class="normal">2147</span>
<span class="normal">2148</span>
<span class="normal">2149</span>
<span class="normal">2150</span>
<span class="normal">2151</span>
<span class="normal">2152</span>
<span class="normal">2153</span>
<span class="normal">2154</span>
<span class="normal">2155</span>
<span class="normal">2156</span>
<span class="normal">2157</span>
<span class="normal">2158</span>
<span class="normal">2159</span>
<span class="normal">2160</span>
<span class="normal">2161</span>
<span class="normal">2162</span>
<span class="normal">2163</span>
<span class="normal">2164</span>
<span class="normal">2165</span>
<span class="normal">2166</span>
<span class="normal">2167</span>
<span class="normal">2168</span>
<span class="normal">2169</span>
<span class="normal">2170</span>
<span class="normal">2171</span>
<span class="normal">2172</span>
<span class="normal">2173</span>
<span class="normal">2174</span>
<span class="normal">2175</span>
<span class="normal">2176</span>
<span class="normal">2177</span>
<span class="normal">2178</span>
<span class="normal">2179</span>
<span class="normal">2180</span>
<span class="normal">2181</span>
<span class="normal">2182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">AgentActs</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Container for managing multiple agent actions.</span>

<span class="sd">    This class manages collections of agent actions, handling action ordering</span>
<span class="sd">    and compatibility.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        args: Arguments for action management.</span>
<span class="sd">        actions (list): List of agent actions.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actions</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">should_add</span><span class="p">(</span><span class="n">action</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">should_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">incoming_action</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;There can be multiple ReportActs, and (multiple propose acts or one ask acts or one confirmation act) but only one of each type of act&quot;&quot;&quot;</span>
        <span class="n">acts_to_action</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">in</span> <span class="n">acts_to_action</span><span class="p">:</span>
                <span class="n">acts_to_action</span><span class="p">[</span><span class="n">action</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">acts_to_action</span><span class="p">[</span><span class="n">action</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">action</span><span class="p">]</span>

        <span class="c1"># Check if the incoming action is a ReportAct, if it is then check if there is already a ReportAct with the same query</span>
        <span class="k">if</span> <span class="n">incoming_action</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;ReportAgentAct&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">acts_to_action</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ReportAgentAct&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">action</span><span class="o">.</span><span class="n">query</span> <span class="o">==</span> <span class="n">incoming_action</span><span class="o">.</span><span class="n">query</span>
                    <span class="ow">and</span> <span class="n">action</span><span class="o">.</span><span class="n">message</span> <span class="o">==</span> <span class="n">incoming_action</span><span class="o">.</span><span class="n">message</span>
                <span class="p">):</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="c1"># Check if the incoming action is a ProposeAct, if it is then check if there is already a ProposeAct with the same query</span>
        <span class="c1"># or AskAgentAct or AskForConfirmationAct are present</span>
        <span class="k">elif</span> <span class="n">incoming_action</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;ProposeAgentAct&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="s2">&quot;AskAgentAct&quot;</span> <span class="ow">in</span> <span class="n">acts_to_action</span>
                <span class="ow">or</span> <span class="s2">&quot;AskForConfirmationAgentAct&quot;</span> <span class="ow">in</span> <span class="n">acts_to_action</span>
            <span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">acts_to_action</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ProposeAgentAct&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">params</span> <span class="o">==</span> <span class="n">incoming_action</span><span class="o">.</span><span class="n">params</span> <span class="ow">and</span> <span class="n">same_worksheet</span><span class="p">(</span>
                    <span class="n">action</span><span class="o">.</span><span class="n">ws</span><span class="p">,</span> <span class="n">incoming_action</span><span class="o">.</span><span class="n">ws</span>
                <span class="p">):</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="c1"># Check if the incoming action is a AskAgentAct, if other AskAgentAct or ProposeAgentAct or AskForConfirmationAgentAct are present</span>
        <span class="k">elif</span> <span class="n">incoming_action</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;AskAgentAct&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="s2">&quot;ProposeAgentAct&quot;</span> <span class="ow">in</span> <span class="n">acts_to_action</span>
                <span class="ow">or</span> <span class="s2">&quot;AskAgentAct&quot;</span> <span class="ow">in</span> <span class="n">acts_to_action</span>
                <span class="ow">or</span> <span class="s2">&quot;AskForConfirmationAgentAct&quot;</span> <span class="ow">in</span> <span class="n">acts_to_action</span>
            <span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="c1"># Check if the incoming action is a AskForConfirmationAct, if other AskAgentAct or ProposeAgentAct or AskForConfirmationAgentAct are present</span>
        <span class="k">elif</span> <span class="n">incoming_action</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;AskForConfirmationAgentAct&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="s2">&quot;ProposeAgentAct&quot;</span> <span class="ow">in</span> <span class="n">acts_to_action</span>
                <span class="ow">or</span> <span class="s2">&quot;AskAgentAct&quot;</span> <span class="ow">in</span> <span class="n">acts_to_action</span>
                <span class="ow">or</span> <span class="s2">&quot;AskForConfirmationAgentAct&quot;</span> <span class="ow">in</span> <span class="n">acts_to_action</span>
            <span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="c1"># for action in self.actions:</span>
        <span class="c1">#     if isinstance(action, ReportAgentAct) or isinstance(action, ReportAgentAct):</span>
        <span class="c1">#         if action == incoming_action:</span>
        <span class="c1">#             return True</span>
        <span class="c1">#     else:</span>
        <span class="c1">#         return True</span>

        <span class="c1"># return False</span>

    <span class="k">def</span> <span class="nf">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">actions</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_add</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">can_have_other_acts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">acts_to_action</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">in</span> <span class="n">acts_to_action</span><span class="p">:</span>
                <span class="n">acts_to_action</span><span class="p">[</span><span class="n">action</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">acts_to_action</span><span class="p">[</span><span class="n">action</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">action</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="s2">&quot;ProposeAgentAct&quot;</span> <span class="ow">in</span> <span class="n">acts_to_action</span>
            <span class="ow">or</span> <span class="s2">&quot;AskAgentAct&quot;</span> <span class="ow">in</span> <span class="n">acts_to_action</span>
            <span class="ow">or</span> <span class="s2">&quot;AskForConfirmationAgentAct&quot;</span> <span class="ow">in</span> <span class="n">acts_to_action</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">





<h5 id="src.worksheets.environment.AgentActs-attributes">Attributes</h5>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.AgentActs.args" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">args</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="src.worksheets.environment.AgentActs.actions" class="doc doc-heading">
            <span class="doc doc-object-name doc-attribute-name">actions</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="n">actions</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div>

    <div class="doc doc-contents ">
    </div>

</div>

<h5 id="src.worksheets.environment.AgentActs-functions">Functions</h5>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.AgentActs.__init__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__init__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__init__</span><span class="p">(</span><span class="nf">args</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2087</span>
<span class="normal">2088</span>
<span class="normal">2089</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">actions</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.AgentActs.add" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">add</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">add</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2091</span>
<span class="normal">2092</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_add</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.AgentActs._add" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">_add</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">_add</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2094</span>
<span class="normal">2095</span>
<span class="normal">2096</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">should_add</span><span class="p">(</span><span class="n">action</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.AgentActs.should_add" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">should_add</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">should_add</span><span class="p">(</span><span class="n">incoming_action</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>There can be multiple ReportActs, and (multiple propose acts or one ask acts or one confirmation act) but only one of each type of act</p>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2098</span>
<span class="normal">2099</span>
<span class="normal">2100</span>
<span class="normal">2101</span>
<span class="normal">2102</span>
<span class="normal">2103</span>
<span class="normal">2104</span>
<span class="normal">2105</span>
<span class="normal">2106</span>
<span class="normal">2107</span>
<span class="normal">2108</span>
<span class="normal">2109</span>
<span class="normal">2110</span>
<span class="normal">2111</span>
<span class="normal">2112</span>
<span class="normal">2113</span>
<span class="normal">2114</span>
<span class="normal">2115</span>
<span class="normal">2116</span>
<span class="normal">2117</span>
<span class="normal">2118</span>
<span class="normal">2119</span>
<span class="normal">2120</span>
<span class="normal">2121</span>
<span class="normal">2122</span>
<span class="normal">2123</span>
<span class="normal">2124</span>
<span class="normal">2125</span>
<span class="normal">2126</span>
<span class="normal">2127</span>
<span class="normal">2128</span>
<span class="normal">2129</span>
<span class="normal">2130</span>
<span class="normal">2131</span>
<span class="normal">2132</span>
<span class="normal">2133</span>
<span class="normal">2134</span>
<span class="normal">2135</span>
<span class="normal">2136</span>
<span class="normal">2137</span>
<span class="normal">2138</span>
<span class="normal">2139</span>
<span class="normal">2140</span>
<span class="normal">2141</span>
<span class="normal">2142</span>
<span class="normal">2143</span>
<span class="normal">2144</span>
<span class="normal">2145</span>
<span class="normal">2146</span>
<span class="normal">2147</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">should_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">incoming_action</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;There can be multiple ReportActs, and (multiple propose acts or one ask acts or one confirmation act) but only one of each type of act&quot;&quot;&quot;</span>
    <span class="n">acts_to_action</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">in</span> <span class="n">acts_to_action</span><span class="p">:</span>
            <span class="n">acts_to_action</span><span class="p">[</span><span class="n">action</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">acts_to_action</span><span class="p">[</span><span class="n">action</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">action</span><span class="p">]</span>

    <span class="c1"># Check if the incoming action is a ReportAct, if it is then check if there is already a ReportAct with the same query</span>
    <span class="k">if</span> <span class="n">incoming_action</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;ReportAgentAct&quot;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">acts_to_action</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ReportAgentAct&quot;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">action</span><span class="o">.</span><span class="n">query</span> <span class="o">==</span> <span class="n">incoming_action</span><span class="o">.</span><span class="n">query</span>
                <span class="ow">and</span> <span class="n">action</span><span class="o">.</span><span class="n">message</span> <span class="o">==</span> <span class="n">incoming_action</span><span class="o">.</span><span class="n">message</span>
            <span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="c1"># Check if the incoming action is a ProposeAct, if it is then check if there is already a ProposeAct with the same query</span>
    <span class="c1"># or AskAgentAct or AskForConfirmationAct are present</span>
    <span class="k">elif</span> <span class="n">incoming_action</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;ProposeAgentAct&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="s2">&quot;AskAgentAct&quot;</span> <span class="ow">in</span> <span class="n">acts_to_action</span>
            <span class="ow">or</span> <span class="s2">&quot;AskForConfirmationAgentAct&quot;</span> <span class="ow">in</span> <span class="n">acts_to_action</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">acts_to_action</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ProposeAgentAct&quot;</span><span class="p">,</span> <span class="p">[]):</span>
            <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">params</span> <span class="o">==</span> <span class="n">incoming_action</span><span class="o">.</span><span class="n">params</span> <span class="ow">and</span> <span class="n">same_worksheet</span><span class="p">(</span>
                <span class="n">action</span><span class="o">.</span><span class="n">ws</span><span class="p">,</span> <span class="n">incoming_action</span><span class="o">.</span><span class="n">ws</span>
            <span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="c1"># Check if the incoming action is a AskAgentAct, if other AskAgentAct or ProposeAgentAct or AskForConfirmationAgentAct are present</span>
    <span class="k">elif</span> <span class="n">incoming_action</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;AskAgentAct&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="s2">&quot;ProposeAgentAct&quot;</span> <span class="ow">in</span> <span class="n">acts_to_action</span>
            <span class="ow">or</span> <span class="s2">&quot;AskAgentAct&quot;</span> <span class="ow">in</span> <span class="n">acts_to_action</span>
            <span class="ow">or</span> <span class="s2">&quot;AskForConfirmationAgentAct&quot;</span> <span class="ow">in</span> <span class="n">acts_to_action</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="c1"># Check if the incoming action is a AskForConfirmationAct, if other AskAgentAct or ProposeAgentAct or AskForConfirmationAgentAct are present</span>
    <span class="k">elif</span> <span class="n">incoming_action</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;AskForConfirmationAgentAct&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="s2">&quot;ProposeAgentAct&quot;</span> <span class="ow">in</span> <span class="n">acts_to_action</span>
            <span class="ow">or</span> <span class="s2">&quot;AskAgentAct&quot;</span> <span class="ow">in</span> <span class="n">acts_to_action</span>
            <span class="ow">or</span> <span class="s2">&quot;AskForConfirmationAgentAct&quot;</span> <span class="ow">in</span> <span class="n">acts_to_action</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.AgentActs.extend" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">extend</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">extend</span><span class="p">(</span><span class="n">actions</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2158</span>
<span class="normal">2159</span>
<span class="normal">2160</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">actions</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="n">actions</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_add</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.AgentActs.__iter__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__iter__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__iter__</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2162</span>
<span class="normal">2163</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.AgentActs.__next__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__next__</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="fm">__next__</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2165</span>
<span class="normal">2166</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__next__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.worksheets.environment.AgentActs.can_have_other_acts" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">can_have_other_acts</span>


</h6>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">can_have_other_acts</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2168</span>
<span class="normal">2169</span>
<span class="normal">2170</span>
<span class="normal">2171</span>
<span class="normal">2172</span>
<span class="normal">2173</span>
<span class="normal">2174</span>
<span class="normal">2175</span>
<span class="normal">2176</span>
<span class="normal">2177</span>
<span class="normal">2178</span>
<span class="normal">2179</span>
<span class="normal">2180</span>
<span class="normal">2181</span>
<span class="normal">2182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">can_have_other_acts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">acts_to_action</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="ow">in</span> <span class="n">acts_to_action</span><span class="p">:</span>
            <span class="n">acts_to_action</span><span class="p">[</span><span class="n">action</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">acts_to_action</span><span class="p">[</span><span class="n">action</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">action</span><span class="p">]</span>

    <span class="k">if</span> <span class="p">(</span>
        <span class="s2">&quot;ProposeAgentAct&quot;</span> <span class="ow">in</span> <span class="n">acts_to_action</span>
        <span class="ow">or</span> <span class="s2">&quot;AskAgentAct&quot;</span> <span class="ow">in</span> <span class="n">acts_to_action</span>
        <span class="ow">or</span> <span class="s2">&quot;AskForConfirmationAgentAct&quot;</span> <span class="ow">in</span> <span class="n">acts_to_action</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>
<h3 id="src.worksheets.environment-functions">Functions</h3>

<div class="doc doc-object doc-function">


<h4 id="src.worksheets.environment.validation_check" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">validation_check</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">validation_check</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">validation</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Validate a value against specified criteria using LLM.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the field being validated.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>value</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The value to validate.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>validation</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The validation criteria.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing:
- bool: Whether the value is valid.
- str or None: The reason for invalidity, if any.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validation_check</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">validation</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate a value against specified criteria using LLM.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): The name of the field being validated.</span>
<span class="sd">        value (Any): The value to validate.</span>
<span class="sd">        validation (str): The validation criteria.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: A tuple containing:</span>
<span class="sd">            - bool: Whether the value is valid.</span>
<span class="sd">            - str or None: The reason for invalidity, if any.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">prompt_path</span> <span class="o">=</span> <span class="s2">&quot;validation_check.prompt&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">GenieValue</span><span class="p">):</span>
        <span class="n">val</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">val</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">llm_generate</span><span class="p">(</span>
        <span class="n">prompt_path</span><span class="p">,</span>
        <span class="p">{</span>
            <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">val</span><span class="p">,</span>
            <span class="s2">&quot;criteria&quot;</span><span class="p">:</span> <span class="n">validation</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="n">model_name</span><span class="o">=</span><span class="s2">&quot;gpt-4o-mini&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">bs</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="s2">&quot;html.parser&quot;</span><span class="p">)</span>
    <span class="n">reason</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;reason&quot;</span><span class="p">)</span>
    <span class="n">valid</span> <span class="o">=</span> <span class="n">bs</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;valid&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">valid</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">valid</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">reason</span><span class="o">.</span><span class="n">text</span> <span class="k">if</span> <span class="n">reason</span> <span class="k">else</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.worksheets.environment.get_genie_fields_from_ws" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_genie_fields_from_ws</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_genie_fields_from_ws</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">GenieWorksheet</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">GenieField</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get all GenieField instances from a GenieWorksheet.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>obj</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieWorksheet" href="#src.worksheets.environment.GenieWorksheet">GenieWorksheet</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The worksheet to get fields from.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>list[<a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieField" href="#src.worksheets.environment.GenieField">GenieField</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[GenieField]: List of GenieField instances.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_genie_fields_from_ws</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">GenieWorksheet</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">GenieField</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get all GenieField instances from a GenieWorksheet.</span>

<span class="sd">    Args:</span>
<span class="sd">        obj (GenieWorksheet): The worksheet to get fields from.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[GenieField]: List of GenieField instances.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">_ordered_attributes</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">attr</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">):</span>
            <span class="n">field</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">GenieField</span><span class="p">):</span>
                <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fields</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.worksheets.environment.execute_query" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">execute_query</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">execute_query</span><span class="p">(</span><span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">GenieWorksheet</span><span class="p">,</span> <span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">,</span> <span class="n">local_context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Execute a query in the given context.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>code</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The code to execute.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>obj</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieWorksheet" href="#src.worksheets.environment.GenieWorksheet">GenieWorksheet</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The worksheet object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bot</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieRuntime" href="#src.worksheets.environment.GenieRuntime">GenieRuntime</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The bot instance.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>local_context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieContext" href="#src.worksheets.environment.GenieContext">GenieContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The local context.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Any</code></td>            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The result of the query execution.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">execute_query</span><span class="p">(</span>
    <span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">GenieWorksheet</span><span class="p">,</span> <span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">,</span> <span class="n">local_context</span><span class="p">:</span> <span class="n">GenieContext</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute a query in the given context.</span>

<span class="sd">    Args:</span>
<span class="sd">        code (str): The code to execute.</span>
<span class="sd">        obj (GenieWorksheet): The worksheet object.</span>
<span class="sd">        bot (GenieRuntime): The bot instance.</span>
<span class="sd">        local_context (GenieContext): The local context.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Any: The result of the query execution.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># refactoring the developer written code</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">modify_action_code</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">bot</span><span class="p">,</span> <span class="n">local_context</span><span class="p">)</span>
    <span class="n">code_</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;__return = </span><span class="si">{</span><span class="n">code</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">local_context</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;__return&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">bot</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">code_</span><span class="p">,</span> <span class="n">local_context</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;_obj&quot;</span> <span class="ow">in</span> <span class="n">local_context</span><span class="o">.</span><span class="n">context</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">local_context</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;_obj&quot;</span><span class="p">]</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">local_context</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;__return&quot;</span><span class="p">]</span>

    <span class="k">del</span> <span class="n">local_context</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;__return&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.worksheets.environment.modify_action_code" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">modify_action_code</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">modify_action_code</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">bot</span><span class="p">,</span> <span class="n">local_context</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">modify_action_code</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">bot</span><span class="p">,</span> <span class="n">local_context</span><span class="p">):</span>
    <span class="c1"># Pattern to match decorators and their arguments</span>
    <span class="n">api_pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;@(\w+)\((.*?)\)&quot;</span>
    <span class="n">api_matches</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">api_pattern</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span>

    <span class="n">inbuilt_pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&gt;(\w+)\((.*?)\)&quot;</span>
    <span class="n">inbuilt_matches</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">inbuilt_pattern</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">replace_sign</span><span class="p">(</span><span class="n">sign</span><span class="p">,</span> <span class="n">matches</span><span class="p">,</span> <span class="n">code</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">args</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">func_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">bot</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">context</span>
                <span class="ow">and</span> <span class="n">func_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">local_context</span><span class="o">.</span><span class="n">context</span>
            <span class="p">):</span>
                <span class="k">continue</span>

            <span class="c1"># Replace the decorator with the direct function call in the code</span>
            <span class="n">code</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sign</span><span class="si">}{</span><span class="n">func_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">code</span>

    <span class="k">def</span> <span class="nf">replace_self</span><span class="p">(</span><span class="n">code</span><span class="p">):</span>
        <span class="c1"># Replace &#39;self.&#39; with &#39;custom_obj.&#39; to reference the custom object</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">GenieWorksheet</span><span class="p">):</span>
            <span class="n">local_context</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;_obj&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">GenieField</span><span class="p">):</span>
            <span class="n">local_context</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;_obj&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">parent</span>
        <span class="n">modified_args</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;self.&quot;</span><span class="p">,</span> <span class="s2">&quot;_obj&quot;</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="n">modified_args</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;self$&quot;</span><span class="p">,</span> <span class="s2">&quot;_obj&quot;</span><span class="p">,</span> <span class="n">modified_args</span><span class="p">)</span>
        <span class="n">modified_args</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;self}&quot;</span><span class="p">,</span> <span class="s2">&quot;_obj&quot;</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span><span class="p">,</span> <span class="n">modified_args</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">modified_args</span>

    <span class="n">code</span> <span class="o">=</span> <span class="n">replace_self</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>

    <span class="n">code</span> <span class="o">=</span> <span class="n">replace_sign</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">,</span> <span class="n">api_matches</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">replace_sign</span><span class="p">(</span><span class="s2">&quot;&gt;&quot;</span><span class="p">,</span> <span class="n">inbuilt_matches</span><span class="p">,</span> <span class="n">code</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">code</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.worksheets.environment.eval_predicates" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">eval_predicates</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">eval_predicates</span><span class="p">(</span><span class="n">predicates</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span> <span class="n">obj</span><span class="p">:</span> <span class="n">GenieField</span> <span class="o">|</span> <span class="n">GenieWorksheet</span><span class="p">,</span> <span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">,</span> <span class="n">local_context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">eval_predicates</span><span class="p">(</span>
    <span class="n">predicates</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">obj</span><span class="p">:</span> <span class="n">GenieField</span> <span class="o">|</span> <span class="n">GenieWorksheet</span><span class="p">,</span>
    <span class="n">bot</span><span class="p">:</span> <span class="n">GenieRuntime</span><span class="p">,</span>
    <span class="n">local_context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">predicates</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">predicates</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">predicates</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">predicate</span> <span class="ow">in</span> <span class="n">predicates</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">parse_single_predicate</span><span class="p">(</span><span class="n">predicate</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">bot</span><span class="p">,</span> <span class="n">local_context</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">parse_single_predicate</span><span class="p">(</span><span class="n">predicates</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">bot</span><span class="p">,</span> <span class="n">local_context</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.worksheets.environment.parse_single_predicate" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">parse_single_predicate</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">parse_single_predicate</span><span class="p">(</span><span class="n">predicate</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">bot</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">parse_single_predicate</span><span class="p">(</span><span class="n">predicate</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">bot</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">predicate</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">predicate</span>
    <span class="k">if</span> <span class="n">predicate</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;TRUE&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">elif</span> <span class="n">predicate</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;FALSE&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">elif</span> <span class="n">predicate</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="n">code</span> <span class="o">=</span> <span class="n">modify_action_code</span><span class="p">(</span><span class="n">predicate</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">bot</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">sanitize_dev_code</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">bot</span><span class="o">.</span><span class="n">get_all_variables</span><span class="p">())</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

    <span class="n">res</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">bot</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

    <span class="k">if</span> <span class="s2">&quot;_obj&quot;</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">context</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">context</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="s2">&quot;_obj&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">res</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.worksheets.environment.rewrite_action_code" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">rewrite_action_code</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">rewrite_action_code</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">builtin_funcs</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">rewrite_action_code</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">builtin_funcs</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">CallTransformer</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">NodeTransformer</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">builtin_funcs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">builtins</span> <span class="o">=</span> <span class="n">builtin_funcs</span>

        <span class="k">def</span> <span class="nf">visit_Call</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
            <span class="c1"># Process the node further before possibly wrapping it</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">generic_visit</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

            <span class="c1"># Wrap the function call in a result.append if it&#39;s not a built-in function</span>
            <span class="c1"># Note: you&#39;ll need to determine if a function is built-in based on your criteria</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">func</span><span class="p">,</span> <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">)</span> <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">func</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">builtins</span><span class="p">:</span>
                <span class="n">append_call</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">Expr</span><span class="p">(</span>
                    <span class="n">value</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Call</span><span class="p">(</span>
                        <span class="n">func</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Attribute</span><span class="p">(</span>
                            <span class="n">value</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;__return&quot;</span><span class="p">,</span> <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">()),</span>
                            <span class="n">attr</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span>
                            <span class="n">ctx</span><span class="o">=</span><span class="n">ast</span><span class="o">.</span><span class="n">Load</span><span class="p">(),</span>
                        <span class="p">),</span>
                        <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="n">node</span><span class="p">],</span>
                        <span class="n">keywords</span><span class="o">=</span><span class="p">[],</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="n">append_call</span>
            <span class="k">return</span> <span class="n">node</span>

    <span class="c1"># Parse the code into an AST</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>

    <span class="c1"># Initialize the transformer and apply it</span>
    <span class="n">transformer</span> <span class="o">=</span> <span class="n">CallTransformer</span><span class="p">(</span><span class="n">builtin_funcs</span><span class="o">=</span><span class="n">builtin_funcs</span><span class="p">)</span>
    <span class="n">transformer</span><span class="o">.</span><span class="n">result_added</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">transformed_tree</span> <span class="o">=</span> <span class="n">transformer</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>

    <span class="c1"># Fix missing locations in the AST</span>
    <span class="c1"># Convert the AST back to code</span>
    <span class="n">new_code</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">unparse</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">fix_missing_locations</span><span class="p">(</span><span class="n">transformed_tree</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">new_code</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.worksheets.environment.same_field" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">same_field</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">same_field</span><span class="p">(</span><span class="n">field1</span><span class="p">:</span> <span class="n">GenieField</span><span class="p">,</span> <span class="n">field2</span><span class="p">:</span> <span class="n">GenieField</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Check if the values and confirmed status are the same for any two GenieField instances.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>field1</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieField" href="#src.worksheets.environment.GenieField">GenieField</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The first field to compare.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>field2</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieField" href="#src.worksheets.environment.GenieField">GenieField</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The second field to compare.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the fields are the same, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">same_field</span><span class="p">(</span><span class="n">field1</span><span class="p">:</span> <span class="n">GenieField</span><span class="p">,</span> <span class="n">field2</span><span class="p">:</span> <span class="n">GenieField</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if the values and confirmed status are the same for any two GenieField instances.</span>

<span class="sd">    Args:</span>
<span class="sd">        field1 (GenieField): The first field to compare.</span>
<span class="sd">        field2 (GenieField): The second field to compare.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the fields are the same, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">field1</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">field2</span><span class="o">.</span><span class="n">value</span> <span class="ow">and</span> <span class="n">field1</span><span class="o">.</span><span class="n">confirmed</span> <span class="o">==</span> <span class="n">field2</span><span class="o">.</span><span class="n">confirmed</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.worksheets.environment.same_worksheet" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">same_worksheet</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">same_worksheet</span><span class="p">(</span><span class="n">ws1</span><span class="p">:</span> <span class="n">GenieWorksheet</span><span class="p">,</span> <span class="n">ws2</span><span class="p">:</span> <span class="n">GenieWorksheet</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Check if two GenieWorksheet instances are the same.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ws1</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieWorksheet" href="#src.worksheets.environment.GenieWorksheet">GenieWorksheet</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The first worksheet to compare.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ws2</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieWorksheet" href="#src.worksheets.environment.GenieWorksheet">GenieWorksheet</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The second worksheet to compare.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the worksheets are the same, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">same_worksheet</span><span class="p">(</span><span class="n">ws1</span><span class="p">:</span> <span class="n">GenieWorksheet</span><span class="p">,</span> <span class="n">ws2</span><span class="p">:</span> <span class="n">GenieWorksheet</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if two GenieWorksheet instances are the same.</span>

<span class="sd">    Args:</span>
<span class="sd">        ws1 (GenieWorksheet): The first worksheet to compare.</span>
<span class="sd">        ws2 (GenieWorksheet): The second worksheet to compare.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the worksheets are the same, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># If the randomly generated id is different, then the worksheets are different</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ws1</span><span class="p">,</span> <span class="s2">&quot;random_id&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">ws2</span><span class="p">,</span> <span class="s2">&quot;random_id&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ws1</span><span class="o">.</span><span class="n">random_id</span> <span class="o">!=</span> <span class="n">ws2</span><span class="o">.</span><span class="n">random_id</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># Check if the fields in both worksheets are the same starting from WS1</span>
    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="n">ws1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">field2</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="n">ws2</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">field2</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">field2</span><span class="o">.</span><span class="n">value</span><span class="p">):</span>
                    <span class="k">return</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">GenieWorksheet</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span>
                    <span class="n">field2</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">GenieWorksheet</span>
                <span class="p">):</span>
                    <span class="c1"># Recursively check if the worksheets are the same</span>
                    <span class="c1"># if the value of the current field is a worksheet</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">same_worksheet</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">field2</span><span class="o">.</span><span class="n">value</span><span class="p">):</span>
                        <span class="k">return</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">same_field</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">field2</span><span class="p">):</span>
                        <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># Check if the fields in both worksheets are the same starting from WS2</span>
    <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="n">ws2</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">field2</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="n">ws1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">field2</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">GenieWorksheet</span><span class="p">):</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">same_worksheet</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">field2</span><span class="o">.</span><span class="n">value</span><span class="p">):</span>
                        <span class="k">return</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">same_field</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">field2</span><span class="p">):</span>
                        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.worksheets.environment.count_number_of_vars" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">count_number_of_vars</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">count_number_of_vars</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Count the number of variables of the same type in the context.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The context to count variables in.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary with variable names as keys and their counts as values.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">count_number_of_vars</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Count the number of variables of the same type in the context.</span>

<span class="sd">    Args:</span>
<span class="sd">        context (dict): The context to count variables in.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: A dictionary with variable names as keys and their counts as values.&quot;&quot;&quot;</span>
    <span class="n">var_counters</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Answer</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">GenieWorksheet</span><span class="p">):</span>
            <span class="n">var_name</span> <span class="o">=</span> <span class="n">generate_var_name</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">var_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">var_counters</span><span class="p">:</span>
                <span class="n">var_counters</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">var_counters</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">var_counters</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.worksheets.environment.genie_deepcopy" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">genie_deepcopy</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">genie_deepcopy</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Special deepcopy function for Genie context.</p>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">genie_deepcopy</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Special deepcopy function for Genie context.&quot;&quot;&quot;</span>
    <span class="n">new_context</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;__builtins__&quot;</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">GenieWorksheet</span><span class="p">):</span>
            <span class="n">new_context</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">GenieField</span><span class="p">):</span>
            <span class="n">new_context</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_context</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">return</span> <span class="n">new_context</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.worksheets.environment.get_field_variable_name" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_field_variable_name</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_field_variable_name</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">GenieWorksheet</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get the variable name of a field in a worksheet.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>obj</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieWorksheet" href="#src.worksheets.environment.GenieWorksheet">GenieWorksheet</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The worksheet object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieContext" href="#src.worksheets.environment.GenieContext">GenieContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The context to search in.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The variable name of the field.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1668</span>
<span class="normal">1669</span>
<span class="normal">1670</span>
<span class="normal">1671</span>
<span class="normal">1672</span>
<span class="normal">1673</span>
<span class="normal">1674</span>
<span class="normal">1675</span>
<span class="normal">1676</span>
<span class="normal">1677</span>
<span class="normal">1678</span>
<span class="normal">1679</span>
<span class="normal">1680</span>
<span class="normal">1681</span>
<span class="normal">1682</span>
<span class="normal">1683</span>
<span class="normal">1684</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_field_variable_name</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">GenieWorksheet</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the variable name of a field in a worksheet.</span>

<span class="sd">    Args:</span>
<span class="sd">        obj (GenieWorksheet): The worksheet object.</span>
<span class="sd">        context (GenieContext): The context to search in.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The variable name of the field.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">GenieWorksheet</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">field</span> <span class="o">==</span> <span class="n">obj</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span>

    <span class="k">return</span> <span class="n">obj</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.worksheets.environment.collect_all_parents" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">collect_all_parents</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">collect_all_parents</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Collect all parent references for GenieField instances in the context.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieContext" href="#src.worksheets.environment.GenieContext">GenieContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The context to collect parents from.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1687</span>
<span class="normal">1688</span>
<span class="normal">1689</span>
<span class="normal">1690</span>
<span class="normal">1691</span>
<span class="normal">1692</span>
<span class="normal">1693</span>
<span class="normal">1694</span>
<span class="normal">1695</span>
<span class="normal">1696</span>
<span class="normal">1697</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">collect_all_parents</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Collect all parent references for GenieField instances in the context.</span>

<span class="sd">    Args:</span>
<span class="sd">        context (GenieContext): The context to collect parents from.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">GenieWorksheet</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">GenieField</span><span class="p">):</span>
                    <span class="n">field</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.worksheets.environment.find_all_variables_matching_name" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">find_all_variables_matching_name</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">find_all_variables_matching_name</span><span class="p">(</span><span class="n">field_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Go through all the variables in the context recursively and return the variables that match the field_name</p>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1700</span>
<span class="normal">1701</span>
<span class="normal">1702</span>
<span class="normal">1703</span>
<span class="normal">1704</span>
<span class="normal">1705</span>
<span class="normal">1706</span>
<span class="normal">1707</span>
<span class="normal">1708</span>
<span class="normal">1709</span>
<span class="normal">1710</span>
<span class="normal">1711</span>
<span class="normal">1712</span>
<span class="normal">1713</span>
<span class="normal">1714</span>
<span class="normal">1715</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">find_all_variables_matching_name</span><span class="p">(</span><span class="n">field_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Go through all the variables in the context recursively and return the variables that match the field_name&quot;&quot;&quot;</span>
    <span class="n">variables</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">find_matching_variables</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">field_name</span><span class="p">:</span>
                <span class="n">variables</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="n">field_name</span><span class="p">)</span>
            <span class="c1"># if isinstance(field.value, GenieWorksheet):</span>
            <span class="c1"># find_matching_variables(field.value, field_name, key + &quot;.&quot; + field.name)</span>

    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">GenieWorksheet</span><span class="p">):</span>
            <span class="n">find_matching_variables</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">variables</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.worksheets.environment.replace_undefined_variables" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">replace_undefined_variables</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">replace_undefined_variables</span><span class="p">(</span><span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">local_context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">,</span> <span class="n">global_context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Replace undefined variables in the code with their corresponding values from the context.</p>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1718</span>
<span class="normal">1719</span>
<span class="normal">1720</span>
<span class="normal">1721</span>
<span class="normal">1722</span>
<span class="normal">1723</span>
<span class="normal">1724</span>
<span class="normal">1725</span>
<span class="normal">1726</span>
<span class="normal">1727</span>
<span class="normal">1728</span>
<span class="normal">1729</span>
<span class="normal">1730</span>
<span class="normal">1731</span>
<span class="normal">1732</span>
<span class="normal">1733</span>
<span class="normal">1734</span>
<span class="normal">1735</span>
<span class="normal">1736</span>
<span class="normal">1737</span>
<span class="normal">1738</span>
<span class="normal">1739</span>
<span class="normal">1740</span>
<span class="normal">1741</span>
<span class="normal">1742</span>
<span class="normal">1743</span>
<span class="normal">1744</span>
<span class="normal">1745</span>
<span class="normal">1746</span>
<span class="normal">1747</span>
<span class="normal">1748</span>
<span class="normal">1749</span>
<span class="normal">1750</span>
<span class="normal">1751</span>
<span class="normal">1752</span>
<span class="normal">1753</span>
<span class="normal">1754</span>
<span class="normal">1755</span>
<span class="normal">1756</span>
<span class="normal">1757</span>
<span class="normal">1758</span>
<span class="normal">1759</span>
<span class="normal">1760</span>
<span class="normal">1761</span>
<span class="normal">1762</span>
<span class="normal">1763</span>
<span class="normal">1764</span>
<span class="normal">1765</span>
<span class="normal">1766</span>
<span class="normal">1767</span>
<span class="normal">1768</span>
<span class="normal">1769</span>
<span class="normal">1770</span>
<span class="normal">1771</span>
<span class="normal">1772</span>
<span class="normal">1773</span>
<span class="normal">1774</span>
<span class="normal">1775</span>
<span class="normal">1776</span>
<span class="normal">1777</span>
<span class="normal">1778</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">replace_undefined_variables</span><span class="p">(</span>
    <span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">local_context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">,</span> <span class="n">global_context</span><span class="p">:</span> <span class="n">GenieContext</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Replace undefined variables in the code with their corresponding values from the context.&quot;&quot;&quot;</span>

    <span class="k">class</span> <span class="nc">ReplaceVariables</span><span class="p">(</span><span class="n">ast</span><span class="o">.</span><span class="n">NodeTransformer</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">visit_Name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">local_context</span><span class="o">.</span><span class="n">context</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">local_context</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">],</span> <span class="n">GenieField</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.value&quot;</span><span class="p">):</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">id</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">id</span> <span class="o">+</span> <span class="s2">&quot;.value&quot;</span>
                    <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">copy_location</span><span class="p">(</span>
                        <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span>
                            <span class="nb">id</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                            <span class="n">ctx</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">ctx</span><span class="p">,</span>
                        <span class="p">),</span>
                        <span class="n">node</span><span class="p">,</span>
                    <span class="p">)</span>
            <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">id</span> <span class="ow">in</span> <span class="n">global_context</span><span class="o">.</span><span class="n">context</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">global_context</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">],</span> <span class="n">GenieField</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.value&quot;</span><span class="p">):</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">id</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">id</span> <span class="o">+</span> <span class="s2">&quot;.value&quot;</span>
                    <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">copy_location</span><span class="p">(</span>
                        <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span>
                            <span class="nb">id</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                            <span class="n">ctx</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">ctx</span><span class="p">,</span>
                        <span class="p">),</span>
                        <span class="n">node</span><span class="p">,</span>
                    <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">replacement_var</span> <span class="o">=</span> <span class="n">variable_resolver</span><span class="p">(</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">global_context</span><span class="p">,</span> <span class="n">local_context</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">replacement_var</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">replacement_var</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;.value&quot;</span><span class="p">):</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="n">replacement_var</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="n">replacement_var</span> <span class="o">+</span> <span class="s2">&quot;.value&quot;</span>
                    <span class="k">return</span> <span class="n">ast</span><span class="o">.</span><span class="n">copy_location</span><span class="p">(</span>
                        <span class="n">ast</span><span class="o">.</span><span class="n">Name</span><span class="p">(</span>
                            <span class="nb">id</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                            <span class="n">ctx</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">ctx</span><span class="p">,</span>
                        <span class="p">),</span>
                        <span class="n">node</span><span class="p">,</span>
                    <span class="p">)</span>
            <span class="k">return</span> <span class="n">node</span>

    <span class="c1"># Parse the code into an AST</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>

    <span class="c1"># Modify the AST</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">ReplaceVariables</span><span class="p">()</span><span class="o">.</span><span class="n">visit</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>

    <span class="c1"># Convert back to source code</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">ast</span><span class="o">.</span><span class="n">unparse</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;.value.value&quot;</span><span class="p">,</span> <span class="s2">&quot;.value&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">code</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.worksheets.environment.variable_resolver" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">variable_resolver</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">variable_resolver</span><span class="p">(</span><span class="n">var_name</span><span class="p">,</span> <span class="n">global_context</span><span class="p">,</span> <span class="n">local_context</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>We need to resolve the variable name since they are stored as <obj_name>.<field_name> in the context
and the user only provides the field name. We also need to keep track of the latest object of a worksheet
so that we can resolve the variable name correctly.</p>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1781</span>
<span class="normal">1782</span>
<span class="normal">1783</span>
<span class="normal">1784</span>
<span class="normal">1785</span>
<span class="normal">1786</span>
<span class="normal">1787</span>
<span class="normal">1788</span>
<span class="normal">1789</span>
<span class="normal">1790</span>
<span class="normal">1791</span>
<span class="normal">1792</span>
<span class="normal">1793</span>
<span class="normal">1794</span>
<span class="normal">1795</span>
<span class="normal">1796</span>
<span class="normal">1797</span>
<span class="normal">1798</span>
<span class="normal">1799</span>
<span class="normal">1800</span>
<span class="normal">1801</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">variable_resolver</span><span class="p">(</span><span class="n">var_name</span><span class="p">,</span> <span class="n">global_context</span><span class="p">,</span> <span class="n">local_context</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;We need to resolve the variable name since they are stored as &lt;obj_name&gt;.&lt;field_name&gt; in the context</span>
<span class="sd">    and the user only provides the field name. We also need to keep track of the latest object of a worksheet</span>
<span class="sd">    so that we can resolve the variable name correctly.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="n">local_context</span><span class="o">.</span><span class="n">context</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">var_name</span>
    <span class="k">elif</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="n">global_context</span><span class="o">.</span><span class="n">context</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">var_name</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">candidates</span> <span class="o">=</span> <span class="n">find_all_variables_matching_name</span><span class="p">(</span><span class="n">var_name</span><span class="p">,</span> <span class="n">local_context</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">candidates</span> <span class="o">=</span> <span class="n">find_all_variables_matching_name</span><span class="p">(</span><span class="n">var_name</span><span class="p">,</span> <span class="n">global_context</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">candidates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not resolve the variable name </span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found multiple candidates: </span><span class="si">{</span><span class="n">candidates</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">candidates</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.worksheets.environment.select_variable_from_list" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">select_variable_from_list</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">select_variable_from_list</span><span class="p">(</span><span class="n">variables</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1804</span>
<span class="normal">1805</span>
<span class="normal">1806</span>
<span class="normal">1807</span>
<span class="normal">1808</span>
<span class="normal">1809</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">select_variable_from_list</span><span class="p">(</span><span class="n">variables</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">same_worksheet</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">generate_var_name</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.worksheets.environment.get_variable_name" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">get_variable_name</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">get_variable_name</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">GenieWorksheet</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Get the variable name of a worksheet in the context.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>obj</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieWorksheet" href="#src.worksheets.environment.GenieWorksheet">GenieWorksheet</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The worksheet object.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieContext" href="#src.worksheets.environment.GenieContext">GenieContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The context to search in.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The variable name of the worksheet.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1812</span>
<span class="normal">1813</span>
<span class="normal">1814</span>
<span class="normal">1815</span>
<span class="normal">1816</span>
<span class="normal">1817</span>
<span class="normal">1818</span>
<span class="normal">1819</span>
<span class="normal">1820</span>
<span class="normal">1821</span>
<span class="normal">1822</span>
<span class="normal">1823</span>
<span class="normal">1824</span>
<span class="normal">1825</span>
<span class="normal">1826</span>
<span class="normal">1827</span>
<span class="normal">1828</span>
<span class="normal">1829</span>
<span class="normal">1830</span>
<span class="normal">1831</span>
<span class="normal">1832</span>
<span class="normal">1833</span>
<span class="normal">1834</span>
<span class="normal">1835</span>
<span class="normal">1836</span>
<span class="normal">1837</span>
<span class="normal">1838</span>
<span class="normal">1839</span>
<span class="normal">1840</span>
<span class="normal">1841</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_variable_name</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">GenieWorksheet</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the variable name of a worksheet in the context.</span>

<span class="sd">    Args:</span>
<span class="sd">        obj (GenieWorksheet): The worksheet object.</span>
<span class="sd">        context (GenieContext): The context to search in.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The variable name of the worksheet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">potential_objs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">GenieWorksheet</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">GenieWorksheet</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">==</span> <span class="n">obj</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">:</span>
                    <span class="n">potential_objs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">potential_objs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">potential_objs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">potential_objs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">potential_objs</span><span class="p">:</span>
            <span class="n">fields_value</span> <span class="o">=</span> <span class="p">[(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="n">value</span><span class="p">)]</span>
            <span class="n">obj_fields_value</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="p">]</span>

            <span class="k">if</span> <span class="n">deep_compare_lists</span><span class="p">(</span><span class="n">fields_value</span><span class="p">,</span> <span class="n">obj_fields_value</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">name</span>

    <span class="k">return</span> <span class="n">obj</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.worksheets.environment.propose" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">propose</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">propose</span><span class="p">(</span><span class="n">worksheet</span><span class="p">:</span> <span class="n">GenieWorksheet</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ProposeAgentAct</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Create a proposal action.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>worksheet</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieWorksheet" href="#src.worksheets.environment.GenieWorksheet">GenieWorksheet</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The worksheet to propose values for.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The parameters to propose.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>ProposeAgentAct</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.ProposeAgentAct" href="#src.worksheets.environment.ProposeAgentAct">ProposeAgentAct</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The created proposal action.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1847</span>
<span class="normal">1848</span>
<span class="normal">1849</span>
<span class="normal">1850</span>
<span class="normal">1851</span>
<span class="normal">1852</span>
<span class="normal">1853</span>
<span class="normal">1854</span>
<span class="normal">1855</span>
<span class="normal">1856</span>
<span class="normal">1857</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">propose</span><span class="p">(</span><span class="n">worksheet</span><span class="p">:</span> <span class="n">GenieWorksheet</span><span class="p">,</span> <span class="n">params</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ProposeAgentAct</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a proposal action.</span>

<span class="sd">    Args:</span>
<span class="sd">        worksheet (GenieWorksheet): The worksheet to propose values for.</span>
<span class="sd">        params (dict): The parameters to propose.</span>

<span class="sd">    Returns:</span>
<span class="sd">        ProposeAgentAct: The created proposal action.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">ProposeAgentAct</span><span class="p">(</span><span class="n">worksheet</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">),</span> <span class="n">params</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.worksheets.environment.say" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">say</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">say</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ReportAgentAct</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Create a message report action.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>message</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The message to report.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>ReportAgentAct</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.ReportAgentAct" href="#src.worksheets.environment.ReportAgentAct">ReportAgentAct</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The created report action.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1860</span>
<span class="normal">1861</span>
<span class="normal">1862</span>
<span class="normal">1863</span>
<span class="normal">1864</span>
<span class="normal">1865</span>
<span class="normal">1866</span>
<span class="normal">1867</span>
<span class="normal">1868</span>
<span class="normal">1869</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">say</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ReportAgentAct</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a message report action.</span>

<span class="sd">    Args:</span>
<span class="sd">        message (str): The message to report.</span>

<span class="sd">    Returns:</span>
<span class="sd">        ReportAgentAct: The created report action.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">ReportAgentAct</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.worksheets.environment.generate_clarification" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">generate_clarification</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">generate_clarification</span><span class="p">(</span><span class="n">worksheet</span><span class="p">:</span> <span class="n">GenieWorksheet</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Generate clarification text for a field.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>worksheet</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieWorksheet" href="#src.worksheets.environment.GenieWorksheet">GenieWorksheet</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The worksheet containing the field.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>field</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the field.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The generated clarification text.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1872</span>
<span class="normal">1873</span>
<span class="normal">1874</span>
<span class="normal">1875</span>
<span class="normal">1876</span>
<span class="normal">1877</span>
<span class="normal">1878</span>
<span class="normal">1879</span>
<span class="normal">1880</span>
<span class="normal">1881</span>
<span class="normal">1882</span>
<span class="normal">1883</span>
<span class="normal">1884</span>
<span class="normal">1885</span>
<span class="normal">1886</span>
<span class="normal">1887</span>
<span class="normal">1888</span>
<span class="normal">1889</span>
<span class="normal">1890</span>
<span class="normal">1891</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_clarification</span><span class="p">(</span><span class="n">worksheet</span><span class="p">:</span> <span class="n">GenieWorksheet</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate clarification text for a field.</span>

<span class="sd">    Args:</span>
<span class="sd">        worksheet (GenieWorksheet): The worksheet containing the field.</span>
<span class="sd">        field (str): The name of the field.</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: The generated clarification text.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="n">worksheet</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">field</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">slottype</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">slottype</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
                <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">slottype</span><span class="o">.</span><span class="n">__members__</span><span class="o">.</span><span class="n">values</span><span class="p">())]</span>
                <span class="n">options</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">options</span><span class="p">)</span>
                <span class="n">option_desc</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">description</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; Options are: </span><span class="si">{</span><span class="n">options</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">return</span> <span class="n">option_desc</span>
            <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">description</span>

    <span class="k">return</span> <span class="s2">&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.worksheets.environment.answer_clarification_question" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">answer_clarification_question</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">answer_clarification_question</span><span class="p">(</span><span class="n">worksheet</span><span class="p">:</span> <span class="n">GenieField</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="n">GenieField</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ReportAgentAct</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Create a clarification answer action.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>worksheet</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieField" href="#src.worksheets.environment.GenieField">GenieField</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The worksheet field.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>field</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieField" href="#src.worksheets.environment.GenieField">GenieField</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The field to clarify.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>context</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieContext" href="#src.worksheets.environment.GenieContext">GenieContext</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The context.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>ReportAgentAct</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.ReportAgentAct" href="#src.worksheets.environment.ReportAgentAct">ReportAgentAct</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The created clarification report action.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1894</span>
<span class="normal">1895</span>
<span class="normal">1896</span>
<span class="normal">1897</span>
<span class="normal">1898</span>
<span class="normal">1899</span>
<span class="normal">1900</span>
<span class="normal">1901</span>
<span class="normal">1902</span>
<span class="normal">1903</span>
<span class="normal">1904</span>
<span class="normal">1905</span>
<span class="normal">1906</span>
<span class="normal">1907</span>
<span class="normal">1908</span>
<span class="normal">1909</span>
<span class="normal">1910</span>
<span class="normal">1911</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">answer_clarification_question</span><span class="p">(</span>
    <span class="n">worksheet</span><span class="p">:</span> <span class="n">GenieField</span><span class="p">,</span> <span class="n">field</span><span class="p">:</span> <span class="n">GenieField</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">GenieContext</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ReportAgentAct</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a clarification answer action.</span>

<span class="sd">    Args:</span>
<span class="sd">        worksheet (GenieField): The worksheet field.</span>
<span class="sd">        field (GenieField): The field to clarify.</span>
<span class="sd">        context (GenieContext): The context.</span>

<span class="sd">    Returns:</span>
<span class="sd">        ReportAgentAct: The created clarification report action.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ws</span> <span class="o">=</span> <span class="n">context</span><span class="o">.</span><span class="n">context</span><span class="p">[</span><span class="n">worksheet</span><span class="o">.</span><span class="n">value</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ReportAgentAct</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;AskClarification(</span><span class="si">{</span><span class="n">worksheet</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
        <span class="n">generate_clarification</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">field</span><span class="o">.</span><span class="n">value</span><span class="p">),</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.worksheets.environment.confirm" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">confirm</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">confirm</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GenieValue</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Create a confirmed value.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>value</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The value to confirm.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>GenieValue</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="src.worksheets.environment.GenieValue" href="#src.worksheets.environment.GenieValue">GenieValue</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The confirmed value instance.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1914</span>
<span class="normal">1915</span>
<span class="normal">1916</span>
<span class="normal">1917</span>
<span class="normal">1918</span>
<span class="normal">1919</span>
<span class="normal">1920</span>
<span class="normal">1921</span>
<span class="normal">1922</span>
<span class="normal">1923</span>
<span class="normal">1924</span>
<span class="normal">1925</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">confirm</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GenieValue</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a confirmed value.</span>

<span class="sd">    Args:</span>
<span class="sd">        value (Any): The value to confirm.</span>

<span class="sd">    Returns:</span>
<span class="sd">        GenieValue: The confirmed value instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">GenieValue</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">confirm</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">GenieValue</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">confirm</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.worksheets.environment.sanitize_dev_code" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">sanitize_dev_code</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">sanitize_dev_code</span><span class="p">(</span><span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">all_variables</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Sanitize the developer's code to ensure it doesn't contain any undefined variables.</p>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2185</span>
<span class="normal">2186</span>
<span class="normal">2187</span>
<span class="normal">2188</span>
<span class="normal">2189</span>
<span class="normal">2190</span>
<span class="normal">2191</span>
<span class="normal">2192</span>
<span class="normal">2193</span>
<span class="normal">2194</span>
<span class="normal">2195</span>
<span class="normal">2196</span>
<span class="normal">2197</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">sanitize_dev_code</span><span class="p">(</span><span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">all_variables</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Sanitize the developer&#39;s code to ensure it doesn&#39;t contain any undefined variables.&quot;&quot;&quot;</span>
    <span class="n">lexer</span> <span class="o">=</span> <span class="n">PythonLexer</span><span class="p">()</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="n">lexer</span><span class="o">.</span><span class="n">get_tokens</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
    <span class="n">new_tokens_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">tokens</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">token</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">Token</span><span class="o">.</span><span class="n">Name</span> <span class="ow">and</span> <span class="n">token</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">all_variables</span><span class="p">:</span>
            <span class="n">new_tokens_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">Token</span><span class="o">.</span><span class="n">Name</span><span class="p">,</span> <span class="n">token</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;.value&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_tokens_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>

    <span class="n">new_code</span> <span class="o">=</span> <span class="n">tokenize</span><span class="o">.</span><span class="n">untokenize</span><span class="p">(</span><span class="n">new_tokens_list</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_code</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.worksheets.environment.any_open_empty_ws" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">any_open_empty_ws</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">any_open_empty_ws</span><span class="p">(</span><span class="n">turn_context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">,</span> <span class="n">global_context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Checks all the worksheets in the context. If there is any worksheet that is available but all the fields are None, then return True
else return False</p>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2200</span>
<span class="normal">2201</span>
<span class="normal">2202</span>
<span class="normal">2203</span>
<span class="normal">2204</span>
<span class="normal">2205</span>
<span class="normal">2206</span>
<span class="normal">2207</span>
<span class="normal">2208</span>
<span class="normal">2209</span>
<span class="normal">2210</span>
<span class="normal">2211</span>
<span class="normal">2212</span>
<span class="normal">2213</span>
<span class="normal">2214</span>
<span class="normal">2215</span>
<span class="normal">2216</span>
<span class="normal">2217</span>
<span class="normal">2218</span>
<span class="normal">2219</span>
<span class="normal">2220</span>
<span class="normal">2221</span>
<span class="normal">2222</span>
<span class="normal">2223</span>
<span class="normal">2224</span>
<span class="normal">2225</span>
<span class="normal">2226</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">any_open_empty_ws</span><span class="p">(</span><span class="n">turn_context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">,</span> <span class="n">global_context</span><span class="p">:</span> <span class="n">GenieContext</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Checks all the worksheets in the context. If there is any worksheet that is available but all the fields are None, then return True</span>
<span class="sd">    else return False</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">turn_context</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">GenieWorksheet</span><span class="p">):</span>
            <span class="n">all_none</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">all_none</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">break</span>

            <span class="k">if</span> <span class="n">all_none</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>

    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">global_context</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">GenieWorksheet</span><span class="p">):</span>
            <span class="n">all_none</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">get_genie_fields_from_ws</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">all_none</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">break</span>

            <span class="k">if</span> <span class="n">all_none</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="src.worksheets.environment.find_list_variable" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">find_list_variable</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">find_list_variable</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Find the variable name which is a list and the index of the required value in the context.</p>

            <details class="quote">
              <summary>Source code in <code>src/worksheets/environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">2229</span>
<span class="normal">2230</span>
<span class="normal">2231</span>
<span class="normal">2232</span>
<span class="normal">2233</span>
<span class="normal">2234</span>
<span class="normal">2235</span>
<span class="normal">2236</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">find_list_variable</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find the variable name which is a list and the index of the required value in the context.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="n">val</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../../course_enrollment/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Course Enrollment">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Course Enrollment
              </div>
            </div>
          </a>
        
        
          
          <a href="../agent/" class="md-footer__link md-footer__link--next" aria-label="Next: Agent">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Agent
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.instant.prefetch", "navigation.tracking", "navigation.expand", "navigation.path", "navigation.prune", "navigation.indexes", "navigation.top", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "toc.follow", "navigation.footer", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
    
  </body>
</html>